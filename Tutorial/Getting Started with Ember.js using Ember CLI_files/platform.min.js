!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=c;c.constructor=function(){};var e=a("./util/gi_window");d.httpsOnly=!0,e.isBrowser&&window.isBarista&&(d.httpsOnly=!1)},{"./util/gi_window":21}],2:[function(a,b,c){"use strict";var d=c;c.constructor=function(){};var e=a("lodash"),f=a("async"),g=a("./util/resolver").Resolver,Connection=a("./connection").Connection,h=a("./util/validation"),i=a("goinstant-common").errors;d._Connection=Connection,d._Resolver=g;var j=["room","rooms","user","visible","guestId","xhrOnly"];d.start=function(a,b,c){function g(c){var f=b.user?b.user:null,g=e.pick(b,["guestId","xhrOnly"]);try{l=new d._Connection(a,g),l.connect(f,c)}catch(h){c(h)}}function k(a,c){try{var d=l.room(a);if(p.isOpt){var e={visible:b.visible};return d.join(null,e,c)}d.join(c)}catch(f){c(f)}}var l;if(!e.isString(a))throw new i.ArgumentError("url must be a valid string");if(!h.optionalCallback(c))throw new i.ArgumentError("cb, if provided, must be valid");if(!c&&e.isFunction(b)&&(c=b,b={}),b=b||{},delete b.sessionId,!e.isFunction(b)&&!e.isPlainObject(b))throw new i.ArgumentError("opts if provided must be an object");var m={isOpt:e.has(b,"user"),isString:e.isString(b.user),isPlain:e.isPlainObject(b.user)};if(m.isOpt&&!m.isString&&!m.isPlain)throw new i.ArgumentError("opts.user if provided must be a jwt string or object");if(e.has(b,"room")&&e.has(b,"rooms"))throw new i.ArgumentError("opts can specify room or rooms, not both");var n={isOpt:e.has(b,"room"),isString:e.isString(b.room),isArray:e.isArray(b.room),allStrings:e.isArray(b.room)&&e.all(b.room,e.isString)};if(!(!n.isOpt||n.isString||n.isArray&&n.allStrings))throw new i.ArgumentError("room must be a string or an array of strings");var o={isOpt:e.has(b,"rooms"),isString:e.isString(b.rooms),isArray:e.isArray(b.rooms),allStrings:e.isArray(b.rooms)&&e.all(b.rooms,e.isString)};if(!(!o.isOpt||o.isString||o.isArray&&o.allStrings))throw new i.ArgumentError("rooms must be a string or an array of strings");var p={isOpt:e.has(b,"visible"),isBoolean:e.isBoolean(b.visible)};if(p.isOpt&&!p.isBoolean)throw new i.ArgumentError("visible must be a boolean");var q=e.keys(b),r=e.difference(q,j);if(r.length)throw new i.ArgumentError("invalid option(s) provided: "+r.join(", "));var s=new d._Resolver(c,this,["connection","rooms..."]);c=s.cb;var t;if(t=b.room?b.room:b.rooms?b.rooms:["lobby"],e.isString(t)&&(t=[t]),!t.length)throw new i.ArgumentError("room(s) can not be an empty array");return f.series({connection:g,rooms:f.apply(f.map,t,k)},function(a,b){if(a)return l?l.disconnect(function(){return c(a)}):c(a);var d=b.rooms;d.unshift(l),d.unshift(null),c.apply(c,d)}),s.promise}},{"./connection":3,"./util/resolver":24,"./util/validation":29,async:31,"goinstant-common":64,lodash:69}],3:[function(a,b,c){"use strict";function Connection(a,b){e.bindAll(this,"_onTimeout"),this._validateUrl(a),this._validateOpts(b),this._opts=b,this._socket=null,this._socketCleanup=function(){},this._user=null,this._guestUserDefaults=null,this._joinedRooms=[],this.rooms=new o(this),this._registry=new l,this._emitter=new f,this._requestCallbackEmitter=new f,this._currentCallbackId=0,this._timeouts=new n(E),this._timeouts.on("expiry",this._onTimeout),this._version=q.clientVersion,j.all(this,F)}var d=c;c.constructor=function(){};var e=a("lodash"),f=a("eventemitter2").EventEmitter2,g=a("eventutil"),h=a("async"),i=a("./util/resolver").Resolver,j=a("./util/guard"),k=a("./platform/socket").Socket,Room=a("./platform/room").Room,l=a("./platform/registry").Registry,m=a("./util/validation"),n=a("./util/timeouts").Timeouts,o=a("./platform/room_collection").RoomCollection,p=a("./util/logging"),q=a("./version"),r=a("./config"),s=a("goinstant-common"),t=s.constants,u=s.errors,v=p.get("connection"),w="[\\d\\w][\\d\\w\\-]*",x="\\/(.+?)",y="(?:"+w+"\\.)*",z="(?:goinstant\\.(?:com|org|net))",A="(?::\\d{1,5})?",B="(?:$|\\/)",C="^((https?)://(?:"+y+z+"|127\\.0\\.0\\.1|localhost(?:\\.localdomain)?)("+A+"))",D=new RegExp(C+x+x+B),E=5e3,F=["_onMessage","_onError","_onConnect","_onDisconnect"],G=/^https?:\/\//;d.Connection=Connection,Connection.REQUEST_EXPIRY_TIME=E,Connection._Resolver=i,Connection.prototype._validateUrl=function(a){var b,c=!0;if(!a)throw b="Cannot connect to GoInstant. You must provide a registered application URL (eg. https://goinstant.net/MYACCOUNT/MYAPP)",new u.ArgumentError(b);var d=a.match(D);if(!d)throw b="Cannot connect to GoInstant. You must provide a registered application URL (eg. https://goinstant.net/MYACCOUNT/MYAPP)",new u.ArgumentError(b);var e=d[1];this._baseConnectionUrl=e;var f=d[2],g=d[3];if(this._account=d[4],this._application=d[5],r.httpsOnly&&(c="https"===f&&(!g||":443"===g)),!c)throw b='Cannot connect to "'+a+'". The url must be an HTTPS url on the standard port (443).',new u.ArgumentError(b);/:\d+$/.test(e)||(e+=":443"),this._connectUrl=e},Connection.prototype._validateOpts=function(a){if(a){if(!e.isObject(a))throw new Error("opts, if provided, must be an object");delete a.sessionId;var b=e.difference(e.keys(a),["guestId","xhrOnly"]);if(b.length>0)throw new Error("unknown option(s): "+b.join(", "));if(e.has(a,"guestId")&&!e.isString(a.guestId)&&a.guestId)throw new Error("opts.guestId must be a string or falsey value")}},Connection.prototype._createCallbackId=function(){return this._currentCallbackId++},Connection.prototype._request=function(a,b,c){c=c||function(){};var d=this._createCallbackId();this._requestCallbackEmitter.once(d,c),this._timeouts.add(d);var f=b.options||{},g={command:a,room:b.room,options:f,callbackId:d};e.contains(["ot/resync","ot/sync","ot/update"],a)?(g.key=g.ot=b.ot,g.packet=b.packet):"OFF"===a.toUpperCase()?(b.key&&(g.key=b.key),b.value&&(g.value=b.key)):(g.key=b.key,g.value=b.value);try{this._socket.send(g)}catch(h){this._timeouts.clear(d),this._requestCallbackEmitter.emit(d,h)}},Connection.prototype._onResponse=function(a,b){function c(a,b){delete b.meta,e._requestCallbackEmitter.emit(d,a,b.value,b)}var d=b.callbackId;delete b.callbackId,this._timeouts.clear(d);var e=this;if(a){var f=u.getByCode(b.meta.code);f||(f=Error);var g=new f(a);return c(g,b)}c(null,b)},Connection.prototype._onNotify=function(a){this._registry.emit(a)},Connection.prototype.connect=function(a,b){var c=this;(e.isFunction(a)||e.isUndefined(a))&&(b=a||function(){},a=null),b=j.one(b,c);var d=new Connection._Resolver(b,c);b=d.cb,e.isPlainObject(a)&&(c._guestUserDefaults=a,a=null);var f={connectUrl:c._connectUrl,account:c._account,app:c._application,user:a,misc:c._opts,version:c._version},h=new k(f);return h.connect(function(a,d){return a?b(a):(c._user=d,c._socket=h,c._socketCleanup=g.register(h,"message",e.bind(c._onMessage,c),h,"error",e.bind(c._onError,c),h,"disconnect",e.bind(c._onDisconnect,c),h,"connect",e.bind(c._onConnect,c)),c._onConnect(),void b(null,c))}),d.promise},Connection.prototype.disconnect=function(a){var b=this,c=new Connection._Resolver(a,b);return a=c.cb,b._socket?(b._leaveAllRooms(function(c){function d(){a(c,b),b._onDisconnect()}function e(){a(new Error("Error during disconnect"),b)}b._socketCleanup(),g.register(b._socket,"!disconnect",d,b._socket,"!error",e),b._socket.close(),b._socket=null}),c.promise):a(null,b)},Connection.prototype._leaveAllRooms=function(a){var b=[],c=e.map(this._joinedRooms,function(a){return function(c){a.leave(function(d){d&&"User not in room"!==d.message&&b.push({name:a.name,err:d}),c()})}});h.parallel(c,function(){return b.length>0?a(new u.RoomSessionStateError("Failed to leave room(s).")):void a()})},Connection.prototype.room=function(a){return new Room(this,a)},Connection.prototype._joined=function(a){var b=this._isJoined(a);b||this._joinedRooms.push(a)},Connection.prototype._isJoined=function(a){return e.any(this._joinedRooms,function(b){return a.name===b.name})},Connection.prototype._left=function(a){this._joinedRooms=e.without(this._joinedRooms,a)};var H=["connect","disconnect","error"];Connection.prototype.on=function(a,b){if(!m.contained(H,a))throw new Error("Invalid event provided:"+a);this._emitter.on(a,b)},Connection.prototype.off=function(a,b){if(!m.contained(H,a))throw new Error("Invalid event provided:"+a);this._emitter.off(a,b)},Connection.prototype._on=function(a,b,c,d,e){this._registry.on({room:a,key:b,command:c,opts:d},e),this._request("ON",{room:a,key:b,value:c,options:d},function(e){e&&v.error("Could not subscribe to event on server",{err:e,key:b,room:a,command:c,opts:d})})},Connection.prototype._off=function(a,b,c,d,e){var f=this._registry.off({room:a,key:b,command:c,opts:d},e);f&&b&&this._request("OFF",{room:a,key:b,value:c,options:d},function(e){e&&v.error("Could not unsubscribe from event on server",{err:e,key:b,room:a,command:c,opts:d})})},Connection.prototype._rejoinRooms=function(a){var b=this;h.eachLimit(this._joinedRooms,10,function(a,c){a.join(function(d){if(d)return c(d);var e=b._registry.toArray(a.name);h.eachLimit(e,10,function(c,d){b._request("ON",{room:a.name,key:c.key,value:c.action,options:c.opts},d)},c)})},function(c){return c?b.disconnect(e.bind(a,null,c)):a()})},Connection.prototype._onConnect=function(){this.guestId=this._socket.guestId;var a=this;this._rejoinRooms(function(b){return b?a._emitter.emit("error",b):void a._emitter.emit("connect")})},Connection.prototype._onDisconnect=function(){this._emitter.emit("disconnect")},Connection.prototype._onError=function(a,b){var c=u.getByCode(b),d=new c(a);if(0===this._emitter.listeners("error").length)throw d;this._emitter.emit("error",d)},Connection.prototype._onMessage=function(a){var b=JSON.parse(a),c=b.shift();switch(c){case"RESPONSE":this._onResponse.apply(this,b);break;case"NOTIFY":this._onNotify.apply(this,b);break;case"ERROR":this._onError(b[1],b[2]);break;case"USER":break;default:this._onError('Unknown message type "'+c+'": '+a)}},Connection.prototype._onTimeout=function(a){var b=new Error("Request timed out");this._requestCallbackEmitter.emit(a,b)},Connection.prototype.authUrl=function(){return this._baseConnectionUrl.replace("://","://auth.")},Connection.prototype.loginUrl=function(a,b){if(a=a||null,b=b||window.location.href,a&&!t.PROVIDER_NAME_REGEX.test(a))throw new Error("Malformed providerName name");if(!G.test(b))throw new u.ArgumentError("returnTo parameter must be an HTTP or HTTPS URL");var c=["account="+encodeURIComponent(this._account),"app="+encodeURIComponent(this._application),"returnTo="+encodeURIComponent(b)];return a&&c.push("providerName="+encodeURIComponent(a)),this.authUrl()+"/begin?"+c.join("&")},Connection.prototype.logoutUrl=function(a){if(a=a||window.location.href,!G.test(a))throw new u.ArgumentError("returnTo parameter must be an HTTP or HTTPS URL");var b=["account="+encodeURIComponent(this._account),"app="+encodeURIComponent(this._application),"returnTo="+encodeURIComponent(a)];return this.authUrl()+"/logout?"+b.join("&")},Connection.prototype.isGuest=function(){var a=this._user;return a?"goinstant"===a.provider&&/^guest:/.test(a.id):null}},{"./config":1,"./platform/registry":15,"./platform/room":16,"./platform/room_collection":17,"./platform/socket":18,"./util/guard":22,"./util/logging":23,"./util/resolver":24,"./util/timeouts":28,"./util/validation":29,"./version":30,async:31,eventemitter2:58,eventutil:59,"goinstant-common":64,lodash:69}],4:[function(a,b,c){"use strict";function d(a,b){if(!f.isPlainObject(b))throw new l.ArgumentError("Must provide an object for opts");a=f.cloneDeep(a),b=f.cloneDeep(b),this._results=[],this._index=new j,this._filterer=new g(a),this._sorter=new h(b.sort),this._paginator=new i(b.limit)}var e=c;c.constructor=function(){};var f=a("lodash"),g=a("./filter").ResultGenerator,h=a("./sort").ResultSorter,i=a("./page").ResultPage,j=a("./index").ResultIndex,k=a("goinstant-common"),l=k.errors;e.ExpressionEngine=d,d.prototype.set=function(a,b){if(!f.isArray(a))throw new Error("An array must be provided");var c=this._filterer.filter(a);c=this._sorter.sort(c);var d=this._index.set(c);return this._results=c,this._paginator.paginate(this._results,d,b)},d.prototype.add=function(a){if(!f.isObject(a))throw new l.ArgumentError("Expects an object to be provided");if(0===this._filterer.filter([a]).length)return[];var b=this._sorter.determinePosition(this._results,a);1/0===b&&(b=this._results.length);var c=this._index.add(a.name,b,a.value);return this._apply(c),this._paginator.paginate(this._results,c)},d.prototype.update=function(a){if(!f.isObject(a))throw new l.ArgumentError("Expects an object to be provided");var b=0!==this._filterer.filter([a]).length,c=void 0!==this._index.data(a.name);if(!b&&!c)return[];if(!b&&c)return this.remove(a);if(b&&!c)return this.add(a);var d=this._index.position(a.name),e=this._results.slice(0,d).concat(this._results.slice(d+1,this._results.length)),g=this._sorter.determinePosition(e,a);1/0===g&&(g=d);var h=this._index.update(a.name,g,a.value);return this._apply(h),this._paginator.paginate(this._results,h)},d.prototype.remove=function(a){if(!f.isObject(a))throw new l.ArgumentError("Expects an object to be provided");if(void 0===this._index.data(a.name))return[];var b=this._index.remove(a.name);return this._apply(b),this._paginator.paginate(this._results,b)},d.prototype.get=function(){return f.cloneDeep(this._paginator.slice(this._results))},d.prototype._apply=function(a){for(var b,c=0;c<a.length;++c)switch(b=a[c],b.op){case"add":this._results.splice(b.position,0,{name:b.name,value:b.value});break;case"update":this._results[b.position]={name:b.name,value:b.value};break;case"remove":this._results.splice(b.previousPosition,1)}}},{"./filter":5,"./index":6,"./page":7,"./sort":8,"goinstant-common":64,lodash:69}],5:[function(a,b,c){"use strict";function d(a){if(!f.isPlainObject(a))throw new i.ArgumentError("Must provide an object for expression");this._expr=a,this.filter([{name:"test",value:"empty"}],!0)}var e=c;c.constructor=function(){};var f=a("lodash"),g=a("goinstant-common"),h=g.objUtil,i=g.errors,j={object:f.isPlainObject,array:f.isArray,integer:function(a){return f.isNumber(a)&&a%1===0},"float":function(a){return f.isNumber(a)&&a%1!==0},string:f.isString,"boolean":f.isBoolean,"null":f.isNull};e.ResultGenerator=d,d.prototype.filter=function(a,b){function c(a,c,g,h){if(b&&!f.isPlainObject(a))throw new i.ArgumentError("Expected an object at path: "+h);var j=f.keys(a);if(0===j.length)return!0;var k=d(a);if(k)return e(a[k],c,g,h+"/"+k,k);for(var l,m,n,o=0;o<j.length;++o)if(l=j[o],m=h+"/"+l,n=g+"/"+l,"$"!==l[0]){if(f.isPlainObject(a[l])&&(k=d(a[l]))){if(e(a[l][k],c,n,m,k))continue;return!1}if(!e(a[l],c,n,m,"$eq"))return!1}else if(!e(a[l],c,g,m,l))return!1;return!0}function d(a){if(!f.isPlainObject(a))return!1;var b=f.keys(a);return 1===b.length&&"$"===b[0][0]?b[0]:!1}function e(a,c,d,e,n){n||(n="$eq");var o=h.pick(c,d);switch(n=n.toLowerCase()){case"$type":if(b&&!j[a])throw new i.ArgumentError("$type value given is not valid at "+e);return j[a](o);case"$exists":return void 0!==o===a;case"$all":if(b&&!f.isArray(a))throw new i.ArgumentError("$all requires an array at "+e);return f.isEqual(o,a);case"$eq":return f.isEqual(o,a);case"$ne":return f.isArray(a)?!f.isEqual(o,a):o!==a;case"$in":if(b&&!f.isArray(a))throw new i.ArgumentError("$in operators require their value to be an array at "+e);return f.contains(a,o);case"$nin":if(b&&!f.isArray(a))throw new i.ArgumentError("$nin operators require their value to be an array at "+e);return!f.contains(a,o);case"$size":return f.isArray(o)?o.length===a:!1;case"$gt":if(b&&f.isObject(a))throw new i.ArgumentError("$gt operator must be a primitive value at "+e);return o>a;case"$lt":if(b&&f.isObject(a))throw new i.ArgumentError("$lt operator must be a primitive value at "+e);return a>o;case"$lte":if(b&&f.isObject(a))throw new i.ArgumentError("$lte operator must be a primitive value at "+e);return a>=o;case"$gte":if(b&&f.isObject(a))throw new i.ArgumentError("$gte operator must be a primitive value at "+e);return o>=a;case"$or":return m(a,c,d,e);case"$and":return l(a,c,d,e);case"$nor":return!m(a,c,d,e);case"$nand":return!l(a,c,d,e);case"$value":return k(a,c,d,e);case"$name":return g(a,c,d,e);default:throw new i.ArgumentError("Unknown operator["+n+"] at "+e)}}function g(a,b,e,g){var i=f.keys(h.pick(b,e));return d(a)||(a={$eq:a}),f.any(i,function(b,d){return c(a,i,"/"+d,g)})}function k(a,b,e,g){if(/\/\$value$/.test(g)){var h=f.values(b);if(1!==h.length)throw new i.ArgumentError("$value should only have a single value associated "+h);b=f.values(b)[0]}return d(a)||(a={$eq:a}),c(a,b,e,g)}function l(a,d,e,g){if(b&&!f.isArray(a))throw new i.ArgumentError("$and operator requires value to be an array at "+g);for(var h,j,k=0;k<a.length;++k){if(h=a[k],j=g+"/"+k,b&&!f.isPlainObject(h))throw new i.ArgumentError("$and operator members must be objects at "+g);if(!c(h,d,e,j))return!1}return!0}function m(a,d,e,g){if(b&&!f.isArray(a))throw new i.ArgumentError("$or operator requires value to be an array at "+g);for(var h,j,k=0;k<a.length;++k){if(h=a[k],j=g+"/"+k,b&&!f.isPlainObject(h))throw new i.ArgumentError("$or operator members must be objects at "+g);if(c(h,d,e,j))return!0}return!1}if(!f.isArray(a)){if(!f.isPlainObject(a))throw new Error("ResultGenerator expected array passed to filter.");a=[a]}b||(b=!1);var n=this;return f.filter(a,function(a){var b=a.value;return f.isObject(b)||(b={},b[a.name]=a.value),c(n._expr,b,"","")})}},{"goinstant-common":64,lodash:69}],6:[function(a,b,c){"use strict";function d(){this._nameMap={},this._posMap={},this._dataMap={},this._size=0}var e=c;c.constructor=function(){};var f=a("lodash"),g=a("goinstant-common").errors;e.ResultIndex=d,d.prototype.set=function(a){if(!f.isArray(a))throw new g.ArgumentError("Items must be an array");for(var b=[],c=this._size-1;c>=0;--c)b.unshift(this.remove(this._posMap[c])[0]);this._size=0,this._nameMap={},this._posMap={},this._dataMap={};for(var d,e=0;e<a.length;e++)d=a[e],b.push(this.add(d.name,e,d.value)[0]);return this._size=a.length,b},d.prototype.add=function(a,b,c){if(void 0!==this._nameMap[a])throw new g.ArgumentError("Item already exists in index: "+a);if(b>this._size)throw new g.ArgumentError("Position is out of bounds: "+b);this._rightShift(b,this._size-1),this._posMap[b]=a,this._nameMap[a]=b,this._dataMap[a]=c,this._size+=1;var d=[{op:"add",name:a,position:b,previousPosition:null,value:f.cloneDeep(c)}];return d},d.prototype.remove=function(a){var b=this._nameMap[a];if(void 0===b)throw new g.ArgumentError("Item is not available in result index: "+a);var c=f.cloneDeep(this._dataMap[a]);delete this._nameMap[a],delete this._posMap[b],delete this._dataMap[a],this._leftShift(b+1,this._size-1),delete this._posMap[this._size-1],this._size-=1;var d=[{op:"remove",name:a,position:null,previousPosition:b,value:c}];return d},d.prototype.update=function(a,b,c){var d=this._nameMap[a];if(void 0===d)throw new g.ArgumentError("Item is not available in result index: "+a);if(b>=this._size)throw new g.ArgumentError("Position is out of bounds: "+b);void 0===c&&(c=this.data(a));var e=f.cloneDeep(this._dataMap[a]);if(this._dataMap[a]=c,d===b)return[{op:"update",name:a,position:b,previousPosition:b,value:f.cloneDeep(c)}];var h=[];return delete this._posMap[d],h.push({op:"remove",name:a,position:b,previousPosition:d,value:e}),d>b?this._rightShift(b,d-1):this._leftShift(d+1,b),this._posMap[b]=a,this._nameMap[a]=b,h.push({op:"add",name:a,position:b,previousPosition:d,value:f.cloneDeep(c)}),h},d.prototype.data=function(a){return f.cloneDeep(this._dataMap[a])},d.prototype.position=function(a){var b=this._nameMap[a];return void 0===b?-1:b},d.prototype._leftShift=function(a,b){for(var c,d,e=a;b>=e;++e)d=this._posMap[e],c=e-1,this._posMap[c]=d,this._nameMap[d]=c},d.prototype._rightShift=function(a,b){for(var c,d,e=b;e>=a;e--)c=this._posMap[e],d=e+1,this._posMap[d]=c,this._nameMap[c]=d}},{"goinstant-common":64,lodash:69}],7:[function(a,b,c){"use strict";function d(a){var b,c;if(f.isUndefined(a))return this._start=0,void(this._size=h);if(f.isNumber(a)?(b=0,c=a):f.isArray(a)&&(b=a[0],c=a[1]),!f.isNumber(b)||b%1!==0||0>b)throw new g.ArgumentError("Page start must be an integer >= 0.");if(!f.isNumber(c)||c%1!==0||1>c)throw new g.ArgumentError("Page size must be an integer >= 1.");this._start=b,this._size=c}var e=c;c.constructor=function(){};var f=a("lodash"),g=a("goinstant-common").errors,h=1/0;e.ResultPage=d,d.prototype.paginate=function(a,b,c){if(!f.isArray(a))throw new g.ArgumentError("Pagination results must be an array.");if(!f.isArray(b))throw new g.ArgumentError("Pagination operations must be an array.");if(this._size===h)return b;var d=[];if(0===b.length)return d;var e,i;for(e=0,i=b.length;i>e;e++)b[e].previousPosition=this._pageRelative(b[e].previousPosition),b[e].position=this._pageRelative(b[e].position);for(e=0;e<b.length;++e){var j=b[e];b[e+1]&&b[e].name===b[e+1].name&&"add"===b[e+1].op&&"remove"===b[e].op&&isFinite(b[e+1].position)&&isFinite(b[e].previousPosition)&&(b[e].op="update",b[e].position=b[e+1].position,b[e].value=b[e+1].value,b.splice(e+1,1));var k,l,m,n,o=j.previousPosition===Number.NEGATIVE_INFINITY,p=j.previousPosition===Number.POSITIVE_INFINITY,q=j.position===Number.NEGATIVE_INFINITY,r=j.position===Number.POSITIVE_INFINITY,s=!o&&!p&&null!==j.previousPosition,t=!q&&!r&&null!==j.position;switch(j.op){case"add":if(r)break;if(c&&!t)break;k=this._size-1,l=a[this._start+this._size],l&&!c&&d.push({op:"remove",name:l.name,position:null,previousPosition:k,value:f.cloneDeep(l.value)}),m=t?j.position:0,n=a[m+this._start],n&&d.push({op:"add",name:n.name,position:m,previousPosition:null,value:f.cloneDeep(n.value)});break;case"update":if(c)throw new g.ArgumentError("Initialization should not contain update events.");s&&t&&d.push(j);break;case"remove":if(c)throw new g.ArgumentError("Initialization should not contain remove events.");if(p)break;s?(k=j.previousPosition,l={name:j.name,value:j.value}):(k=0,l=a[k+this._start-1]),l&&d.push({op:"remove",name:l.name,position:null,previousPosition:k,value:f.cloneDeep(l.value)}),m=this._size-1,n=a[this._start+this._size-1],n&&d.push({op:"add",name:n.name,position:m,previousPosition:null,value:f.cloneDeep(n.value)});break;default:throw new g.ArgumentError("Operation op is invalid: "+j.op)}}return d},d.prototype.slice=function(a){if(!f.isArray(a)||0===a.length)return[];var b=this._start,c=this._start+this._size;return this._size===h&&(c=a.length),a.slice(b,c)},d.prototype._pageRelative=function(a){if(null===a||void 0===a)return null;var b=a-this._start;return 0>b?Number.NEGATIVE_INFINITY:b>=this._size?Number.POSITIVE_INFINITY:b}},{"goinstant-common":64,lodash:69}],8:[function(a,b,c){"use strict";function d(a){if(f.isUndefined(a))return this._order=[],void(this._direction=[]);if(!f.isPlainObject(a))throw new i.ArgumentError("Sorting options must be an object: "+a);a=f.cloneDeep(a),f.each(a,function(b,c){if(!f.isNumber(b)||!f.contains([-1,1],b)){if(f.isString(b)&&(b=b.toLowerCase()),!j[b])throw new i.ArgumentError("Invalid sort direction provided for "+c);a[c]=j[b]}}),f.each(a,function(b,c){"$value"===c?a.value=b:"$name"===c?a.name=b:a["value/"+c]=b,delete a[c]}),this._expr=a,this._order=f.keys(this._expr),this._direction=f.values(this._expr)}var e=c;c.constructor=function(){};var f=a("lodash"),g=a("goinstant-common"),h=g.objUtil,i=g.errors,j={ascending:1,descending:-1,asc:1,desc:-1};e.ResultSorter=d,d.prototype.compare=function(a,b){if(0===this._order.length)return 1;for(var c,d,e=this._order,f=this._direction,g=0;g<e.length;++g)if(c=h.pick(a,e[g]),d=h.pick(b,e[g]),c!==d)return null===c||void 0===c?1:null===d||void 0===d?-1:f[g]*(c>d?1:-1);return 0},d.prototype.sort=function(a){if(!f.isArray(a))throw new Error("An array must be provided to sort.");return 0===this._order.length?a:a.sort(f.bind(this.compare,this))},d.prototype.determinePosition=function(a,b){if(0===this._order.length)return 1/0;for(var c,d=0,e=a.length-1,f=a.length,g=-1,h=0;g!==f-1;)h=Math.floor((d+e)/2),c=this.compare(a[h],b),0>=c?(g=h,d=h+1):(f=h,e=h-1);return f}},{"goinstant-common":64,lodash:69}],9:[function(){"use strict";Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1})},{}],10:[function(a,b,c){"use strict";var d=c;c.constructor=function(){};var e=a("lodash");e.noConflict(),a("./iefix");var f=a("goinstant-common").errors,Connection=a("./connection").Connection,g=a("./connect"),Room=a("./platform/room").Room,Key=a("./platform/key").Key,Channel=a("./platform/channel").Channel,Query=a("./platform/query").Query,h=a("./util/gi_window"),i=a("./version"),j=a("./config");d.Connection=Connection,d.connect=g.start,d.errors=f,d.Room=Room,d.Key=Key,d.Channel=Channel,d.Query=Query,d.VERSION=i.clientVersion,d.sharedConfig=j,h.isBrowser&&(window.goinstant=d)},{"./config":1,"./connect":2,"./connection":3,"./iefix":9,"./platform/channel":11,"./platform/key":12,"./platform/query":14,"./platform/room":16,"./util/gi_window":21,"./version":30,"goinstant-common":64,lodash:69}],11:[function(a,b,c){"use strict";function Channel(a,b){if(this._room=a,this.name=h.clean(b),null===this.name)throw new Error("Invalid channel name: "+b);this._emitter=new e}var d=c;c.constructor=function(){};var e=a("eventemitter2").EventEmitter2,f=a("lodash"),g=a("../util/validation"),h=a("goinstant-common").keyName,i=a("../util/resolver").Resolver;d.Channel=Channel,Channel.COMMANDS={message:"MESSAGE"},Channel.DEFAULT_COMMAND_OPTIONS={local:!0},Channel._Resolver=i,Channel.VALID_EVENTS=f.keys(Channel.COMMANDS),Channel.prototype.room=function(){return this._room},Channel.prototype._resolveOptionsAndCallback=function(a,b){return f.isPlainObject(a)?a=f.defaults(a,Channel.DEFAULT_COMMAND_OPTIONS):(b=b||a,a=Channel.DEFAULT_COMMAND_OPTIONS),{options:a,cb:b}},Channel.prototype.on=function(a,b,c){this._room._on(this.name,Channel.VALID_EVENTS,a,b,c)},Channel.prototype.off=function(a,b){var c={local:!1,bubble:!1};this._room._off(this.name,Channel.VALID_EVENTS,a,c,b)},Channel.prototype.message=function(a,b,c){var d;f.isUndefined(a)&&(d=new Error("Message cannot be undefined"));var e=this._resolveOptionsAndCallback(b,c);if(g.optionalCallback(e.cb)||(d=new Error("Callback should be a function or undefined")),d)return g.throwOrCallback(d,e.cb);var h=new Channel._Resolver(e.cb,this,["value","context"]),i=e.options;c=h.cb;var j={key:this.name,value:a,options:i};return this._room._request(Channel.COMMANDS.message,j,c),h.promise},Channel.prototype.equals=function(a){return a instanceof this.constructor?this.name!==a.name?!1:this._room.equals(a._room)?!0:!1:!1}},{"../util/resolver":24,"../util/validation":29,eventemitter2:58,"goinstant-common":64,lodash:69}],12:[function(a,b,c){"use strict";function Key(a,b){this._room=a,this.name=d(b),this._watchRegistry=new j}function d(a){var b=l.clean(a);if(null===b)throw new m.KeyNameError("Invalid key name: "+a);return b}function e(a,b){return i.optionalCallback(b)?void 0:"Key#"+a+" requires the callback to be a function if it is provided"}var f=c;c.constructor=function(){};var g=a("lodash"),h=a("../util/resolver").Resolver,i=a("../util/validation"),j=a("./watch_registry").WatchRegistry,Query=a("./query").Query,k=a("goinstant-common"),l=k.keyName,m=k.errors;f.Key=Key,Key.COMMANDS={get:"GET",set:"SET",remove:"REMOVE",add:"ADD"},Key.VALID_EVENTS=["set","remove","add"],Key.DEFAULT_COMMAND_OPTIONS={bubble:!0,local:!0},Key.DEFAULT_SET_OPTIONS={overwrite:!0},Key._Resolver=h,Key.prototype._childName=function(a){return this.name+d(a)},Key.prototype._parentName=function(){var a=this.name.split("/").slice(1,-1);return"/"+a.join("/")},Key.prototype.key=function(a){return new Key(this._room,this._childName(a))},Key.prototype.ot=function(){},Key.prototype.parent=function(){var a=this._parentName();return this.name==a?this:new Key(this._room,a)},Key.prototype.room=function(){return this._room},Key.prototype._sanitizeExpire=function(a){return g.has(a,"expire")?((null===a.expire||void 0===a.expire)&&delete a.expire,a):a},Key.prototype._resolveOptionsAndCallback=function(a,b){return g.isPlainObject(a)?a=g.defaults(a,Key.DEFAULT_COMMAND_OPTIONS):(b=b||a,a=Key.DEFAULT_COMMAND_OPTIONS),a=this._sanitizeExpire(a),{options:a,cb:b}},Key.prototype._cascade=function(a){a=g.isArray(a)?a:[a],a=g.map(a,function(a){return a instanceof Key?a.name:new Error("non-key")});var b=g.any(a,function(a){return a instanceof Error});return b?new Error("Non-key passed to cascade"):a},Key.prototype.set=function(a,b,c){if(g.isNull(a)||g.isUndefined(a))throw new Error("Key#set cannot be passed null or undefined. Use remove instead.");var d=this._resolveOptionsAndCallback(b,c),f=e("set",d.cb);if(f)throw new Error(f);var h=new Key._Resolver(d.cb,this,["value","context"]);if(b=d.options,c=h.cb,b=g.defaults(b,Key.DEFAULT_SET_OPTIONS),b.cascade&&(b.cascade=this._cascade(b.cascade),b.cascade instanceof Error))throw b.cascade;var i={key:this.name,value:a,options:b};return this._room._request(Key.COMMANDS.set,i,c),h.promise},Key.prototype.add=function(a,b,c){var d=this._resolveOptionsAndCallback(b,c),f=e("add",d.cb);if(f)throw new Error(f);var h=new Key._Resolver(d.cb,this,["value","context"]);if(b=d.options,c=h.cb,g.isNull(a)||g.isUndefined(a))throw new Error("Key#add cannot be passed null or undefined.");if(b.cascade&&(b.cascade=this._cascade(b.cascade),b.cascade instanceof Error))throw new Error(b.cascade);var i={key:this.name,value:a,options:b};return this._room._request(Key.COMMANDS.add,i,c),h.promise},Key.prototype.get=function(a,b){if(g.isFunction(a)&&(b=a,a={}),a&&!g.isPlainObject(a))throw new Error("if options are provided they must be a plain object");var c=e("get",b);if(c)throw new Error(c);var d=new Key._Resolver(b,this,["value","context"]);b=d.cb;var f={key:this.name};return this._room._request(Key.COMMANDS.get,f,b),d.promise},Key.prototype.remove=function(a,b){var c=this._resolveOptionsAndCallback(a,b),d=e("remove",c.cb);if(d)throw new Error(d);var f=new Key._Resolver(c.cb,this,["value","context"]);a=c.options,b=f.cb;var g={key:this.name,options:a};return this._room._request(Key.COMMANDS.remove,g,b),f.promise},Key.prototype.on=function(a,b,c){this._room._on(this.name,Key.VALID_EVENTS,a,b,c)},Key.prototype.off=function(a,b,c){this._room._off(this.name,Key.VALID_EVENTS,a,b,c)},Key.prototype.query=function(a,b){return new Query(this,a,b)},Key.prototype.equals=function(a){return a instanceof this.constructor?this.name!==a.name?!1:this._room.equals(a._room)?!0:!1:!1}},{"../util/resolver":24,"../util/validation":29,"./query":14,"./watch_registry":19,"goinstant-common":64,lodash:69}],13:[function(a,b,c){"use strict";function d(a,b,c){function e(a){var b=f.tandem.adapter.getContext();b.command=d.COMMANDS.update,f._emitter.emit(b.command.toLowerCase(),a,b);var c=k.deltaToApiOps(a);h.each(c,function(a){a instanceof k.InsertOp?b.command=d.COMMANDS.insert:a instanceof k.DeleteOp?b.command=d.COMMANDS["delete"]:a instanceof k.FormatOp&&(b.command=d.COMMANDS.format),f._emitter.emit(b.command.toLowerCase(),a,b)})}if(!m.optionalCallback(c))throw new Error("Callback must be a function.");var f=this;if(this.name=n.clean(b),null===this.name)throw new Error("Invalid OT name: "+b);this._room=a,this._emitter=new o;var g=new j(a,this.name);this.tandem=new l.Client("none",{network:g}),this.file=this.tandem.open(this.name,null,function(a){a&&(f.readError=a)}),g.setTandemFile(this.file),this.file.on(l.File.events.READY,function(){f.file.on(l.File.events.UPDATE,e)}),c&&this.get(c)}function e(a,b){var c=a.toLowerCase();if(h.isNull(b)||h.isUndefined(b))return"OT#"+c+" must be provided with an operation.";if(a===d.COMMANDS.insert&&!k.isInsertOp(b)||a===d.COMMANDS["delete"]&&!k.isDeleteOp(b)||a===d.COMMANDS.format&&!k.isFormatOp(b)||a===d.COMMANDS.update&&!l.Delta.isDelta(b)){var e;
return e=a===d.COMMANDS.update?"delta":"operation","OT#"+c+" must be provided with a valid "+e+"."}}function f(a,b){var c={command:a,room:b.room,userId:b.userId,version:b.value.version};return c}var g=c;c.constructor=function(){};var h=a("lodash"),i=a("../util/resolver").Resolver,j=a("../util/tandem_network_adapter").TandemNetworkAdapter,k=a("../util/tandem_delta_adapter"),l=a("../../node_modules/tandem/browser.bare"),m=a("../util/validation"),n=a("goinstant-common").keyName,o=a("eventemitter2").EventEmitter2;g.OT=d,d.COMMANDS={insert:"INSERT","delete":"DELETE",format:"FORMAT",update:"UPDATE"},d.VALID_EVENTS=["insert","delete","format","update"],d.prototype._handleOperation=function(a,b,c){var g=e(a,b);if(g)throw new Error(g);if(!m.optionalCallback(c))throw new Error("Callback must be a function.");var j,l=this,n=new i(c,this,["value","context"]),o=function(b,c){var d;(h.isNull(b)||h.isUndefined(b))&&(d=f(a,l.tandem.adapter.getContext())),n.cb(b||l.tandem.adapter.getError(),c,d)};if(a!=d.COMMANDS.update){var p=this.file,q=p.arrived.compose(p.inFlight).compose(p.inLine);j=k.apiOpToDelta(a,b,q)}else j=b;return this.file.update(j,o),n.promise},d.prototype.get=function(a){if(!m.optionalCallback(a))throw new Error("Callback must be a function");var b=new i(a,this,["value","context"]),c=null,d=this,e=function(){return d.readError?b.cb(d.readError,null,c):(c={command:"GET",room:d._room.name,userId:d._room._connection._user.id,version:d.file.version},void b.cb(null,l.Delta.makeDelta(d.file.arrived),c))};return this.readError||this.file.ready?e():this.file.on("file-open",function(){d.readError&&e()}).on("file-ready",e),b.promise},d.prototype.on=function(a,b){var c;if(h.isString(a)?m.isFunction(b)?m.contained(d.VALID_EVENTS,a)||(c="on: event passed: '"+a+"' is not one of "+d.VALID_EVENTS.join(", ")):c="on: listener must be a function":c="on: command passed must be a string",c)throw new Error(c);this._emitter.on(a,b)},d.prototype.off=function(a,b){h.isUndefined(a)&&(a=null),h.isUndefined(b)&&(b=null);var c=null;if(a&&!h.isString(a)?c="off: optional command must be a string":m.optionalCallback(b)?!a&&b?c="off: requires command if listener is passed":a&&!m.contained(d.VALID_EVENTS,a)&&(c="off: command passed: '"+a+"' is not one of "+d.VALID_EVENTS.join(", ")):c="off: optional listener must be a function",c)throw new Error(c);h.isNull(a)&&h.isNull(b)?this._emitter.removeAllListeners():h.isNull(b)?this._emitter.removeAllListeners(a):this._emitter.off(a,b)},d.prototype.insert=function(a,b){return this._handleOperation(d.COMMANDS.insert,a,b)},d.prototype.del=function(a,b){return this._handleOperation(d.COMMANDS["delete"],a,b)},d.prototype["delete"]=d.prototype.del,d.prototype.format=function(a,b){return this._handleOperation(d.COMMANDS.format,a,b)},d.prototype.update=function(a,b){return this._handleOperation(d.COMMANDS.update,a,b)}},{"../../node_modules/tandem/browser.bare":71,"../util/resolver":24,"../util/tandem_delta_adapter":26,"../util/tandem_network_adapter":27,"../util/validation":29,eventemitter2:58,"goinstant-common":64,lodash:69}],14:[function(a,b,c){"use strict";function Query(a,b,c){if(!g.isObject(a))throw new n.ArgumentError("Provided key must be an instance of Key");this._engine=new l(b,c||{}),this._key=a,this._registry={},this._data={},this._state=new j("NOT_INITIALIZED",{NOT_INITIALIZED:["INITIALIZING","DESTROYED"],INITIALIZING:["ERROR","HAS_CHILDREN","HAS_NO_CHILDREN","DESTROYED"],HAS_NO_CHILDREN:["ERROR","HAS_CHILDREN","DESTROYED"],HAS_CHILDREN:["ERROR","HAS_NO_CHILDREN","DESTROYED"],ERROR:["DESTROYED"],DESTROYED:[]}),this._emitter=new h}function d(a,b){var c=b.replace(a,"");return c.replace(/^\/|\/$/g,"")}function e(a,b){var c=d(a,b),e=c.split("/");return 0===e.length?null:e[0]}var f=c;c.constructor=function(){};var g=a("lodash"),h=a("eventemitter2").EventEmitter2,i=a("../util/validation"),j=a("../util/state_machine").StateMachine,k=a("../util/resolver").Resolver,l=a("../expression/engine").ExpressionEngine,m=a("goinstant-common"),n=m.errors,o=m.objUtil,p={change:!0,error:!0,add:!0,remove:!0,update:!0};f.Query=Query,Query._Resolver=k,Query.prototype.key=function(){return this._key},Query.prototype.on=function(a,b){if(!g.isString(a))throw new n.ArgumentError("The event must be a string");if(!p[a])throw new n.ArgumentError(a+" is not a valid event for a Query");if(!g.isFunction(b))throw new n.ArgumentError("A listener must be a function");this._emitter.on(a,b)},Query.prototype.off=function(a,b){if(!g.isUndefined(a)&&!g.isString(a))throw new n.ArgumentError("The event must be a string if supplied");if(!g.isUndefined(a)&&!p[a])throw new n.ArgumentError("The event must be a valid query event if supplied");if(!g.isUndefined(b)&&!g.isFunction(b))throw new n.ArgumentError("The listener must be a function if supplied");if(g.isUndefined(a)&&!g.isUndefined(b))throw new n.ArgumentError("You must provide an event if you provide a listener");return a&&b?this._emitter.removeListener(a,b):void this._emitter.removeAllListeners.apply(this._emitter,arguments)},Query.prototype.execute=function(a){if(!g.isUndefined(a)&&!g.isFunction(a))throw new n.ArgumentError("If a callback is provided it must be a function");var b=new Query._Resolver(a,this);if(a=b.cb,this._state.current!==this._state.states.NOT_INITIALIZED)return a(new n.DuplicateCallError("Query#execute can only be called once per query."));this._state.transition("INITIALIZING");var c=this;return c._get(function(b,d){if(b)return c._state.transition("ERROR"),a(b);if(c._state.current===c._state.states.DESTROYED)return a(new n.CouldNotCompleteError("Query#destroy called during Query#execute -- cannot complete execute"));c._registry={set:g.bind(c._handleUpdate,c),add:g.bind(c._handleUpdate,c),remove:g.bind(c._handleRemove,c)},g.each(c._registry,function(a,b){c._key.on(b,{local:!0,bubble:!0},a)});var e=g.isArray(d)&&0===g.size(d)?"HAS_NO_CHILDREN":"HAS_CHILDREN";c._state.transition(e),c._broadcast(c._engine.set(d,!0)),a(null,c._engine.get())}),b.promise},Query.prototype.get=function(a){if(!g.isUndefined(a)&&!g.isFunction(a))throw new n.ArgumentError("You must provide a function as a callback to Query#get");var b=new Query._Resolver(a,this);a=b.cb;var c=["ERROR","DESTROYED","NOT_INITIALIZED","INITIALIZING"];if(g.contains(c,this._state.current))return i.throwOrCallback(new n.NotInitializedError("Cannot call #get if #execute has not completed, or an error has occurred"),a);var d=this._engine.get();return g.defer(function(){a(null,d)}),b.promise},Query.prototype.destroy=function(){var a=this;g.each(this._registry,function(b,c){a._key.off(c,b)}),a._emitter.removeAllListeners(),a._engine=null,a._data=null,a._key=null,a._registry=null,a._state.transition("DESTROYED")},Query.prototype._get=function(a){var b=this;b._key.get(function(c,d){if(c)return a(c);if(null!==d&&(!g.isObject(d)||g.isArray(d)))return a(new n.NonLeafKeyError("Queries cannot occur on leaf-key's, the key must be a parent"));b._data=d||{};var e=b._mutate(b._data);a(null,e)})},Query.prototype._handleUpdate=function(a,b){if(g.contains(["HAS_CHILDREN","HAS_NO_CHILDREN"],this._state.current)){var c=b.addedKey?b.addedKey:b.key;if(!g.isPlainObject(a)&&b.currentKey===c)return this._emitter.emit("error",new n.NonLeafKeyError("Key["+c+"] has become a leaf-key, no-longer a queryable key"));g.isPlainObject(a)&&(a=g.cloneDeep(a)),a=this._normalize(a,b),g.merge(this._data,a),this._state.current===this._state.states.HAS_NO_CHILDREN&&this._state.transition("HAS_CHILDREN");var d=e(b.currentKey,c),f={name:d,value:o.pick(this._data,d)};this._broadcast(this._engine.update(f))}},Query.prototype._handleRemove=function(a,b){if(g.contains(["HAS_CHILDREN","HAS_NO_CHILDREN"],this._state.current)){var c;if(b.currentKey===b.key)return this._state.transition("HAS_NO_CHILDREN"),this._data={},c=this._engine.set([]),this._broadcast(c);var f=d(b.currentKey,b.key);try{this._data=o.remove(this._data,f,{clone:!0})}catch(h){if(h instanceof n.KeyNameError)return this._state.transition("ERROR"),this._emitter.emit("error",new n.SynchronizationError("Query has become out of sync with the current key value"));throw h}0===g.size(this._data)&&this._state.transition("HAS_NO_CHILDREN");var i=e(b.currentKey,b.key),j=o.pick(this._data,i),k={name:i,value:void 0===j?null:j};c=-1!==f.indexOf("/")&&void 0!==j?this._engine.update(k):this._engine.remove(k),this._broadcast(c)}},Query.prototype._normalize=function(a,b){if(!b.currentKey)throw new n.ArgumentError("invalid context provided");for(var c,d,e,f=b.addedKey?b.addedKey:b.key;f!==b.currentKey;)e=f.lastIndexOf("/"),c=f.slice(f.lastIndexOf("/")),c=c.replace("/",""),d={},d[c]=a,a=d,f=f.slice(0,e);return a},Query.prototype._mutate=function(a){if(!g.isObject(a)||g.isArray(a))throw new Error("Mutate requires an object");var b=[];return g.each(a,function(a,c){b.push({name:c,value:a})}),b},Query.prototype._broadcast=function(a){if(0!==a.length){for(var b,c=0;c<a.length;++c)b=a[c],this._emitter.emit(b.op,{name:b.name,value:b.value},{position:{current:b.position,previous:b.previousPosition},events:{current:c+1,total:a.length},event:b.op,child:b.name});this._emitter.emit("change",this._engine.get(),{event:"change"})}}},{"../expression/engine":4,"../util/resolver":24,"../util/state_machine":25,"../util/validation":29,eventemitter2:58,"goinstant-common":64,lodash:69}],15:[function(a,b,c){"use strict";function d(){this._rooms={}}var e=c;c.constructor=function(){};var f=a("lodash"),g=a("goinstant-common").objUtil,h=a("goinstant-common").registry.Registry,i=["JOIN","LEAVE"],j=["command","key","addedKey","value","room","userId","local","overwritten","expired","expire","cascaded","cascade"],k=["command","room","userId","version"];e.Registry=d,d.prototype.on=function(a,b){var c=a.room;this._rooms[c]||(this._rooms[c]=new h),this._rooms[c].add(a.key,a.command,b,a.opts)},d.prototype.off=function(a,b){var c=a.room,d=a.key,e=!1;return d?f.has(this._rooms,c)&&(e=this._rooms[c].remove(d,a.command,b,a.opts),this._rooms[c].isEmpty()&&delete this._rooms[c]):(e=!!this._rooms[c],delete this._rooms[c]),e},d.prototype.emit=function(a){if(this._rooms[a.room]){var b={bubble:a.options.bubble,local:a.local},c=this._rooms[a.room].get(a.key,a.command,b),d=c.direct.concat(c.parents);if(f.contains(i,a.command))return void f.invoke(d,"listener",a.value);var e=this;if("OT/UPDATE"===a.command){var h=f.pick(a,k);return void f.invoke(d,"listener",a.value,h)}f.each(c.children,function(b){if("REMOVE"!==a.command||"REMOVE"===b.action){var c=f.pick(a,j);if(c.key=b.key,c.targetKey=a.key,c.currentKey=b.key,c.bubble=!1,"REMOVE"===c.command)return c.value=null,b.listener(c.value,c);var d=b.key.replace(c.targetKey,""),h=g.pick(c.value,d);if("SET"===c.command&&void 0===h){if("REMOVE"!==b.action)return;c.command="REMOVE",c.value=null;var i=e._rooms[c.room].get(c.key,c.command,a);return void f.invoke(i.direct.concat(i.parents),"listener",c.value,c)}b.action===a.command&&(c.value=h,b.listener(c.value,c))}}),f.each(d,function(b){var c=f.pick(a,j);c.targetKey=a.key,c.currentKey=b.key,c.bubble=c.currentKey!==a.key,b.listener(c.value,c)})}},d.prototype.toArray=function(a){return this._rooms[a]?this._rooms[a].toArray():[]}},{"goinstant-common":64,lodash:69}],16:[function(a,b,c){"use strict";function Room(a,b){if(!e.isString(b)||!k.NAME_REGEX.test(b))throw new Error(q+" Invalid room: "+b);this.name=b,this._connection=a,this.users=this.key("/.users")}var d=c;c.constructor=function(){};var e=a("lodash"),f=a("async"),g=a("../util/resolver").Resolver,Channel=a("./channel").Channel,Key=a("./key").Key,h=a("./ot").OT,i=a("../util/validation"),j=a("goinstant-common"),k=j.constants,l=j.errors,m=l.NotMemberError,n=l.NotConnectedError,o=i.throwOrCallback,p="You must connect to GoInstant before you can perform operations on a key or room",q="Room"+k.NAME_RULES_ENGLISH;Room.VALID_EVENTS=["join","leave"],Room.COMMANDS={join:"JOIN",leave:"LEAVE"};var r={local:!1,bubble:!1},s={local:!0,bubble:!1},t=[!0,!1],u=["local","bubble","listener","lastValue"];d.Room=Room,Room._Resolver=g,Room.prototype.connection=function(){return this._connection},Room.prototype.join=function(a,b,c){function d(a){k._connection._joined(k),a()}function g(a){function b(a,b){return a?c(a):void c(null,k,b)}if(a)return c(a);var d=k.self();d.get({cached:!1},b)}if(e.isFunction(b)&&(c=b,b=null),e.isFunction(c)&&!e.isPlainObject(a)&&!e.isNull(a))throw new Error("userObject must be an object");if(e.isFunction(a)&&(c=a,a=null),e.isUndefined(c)&&(c=function(){}),b&&!e.isPlainObject(b))throw new Error("opts must be an object");var h=new Room._Resolver(c,k,["room","user"]);c=h.cb;var i={key:"/.users",options:e.cloneDeep(s)};if(b&&e.has(b,"visible")){if(!e.isBoolean(b.visible))throw new Error("opts.visible must be a boolean");i.options=e.merge({visible:b.visible},i.options)}var j=e.cloneDeep(this._connection._guestUserDefaults);j&&(i.options.user=j),a&&(i.options.user?e.merge(i.options.user,a):i.options.user=a);var k=this,l=[e.bind(this._request,this,Room.COMMANDS.join,i),d];return f.series(l,g),h.promise},Room.prototype.leave=function(a){var b=this;if(a||(a=function(){}),a&&!e.isFunction(a))throw new Error("callback must be a function");var c=new Room._Resolver(a,b);if(a=c.cb,!this._connection._socket)return o(new n(p),a);var d={key:"/.users",options:s};return this._request(Room.COMMANDS.leave,d,function(c,d,f){if(c)return a(c);if(b._connection._left(b),d){var g=e.cloneDeep(f||{});g.context=e.cloneDeep(f||{}),g.options={bubble:!1,local:!0},g.local=!0,b._connection._registry.emit(g)}b._off(),a()}),c.promise},Room.prototype.joined=function(){return this._connection._isJoined(this)},Room.prototype.user=function(a){if(!e.isString(a))throw new l.ArgumentError("You must pass a string for a userId");return this.key("/.users/"+a)},Room.prototype.self=function(){if(!this._connection._socket||!this._connection._user)throw new n(p);return this.user(this._connection._user.id)},Room.prototype.on=function(a,b,c){this._on("/.users",Room.VALID_EVENTS,a,b,c)},Room.prototype.off=function(a,b,c){this._off("/.users",Room.VALID_EVENTS,a,b,c)},Room.prototype.key=function(a){return new Key(this,a)},Room.prototype.ot=function(a,b){return new h(this,a,b)},Room.prototype.channel=function(a){return new Channel(this,a)},Room.prototype._request=function(a,b,c){if(!this._connection._socket)return o(new n(p),c);var d=["JOIN","LEAVE"],f=e.pluck(this._connection._joinedRooms,"name");if(!e.contains(d,a)&&!e.contains(f,this.name)){var g="You must join the room '"+this.name+"' before you can perform any operations on this key";return o(new m(g),c)}b.room=this.name,this._connection._request(a,b,c)},Room.prototype._on=function(a,b,c,d,f){function g(a){if(a.__wrapperFn)return a.__wrapperFn;var b=function(b,c){c&&(c.value=null),a(null,c)};return a.__wrapperFn=b,b}var h={};e.isFunction(d)?(f=d,d=null):d&&(d.listener&&(f=d.listener),h.local=d.local,h.bubble=d.bubble,d.lastValue&&(h.lastValue=!0)),e.defaults(h,r);var j;if(e.isString(c)?e.isString(a)?i.isFunction(f)?i.contained(b,c)?d&&!i.subset(e.keys(d),u)?j="on: options can only contain keys: "+u.join(",")+" but was passed keys: "+e.keys(d):i.subset(e.values(h),t)||(j="on: options.local, options.bubble, and options.lastValue must be booleans."):j="on: event passed: '"+c+"' is not one of "+b.join(", "):j="on: listener must be a function":j="on: key name passed must be a string":j="on: command passed must be a string",j)throw new Error(j);c=c.toUpperCase(),"REMOVE"!==c||h.lastValue||(f=g(f)),this._connection._on(this.name,a,c,h,f)},Room.prototype._off=function(a,b,c,d,f){e.isUndefined(a)&&(a=null),e.isUndefined(c)&&(c=null),e.isUndefined(d)&&(d=null),e.isUndefined(f)&&(f=null);var g=null;e.isFunction(d)?(f=d,d=null):e.isObject(d)&&(d.listener&&(f=d.listener),("local"in d||"bubble"in d)&&(g={},"local"in d&&(g.local=d.local),"bubble"in d&&(g.bubble=d.bubble)));var h,j=i.subset(e.values(g),t),k=i.contained(b,c);if(c&&!e.isString(c)?h="off: optional command must be a string":i.optionalCallback(f)?!c&&f?h="off: requires command if listener is passed":c&&!k?h="off: command passed: '"+c+"' is not one of "+b.join(", "):d&&!i.subset(e.keys(d),u)?h="off: options can only contain keys: "+u.join(", ")+" but was passed keys: "+e.keys(d):g&&!j&&(h="off: options.local and options.bubble must be booleans."):h="off: optional listener must be a function",h)throw new Error(h);c&&(c=c.toUpperCase()),f&&f.__wrapperFn&&(f=f.__wrapperFn),this._connection._off(this.name,a,c,d,f)},Room.prototype.equals=function(a){return a instanceof this.constructor?this.name===a.name:!1}},{"../util/resolver":24,"../util/validation":29,"./channel":11,"./key":12,"./ot":13,async:31,"goinstant-common":64,lodash:69}],17:[function(a,b,c){"use strict";function d(a){this._connection=a}var e=c;c.constructor=function(){};var f=a("lodash"),g=a("goinstant-common").errors,h=a("../util/resolver").Resolver,i=g.NotConnectedError,j="You must connect to Platform before you can perform operations on rooms";e.RoomCollection=d,d._Resolver=h,d.prototype.get=function(a){if(!this._connection._socket)return a(new i(j));if(a&&!f.isFunction(a))throw new Error("A callback if provided, must be a function.");var b=new d._Resolver(a,this);a=b.cb;var c=this;return this._connection._request("ROOMS",{},function(b,d){if(b)return a(b);var e=[];f.each(d,function(a){e.push(c._connection.room(a))}),a(null,e)}),b.promise}},{"../util/resolver":24,"goinstant-common":64,lodash:69}],18:[function(a,b,c){"use strict";function d(a){if(!h.isString(a.connectUrl))throw new m.ArgumentError("connectUrl must be a string");if(!h.isString(a.account))throw new m.ArgumentError("account must be a string");if(!h.isString(a.app))throw new m.ArgumentError("app must be a string");if(!h.isString(a.user)&&null!==a.user)throw new m.ArgumentError("user must be a jwt");if(!h.isString(a.version))throw new m.ArgumentError("version must be a string (semver)")}function e(a){d(a),h.isPlainObject(a.misc)||(a.misc={}),this.connectUrl=a.connectUrl,this.account=a.account,this.app=a.app,this.token=a.user,this.version=a.version,this._saveGuestId=!0,this.guestId=null,h.has(a.misc,"guestId")&&(this._saveGuestId=!1,this.guestId=a.misc.guestId),this._state=s,this.onlyPolling=!1,n.isBrowser&&(this.onlyPolling=h.some(q,function(a){return navigator.userAgent.indexOf(a)>-1})),a.misc.xhrOnly&&(this.onlyPolling=!0),this._sendAuth=null;var b=h.defaults({},a.misc.backoff,r);this._backoff=new k(b),this._cleanupBackoff=function(){},this._cleanupListeners=function(){},this._emitter=new j}var f=c;c.constructor=function(){};var g=a("engine.io-client"),h=a("lodash"),i=a("eventutil"),j=a("eventemitter2").EventEmitter2,k=a("../util/backoff").Backoff,l=a("../util/logging"),m=a("goinstant-common").errors,n=a("../util/gi_window"),o=0,p=700,q=["iPhone","Android","iPad"],r={startDelay:100,maxDelay:3e3,failAfter:20},s="disconnected",t="connecting",u="handshaking",v="connected",w="reconnecting",x="rehandshaking",y="disconnecting",z=0,A=1,B=2,C=1,D=3,E={};E[s]=[t],E[t]=[u,y,s],E[u]=[v,t,y],E[v]=[y,w],E[w]=[x,y,s],E[x]=[v,w,y],E[y]=[s];var F=l.get("platform/socket");f.Socket=e,e.prototype._transition=function(a){var b=E[this._state],c={prev:this._state,next:a};if(!h.contains(b,a))throw F.error("Invalid socket state transition",c),new Error('Cannot transition socket from "'+this._state+'" to "'+a+'"!');F.debug("Socket state transition",c),this._state=a},e._makeSocket=function(a,b){return g.Socket(a,b)},e.prototype.send=function(a){if(this._state===s)throw new m.ConnectionError("Socket is not connected (send)");var b;try{b=JSON.stringify(a)}catch(c){throw new m.ArgumentError("JSON Stringify Error: "+c.message)}this.eiSocket.send(b)},e.prototype.on=function(a,b){this._emitter.on(a,b)},e.prototype.off=function(a,b){this._emitter.off(a,b)},e.prototype.close=function(){function a(a){c._transition(s),c._emitter.emit("error",a)}function b(){c._transition(s),c._emitter.emit("disconnect")}this._transition(y),this._cleanup();var c=this;i.register(this.eiSocket,"!error",a,this.eiSocket,"!close",b),this.eiSocket.close(),this.eiSocket=null},e.prototype._getSocketOptions=function(){return{transports:this.onlyPolling?["polling"]:["polling","websocket"],query:{clientVersion:this.version},path:"/"+encodeURIComponent(this.account)+"/"+encodeURIComponent(this.app)}},e.prototype.connect=function(a){this._transition(t);var b=this._getSocketOptions();this._cleanupBackoff=i.register(this._backoff,"fail",h.bind(this._onRetryConnectFail,this),this._backoff,"finish",h.bind(this._retryConnect,this)),i.register(this._emitter,"!connect",h.bind(a,this,null),this._emitter,"!error",h.bind(a,this)),this.token?this.token.length>p?this._sendAuth=JSON.stringify(["AUTH",this.token]):b.query.jwt=this.token:b.query.guest=1;var c=this._getGuestId();c&&(b.query.gid=c),b.query.c=o++ +"-"+Math.floor(1e4*Math.random());try{this.eiSocket=e._makeSocket(this.connectUrl,b)}catch(d){return this._socketError("initiation failed")}this._backoff.reset(),this._cleanupListeners=i.register(this.eiSocket,"!error",h.bind(this._backoff.start,this._backoff),this.eiSocket,"!open",h.bind(this._handshaking,this))},e.prototype._getGuestId=function(){var a=this.guestId;if(this._saveGuestId)try{a=window.localStorage.getItem("giGuestId")}catch(b){}return a},e.prototype._setGuestId=function(a){if(this._saveGuestId)try{window.localStorage.setItem("giGuestId",a)}catch(b){}this.guestId=a,this.eiSocket.query.gid=a},e.prototype._onConnectMessage=function(a){var b;try{b=JSON.parse(a)}catch(c){return this._socketError("malformed message")}var d=b[z];if("ERROR"===d){var e=m.getByCode(b[B]);e||(e=Error);var f=new e(b[A]);return this._socketError(f)}if("USER"===d){var g=b[C];h.isString(b[D])&&this._setGuestId(b[D]),this._connected(g)}},e.prototype._socketError=function(a){var b="Could not connect: ";(this._state===w||this._state===x)&&(b="Could not reconnect: "),this._state===u||this._state===x?this.close():this._transition(s),a instanceof Error?a.message=b+a.message:a=b+a,F.error("Socket error",{err:a}),this._emitter.emit("error",a)},e.prototype._setupHandshake=function(a,b){function c(){d._transition(b),d._backoff.start()}this._transition(a),null!==this._sendAuth&&(F.debug("sending auth token message"),this.eiSocket.send(this._sendAuth));var d=this;this._cleanupListeners=i.register(this.eiSocket,"!close",c,this.eiSocket,"message",h.bind(this._onConnectMessage,this))},e.prototype._handshaking=function(){this._setupHandshake(u,t)},e.prototype._rehandshaking=function(){this._setupHandshake(x,w)},e.prototype._connected=function(a){function b(){c._transition(w),c._backoff.start(),c._emitter.emit("disconnect")}this._transition(v),this._backoff.reset();var c=this;this._cleanupListeners(),this._cleanupListeners=i.register(this.eiSocket,"!close",b,this.eiSocket,"message",h.bind(this._emitter.emit,this._emitter,"message")),this._emitter.emit("connect",a)},e.prototype._cleanup=function(){this._backoff.reset(),this._cleanupBackoff(),this._cleanupListeners()},e.prototype._onRetryConnectFail=function(){this._cleanup(),this._socketError("Maximum number of reconnect attempts reached.")},e.prototype._retryConnect=function(){var a;if(this._state===t)a=this._handshaking;else{if(this._state!==w)return this._socketError("Invalid state seen during retry");a=this._rehandshaking}this._cleanupListeners=i.register(this.eiSocket,"!error",h.bind(this._backoff.start,this._backoff),this.eiSocket,"!open",h.bind(a,this)),this.eiSocket.open()}},{"../util/backoff":20,"../util/gi_window":21,"../util/logging":23,"engine.io-client":36,eventemitter2:58,eventutil:59,"goinstant-common":64,lodash:69}],19:[function(a,b,c){"use strict";function d(){this._listeners=[]}var e=c;c.constructor=function(){};var f=a("lodash");e.WatchRegistry=d,d.prototype.add=function(a){var b=this._wrap(a);return this._listeners.push(b),b},d.prototype.remove=function(a){var b=this._indexOf(a),c=null;return b>=0&&(c=this._listeners[b],this._listeners.splice(b,1)),c},d.prototype.clear=function(){var a=this._listeners;return this._listeners=[],a},d.prototype._indexOf=function(a){return f.findIndex(this._listeners,{__wrapped:a})},d.prototype._wrap=function(a){var b=function(){var a=Array.prototype.slice.call(arguments);b.__wrapped.apply(this,a)};return b.__wrapped=a,b}},{lodash:69}],20:[function(a,b,c){"use strict";function d(a){this._failAfter=a&&a.failAfter||10,this._startDelay=a&&a.startDelay||100,this._maxDelay=a&&a.maxDelay||1e4,this._fibo1=1,this._fibo2=1,this._currentAttempt=1,this._timeOut=null,this._lastDelay=this._startDelay,this._emitter=new g}function e(a){if(!h.contains(i,a))throw new Error("Unknown event type: "+a)}var f=c;c.constructor=function(){};var g=a("eventemitter2").EventEmitter2,h=a("lodash"),i=["start","finish","fail"];f.Backoff=d,d.prototype.on=function(a,b){e(a),this._emitter.on(a,b)},d.prototype.off=function(a,b){e(a),this._emitter.off(a,b)},d.prototype.start=function(){if(this._currentAttempt>=this._failAfter)return this.reset(),void this._emitter.emit("fail");var a=this._fibonacci(),b=this._currentAttempt;this._currentAttempt++;var c=Math.min(this._startDelay*a,this._maxDelay);this._lastDelay=c,this._emitter.emit("start",b,c,this),this._timeOut=setTimeout(h.bind(function(){this._emitter.emit("finish",b,c,this)},this),c)},d.prototype.reset=function(){this._currentAttempt=1,this._fibo1=1,this._fibo2=1,this._timeOut&&(clearTimeout(this._timeOut),this._timeOut=null)},d.prototype._fibonacci=function(){if(this._currentAttempt<3)return 1;var a=this._fibo1+this._fibo2;return this._fibo1=this._fibo2,this._fibo2=a,a}},{eventemitter2:58,lodash:69}],21:[function(a,b,c){(function(a){"use strict";var b=c;c.constructor=function(){},b.isNode="undefined"==typeof window,b.isBrowser=!b.isNode,b.getWindow=function(){return b.isNode?a:window}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(a,b,c){"use strict";var d=c;c.constructor=function(){};var e=a("lodash"),f=a("./gi_window");d.one=function(a,b){if(!a)throw new Error("Attempted to guard a function that did not exist.");if(!e.isFunction(a))throw new Error("Attempted to guard a property that is not a function");if(!b)throw new Error("Context was not passed to guard");return function(){try{a.apply(b,arguments)}catch(c){f.getWindow().setTimeout(function(){throw c},0)}}},d.all=function(a,b){e.each(b,function(b){a[b]=d.one(a[b],a)})}},{"./gi_window":21,lodash:69}],23:[function(a,b,c){"use strict";function d(a){this.moduleName=a,f.bind(this.log,this),f.each(i,function(a){var b=g[a];this[a]=f.bind(this.log,this,b)},this)}var e=c;c.constructor=function(){};var f=a("lodash"),g={debug:0,verbose:1,info:2,warn:3,error:4},h=f.invert(g),i=f.keys(g);e.loggers={},e.raw=function(){},e.Logger=d,d.prototype.log=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d=f.isFunction(c)?b.pop():null;c=b[b.length-1];var g=f.isObject(c)&&!f.isArray(c)?b.pop():{},i=b.shift();e.raw(h[a]+": "+this.moduleName+": "+i,b,g),d&&d()},e.logger=function(a){return e.loggers[a]||(e.loggers[a]=new d(a)),e.loggers[a]},e.get=e.logger},{lodash:69}],24:[function(a,b,c){"use strict";function d(a,b,c){f.bindAll(this),this._deferred=d.Q.defer(),this._fn=a||function(){},this._context=b,this._keys=c,this.cb=this._lift,this.promise=this._deferred.promise}var e=c;c.constructor=function(){};var f=a("lodash"),g=a("q");d.Q=g,e.Resolver=d,d.prototype._lift=function(a){if(a)return this._conclude("reject",a,arguments);var b=f.toArray(arguments).slice(1);if(1===b.length&&this._keys)throw new Error("when a single arg is returned, no keys can be passed");if(1===b.length)return this._conclude("resolve",b[0],arguments);var c,d={};f.map(this._keys,function(a){return"..."===a.slice(-3)?(c=a.slice(0,a.length-3),void(d[c]=b)):void(d[a]=b.shift())}),this._conclude("resolve",d,arguments)},d.prototype._conclude=function(a,b,c){this._deferred[a](b),this._fn.apply(this._context,c)}},{lodash:69,q:70}],25:[function(a,b,c){"use strict";function d(a,b){if(!f.isString(a))throw new Error("The start state must be a string");if(!f.isObject(b))throw new Error("Must provide a fsm definition");if(f.size(b)<2)throw new Error("There must be two or more states");if(!b[a])throw new Error("Start state does not exist");var c=f.keys(b),d={};f.each(c,function(a){d[a]=a}),f.each(b,function(a){f.each(a,function(a){if(!f.contains(c,a))throw new Error("Unknown state: "+a)})}),this.states=d,this._fsm=b,this.current=a}var e=c;c.constructor=function(){};var f=a("lodash");e.StateMachine=d,d.prototype.transition=function(a){if(!f.isString(a))throw new Error("State must be a string");if(!this._fsm[a])throw new Error("Invalid state provided: "+a);if(!f.contains(this._fsm[this.current],a))throw new Error("Cannot transition from "+this.current+" to "+a);this.current=a}},{lodash:69}],26:[function(a,b,c){"use strict";function d(a,b,c){if(k.isUndefined(c)&&(c={}),this.index=a,this.text=b,this.attributes=k.clone(c),!g(this))throw new Error("Invalid InsertOp.")}function e(a,b){if(this.index=a,this.length=b,!h(this))throw new Error("Invalid DelteOp.")}function f(a,b,c){if(k.isUndefined(c)&&(c={}),this.index=a,this.length=b,this.attributes=k.clone(c),!i(this))throw new Error("Invalid FormatOp.")}function g(a){return a&&k.isNumber(a.index)&&k.isString(a.text)?a.attributes&&!k.isObject(a.attributes)?!1:!0:!1}function h(a){return a&&k.isNumber(a.index)&&k.isNumber(a.length)}function i(a){return a&&k.isNumber(a.index)&&k.isNumber(a.length)&&k.isObject(a.attributes)}var j=c;c.constructor=function(){};var k=a("lodash"),l=a("../../node_modules/tandem/browser.bare");j.COMMANDS={insert:"INSERT","delete":"DELETE",format:"FORMAT",update:"UPDATE"},d.prototype.isEqual=function(a){return a&&this.index===a.index&&this.text===a.text&&k.isEqual(a.attributes,this.attributes)},e.prototype.isEqual=function(a){return a&&this.index===a.index&&this.length===a.length},f.prototype.isEqual=function(a){return a&&this.index===a.index&&this.length===a.length&&k.isEqual(this.attributes,a.attributes)},j.InsertOp=d,j.DeleteOp=e,j.FormatOp=f,j.isInsertOp=g,j.isDeleteOp=h,j.isFormatOp=i,j.deltaToApiOps=function(a){var b=0,c=0,g=0,h=[],i=[],j=[],m=0;if(a instanceof l.Delta||(a=l.Delta.makeDelta(a)),k.each(a.ops,function(a){var n,o;if(l.Op.isInsert(a))n=new d(c,a.value,k.clone(a.attributes)),o=k.sortedIndex(h,n,"index"),h.splice(o,0,n);else if(l.Op.isRetain(a)){if(a.start>b){var p=a.start-b;n=new e(b-m,p),m+=p,i.push(n)}var q=a.attributes;k.isNull(q)||k.isUndefined(q)||k.isEmpty(q)||(n=new f(a.start,a.getLength(),k.clone(q)),o=k.sortedIndex(j,n,"index"),j.splice(o,0,n)),b=a.end}c+=a.getLength(),g++}),b<a.startLength){var n=a.startLength-b;i.push(new e(b-m,n)),m+=n}return j.concat(i).concat(h)},j.apiOpToDelta=function(a,b,c){return a===j.COMMANDS.insert?l.Delta.makeInsertDelta(c.endLength,b.index,b.text,b.attributes):a===j.COMMANDS["delete"]?l.Delta.makeDeleteDelta(c.endLength,b.index,b.length):a===j.COMMANDS.format?l.Delta.makeRetainDelta(c.endLength,b.index,b.length,b.attributes):void 0}},{"../../node_modules/tandem/browser.bare":71,lodash:69}],27:[function(a,b,c){"use strict";function d(a,b){this._room=a,this._name=b,h.Network.Adapter.call(this),this.setReady(),this.err=null,this.context=null}var e=c;c.constructor=function(){};var f=a("lodash"),g=a("util"),h=a("../../node_modules/tandem/browser.bare");g.inherits(d,h.Network.Adapter),d.events=h.Network.Adapter.events,e.TandemNetworkAdapter=d,d.prototype.listen=function(a,b){function c(a,c){d.context=c,b.call(d,a)}var d=this;return this._room._on(this._name,h.File.routes,a,c),this},d.prototype.send=function(a,b,c){var d=this,e=function(a,b,e){d.err=a,d.context=e,f.isObject(b)||(b={}),a&&(b.error=a),c(b)},g={ot:this._name,packet:b,fileId:this._name};this._room._request(a,g,e)},d.prototype.setTandemFile=function(a){this.file=a},d.prototype.getError=function(){var a=this.err;return this.err=null,a},d.prototype.getContext=function(){return this.context}},{"../../node_modules/tandem/browser.bare":71,lodash:69,util:35}],28:[function(a,b,c){"use strict";function d(a){this._emitter=new f,this._timeout=a,this._timer=null,this._timeouts=[],g.bindAll(this,"_handleExpiry")
}var e=c;c.constructor=function(){};var f=a("eventemitter2").EventEmitter2,g=a("lodash"),h=a("./gi_window");e.Timeouts=d,d.prototype.add=function(a){this._timeouts.push({item:a,when:+new Date+this._timeout}),1===this._timeouts.length&&this._start()},d.prototype.clear=function(a){var b=g.findIndex(this._timeouts,{item:a});if(-1!==b){var c=this._timeouts.splice(b,1)[0];this._timeouts.length<=0?this._stop():0===b&&this._timeouts[0].when!==c.when&&(this._stop(),this._start())}},d.prototype.on=function(a,b){this._emitter.on(a,b)},d.prototype.off=function(a,b){this._emitter.off(a,b)},d.prototype._start=function(){var a=+new Date,b=this._timeouts[0].when-a;this._timer=h.getWindow().setTimeout(this._handleExpiry,b)},d.prototype._stop=function(){h.getWindow().clearTimeout(this._timer),this._timer=null},d.prototype._handleExpiry=function(){for(var a=this._timeouts[0].when;this._timeouts.length>0&&this._timeouts[0].when===a;){var b=this._timeouts.shift();this._emitter.emit("expiry",b.item)}this._timeouts.length>0&&this._start()}},{"./gi_window":21,eventemitter2:58,lodash:69}],29:[function(a,b,c){"use strict";var d=c;c.constructor=function(){};var e=a("lodash");d.optionalCallback=function(a){return e.isUndefined(a)||e.isNull(a)||e.isFunction(a)},d.requiredCallback=function(a){return!(!a||!e.isFunction(a))},d.contained=function(a,b){return e.contains(a,b)},d.subset=function(a,b){var c=e.difference(a,b);return 0===c.length},d.isFunction=function(a){return e.isFunction(a)},d.throwOrCallback=function(a,b){if(!e.isFunction(b))throw a;b(a)}},{lodash:69}],30:[function(a,b,c){"use strict";var d=c;c.constructor=function(){},d.clientVersion="1.25.14"},{}],31:[function(a,b){(function(a){!function(){function c(a){var b=!1;return function(){if(b)throw new Error("Callback was already called.");b=!0,a.apply(d,arguments)}}var d,e,f={};d=this,null!=d&&(e=d.async),f.noConflict=function(){return d.async=e,f};var g=Object.prototype.toString,h=Array.isArray||function(a){return"[object Array]"===g.call(a)},i=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},j=function(a,b){if(a.map)return a.map(b);var c=[];return i(a,function(a,d,e){c.push(b(a,d,e))}),c},k=function(a,b,c){return a.reduce?a.reduce(b,c):(i(a,function(a,d,e){c=b(c,a,d,e)}),c)},l=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!=typeof a&&a.nextTick?(f.nextTick=a.nextTick,f.setImmediate="undefined"!=typeof setImmediate?function(a){setImmediate(a)}:f.nextTick):"function"==typeof setImmediate?(f.nextTick=function(a){setImmediate(a)},f.setImmediate=f.nextTick):(f.nextTick=function(a){setTimeout(a,0)},f.setImmediate=f.nextTick),f.each=function(a,b,d){function e(b){b?(d(b),d=function(){}):(f+=1,f>=a.length&&d())}if(d=d||function(){},!a.length)return d();var f=0;i(a,function(a){b(a,c(e))})},f.forEach=f.each,f.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c():e())})};e()},f.forEachSeries=f.eachSeries,f.eachLimit=function(a,b,c,d){var e=m(b);e.apply(null,[a,c,d])},f.forEachLimit=f.eachLimit;var m=function(a){return function(b,c,d){if(d=d||function(){},!b.length||0>=a)return d();var e=0,f=0,g=0;!function h(){if(e>=b.length)return d();for(;a>g&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})}()}},n=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.each].concat(b))}},o=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[m(a)].concat(c))}},p=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.eachSeries].concat(b))}},q=function(a,b,c,d){if(b=j(b,function(a,b){return{index:b,value:a}}),d){var e=[];a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})}else a(b,function(a,b){c(a.value,function(a){b(a)})})};f.map=n(q),f.mapSeries=p(q),f.mapLimit=function(a,b,c,d){return r(b)(a,c,d)};var r=function(a){return o(a,q)};f.reduce=function(a,b,c,d){f.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){d(a,b)})},f.inject=f.reduce,f.foldl=f.reduce,f.reduceRight=function(a,b,c,d){var e=j(a,function(a){return a}).reverse();f.reduce(e,b,c,d)},f.foldr=f.reduceRight;var s=function(a,b,c,d){var e=[];b=j(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(){d(j(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.filter=n(s),f.filterSeries=p(s),f.select=f.filter,f.selectSeries=f.filterSeries;var t=function(a,b,c,d){var e=[];b=j(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(){d(j(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.reject=n(t),f.rejectSeries=p(t);var u=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(){d()})};f.detect=n(u),f.detectSeries=p(u),f.some=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(){c(!1)})},f.any=f.some,f.every=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(){c(!0)})},f.all=f.every,f.sortBy=function(a,b,c){f.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);var d=function(a,b){var c=a.criteria,d=b.criteria;return d>c?-1:c>d?1:0};c(null,j(b.sort(d),function(a){return a.value}))})},f.auto=function(a,b){b=b||function(){};var c=l(a),d=c.length;if(!d)return b();var e={},g=[],j=function(a){g.unshift(a)},m=function(a){for(var b=0;b<g.length;b+=1)if(g[b]===a)return void g.splice(b,1)},n=function(){d--,i(g.slice(0),function(a){a()})};j(function(){if(!d){var a=b;b=function(){},a(null,e)}}),i(c,function(c){var d=h(a[c])?a[c]:[a[c]],g=function(a){var d=Array.prototype.slice.call(arguments,1);if(d.length<=1&&(d=d[0]),a){var g={};i(l(e),function(a){g[a]=e[a]}),g[c]=d,b(a,g),b=function(){}}else e[c]=d,f.setImmediate(n)},o=d.slice(0,Math.abs(d.length-1))||[],p=function(){return k(o,function(a,b){return a&&e.hasOwnProperty(b)},!0)&&!e.hasOwnProperty(c)};if(p())d[d.length-1](g,e);else{var q=function(){p()&&(m(q),d[d.length-1](g,e))};j(q)}})},f.retry=function(a,b,c){var d=5,e=[];"function"==typeof a&&(c=b,b=a,a=d),a=parseInt(a,10)||d;var g=function(d,g){for(var h=function(a,b){return function(c){a(function(a,d){c(!a||b,{err:a,result:d})},g)}};a;)e.push(h(b,!(a-=1)));f.series(e,function(a,b){b=b[b.length-1],(d||c)(b.err,b.result)})};return c?g():g},f.waterfall=function(a,b){if(b=b||function(){},!h(a)){var c=new Error("First argument to waterfall must be an array of functions");return b(c)}if(!a.length)return b();var d=function(a){return function(c){if(c)b.apply(null,arguments),b=function(){};else{var e=Array.prototype.slice.call(arguments,1),g=a.next();e.push(g?d(g):b),f.setImmediate(function(){a.apply(null,e)})}}};d(f.iterator(a))()};var v=function(a,b,c){if(c=c||function(){},h(b))a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(l(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};f.parallel=function(a,b){v({map:f.map,each:f.each},a,b)},f.parallelLimit=function(a,b,c){v({map:r(b),each:m(b)},a,c)},f.series=function(a,b){if(b=b||function(){},h(a))f.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};f.eachSeries(l(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},f.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},f.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var w=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};f.concat=n(w),f.concatSeries=p(w),f.whilst=function(a,b,c){a()?b(function(d){return d?c(d):void f.whilst(a,b,c)}):c()},f.doWhilst=function(a,b,c){a(function(d){if(d)return c(d);var e=Array.prototype.slice.call(arguments,1);b.apply(null,e)?f.doWhilst(a,b,c):c()})},f.until=function(a,b,c){a()?c():b(function(d){return d?c(d):void f.until(a,b,c)})},f.doUntil=function(a,b,c){a(function(d){if(d)return c(d);var e=Array.prototype.slice.call(arguments,1);b.apply(null,e)?c():f.doUntil(a,b,c)})},f.queue=function(a,b){function d(a,b,c,d){return a.started||(a.started=!0),h(b)||(b=[b]),0==b.length?f.setImmediate(function(){a.drain&&a.drain()}):void i(b,function(b){var e={data:b,callback:"function"==typeof d?d:null};c?a.tasks.unshift(e):a.tasks.push(e),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),f.setImmediate(a.process)})}void 0===b&&(b=1);var e=0,g={tasks:[],concurrency:b,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(a,b){d(g,a,!1,b)},kill:function(){g.drain=null,g.tasks=[]},unshift:function(a,b){d(g,a,!0,b)},process:function(){if(!g.paused&&e<g.concurrency&&g.tasks.length){var b=g.tasks.shift();g.empty&&0===g.tasks.length&&g.empty(),e+=1;var d=function(){e-=1,b.callback&&b.callback.apply(b,arguments),g.drain&&g.tasks.length+e===0&&g.drain(),g.process()},f=c(d);a(b.data,f)}},length:function(){return g.tasks.length},running:function(){return e},idle:function(){return g.tasks.length+e===0},pause:function(){g.paused!==!0&&(g.paused=!0,g.process())},resume:function(){g.paused!==!1&&(g.paused=!1,g.process())}};return g},f.priorityQueue=function(a,b){function c(a,b){return a.priority-b.priority}function d(a,b,c){for(var d=-1,e=a.length-1;e>d;){var f=d+(e-d+1>>>1);c(b,a[f])>=0?d=f:e=f-1}return d}function e(a,b,e,g){return a.started||(a.started=!0),h(b)||(b=[b]),0==b.length?f.setImmediate(function(){a.drain&&a.drain()}):void i(b,function(b){var h={data:b,priority:e,callback:"function"==typeof g?g:null};a.tasks.splice(d(a.tasks,h,c)+1,0,h),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),f.setImmediate(a.process)})}var g=f.queue(a,b);return g.push=function(a,b,c){e(g,a,b,c)},delete g.unshift,g},f.cargo=function(a,b){var c=!1,d=[],e={tasks:d,payload:b,saturated:null,empty:null,drain:null,drained:!0,push:function(a,c){h(a)||(a=[a]),i(a,function(a){d.push({data:a,callback:"function"==typeof c?c:null}),e.drained=!1,e.saturated&&d.length===b&&e.saturated()}),f.setImmediate(e.process)},process:function g(){if(!c){if(0===d.length)return e.drain&&!e.drained&&e.drain(),void(e.drained=!0);var f="number"==typeof b?d.splice(0,b):d.splice(0,d.length),h=j(f,function(a){return a.data});e.empty&&e.empty(),c=!0,a(h,function(){c=!1;var a=arguments;i(f,function(b){b.callback&&b.callback.apply(null,a)}),g()})}},length:function(){return d.length},running:function(){return c}};return e};var x=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(b?console.error&&console.error(b):console[a]&&i(c,function(b){console[a](b)}))}]))}};f.log=x("log"),f.dir=x("dir"),f.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),g=e.pop(),h=b.apply(null,e);h in c?f.nextTick(function(){g.apply(null,c[h])}):h in d?d[h].push(g):(d[h]=[g],a.apply(null,e.concat([function(){c[h]=arguments;var a=d[h];delete d[h];for(var b=0,e=a.length;e>b;b++)a[b].apply(null,arguments)}])))};return e.memo=c,e.unmemoized=a,e},f.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},f.times=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.map(d,b,c)},f.timesSeries=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.mapSeries(d,b,c)},f.seq=function(){var a=arguments;return function(){var b=this,c=Array.prototype.slice.call(arguments),d=c.pop();f.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){d.apply(b,[a].concat(c))})}},f.compose=function(){return f.seq.apply(null,Array.prototype.reverse.call(arguments))};var y=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};f.applyEach=n(y),f.applyEachSeries=p(y),f.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},"undefined"!=typeof b&&b.exports?b.exports=f:"undefined"!=typeof define&&define.amd?define([],function(){return f}):d.async=f}()}).call(this,a("FWaASH"))},{FWaASH:33}],32:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],33:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],34:[function(a,b){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],35:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a){return a}function h(a){var b={};return a.forEach(function(a){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)f.push(F(b,String(g))?m(a,b,c,d,String(g),!0):"");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("FWaASH"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":34,FWaASH:33,inherits:32}],36:[function(a,b){b.exports=a("./lib/")},{"./lib/":38}],37:[function(a,b){var c=a("emitter");b.exports=c,c.prototype.addEventListener=c.prototype.on,c.prototype.removeEventListener=c.prototype.off,c.prototype.removeListener=c.prototype.off},{emitter:50}],38:[function(a,b){b.exports=a("./socket"),b.exports.parser=a("engine.io-parser")},{"./socket":39,"engine.io-parser":51}],39:[function(a,b){function c(a,b){if(!(this instanceof c))return new c(a,b);if(b=b||{},"object"==typeof a&&(b=a,a=null),a&&(a=e.parseUri(a),b.host=a.host,b.secure="https"==a.protocol||"wss"==a.protocol,b.port=a.port,a.query&&(b.query=a.query)),this.secure=null!=b.secure?b.secure:k.location&&"https:"==location.protocol,b.host){var d=b.host.split(":");b.hostname=d.shift(),d.length&&(b.port=d.pop())}this.agent=b.agent||!1,this.hostname=b.hostname||(k.location?location.hostname:"localhost"),this.port=b.port||(k.location&&location.port?location.port:this.secure?443:80),this.query=b.query||{},"string"==typeof this.query&&(this.query=e.qsParse(this.query)),this.upgrade=!1!==b.upgrade,this.path=(b.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!b.forceJSONP,this.timestampParam=b.timestampParam||"t",this.timestampRequests=!!b.timestampRequests,this.flashPath=b.flashPath||"",this.transports=b.transports||["polling","websocket","flashsocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=b.policyPort||843,this.open(),c.sockets.push(this),c.sockets.evs.emit("add",this)}function d(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var e=a("./util"),f=a("./transports"),g=a("./emitter"),h=a("debug")("engine.io-client:socket"),i=a("indexof"),j=a("engine.io-parser");b.exports=c;var k=a("global");g(c.prototype),c.protocol=j.protocol,c.sockets=[],c.sockets.evs=new g,c.Socket=c,c.Transport=a("./transport"),c.Emitter=a("./emitter"),c.transports=a("./transports"),c.util=a("./util"),c.parser=a("engine.io-parser"),c.prototype.createTransport=function(a){h('creating transport "%s"',a);var b=d(this.query);b.EIO=j.protocol,b.transport=a,this.id&&(b.sid=this.id);var c=new f[a]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:b,forceJSONP:this.forceJSONP,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,flashPath:this.flashPath,policyPort:this.policyPort});return c},c.prototype.open=function(){this.readyState="opening";var a=this.createTransport(this.transports[0]);a.open(),this.setTransport(a)},c.prototype.setTransport=function(a){var b=this;this.transport&&(h("clearing existing transport"),this.transport.removeAllListeners()),this.transport=a,a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})},c.prototype.probe=function(a){function b(b){if(!d){d=!0;var f=new Error("probe error: "+b);f.transport=c.name,c.close(),c=null,h('probe transport "%s" failed because of error: %s',a,b),e.emit("error",f)}}h('probing transport "%s"',a);var c=this.createTransport(a,{probe:1}),d=!1,e=this;c.once("open",function(){d||(h('probe transport "%s" opened',a),c.send([{type:"ping",data:"probe"}]),c.once("packet",function(f){if(!d)if("pong"==f.type&&"probe"==f.data)h('probe transport "%s" pong',a),e.upgrading=!0,e.emit("upgrading",c),h('pausing current transport "%s"',e.transport.name),e.transport.pause(function(){d||"closed"!=e.readyState&&"closing"!=e.readyState&&(h("changing transport and sending upgrade packet"),c.removeListener("error",b),e.emit("upgrade",c),e.setTransport(c),c.send([{type:"upgrade"}]),c=null,e.upgrading=!1,e.flush())});else{h('probe transport "%s" failed',a);var g=new Error("probe error");g.transport=c.name,e.emit("error",g)}}))}),c.once("error",b),c.open(),this.once("close",function(){c&&(h("socket closed prematurely - aborting probe"),d=!0,c.close(),c=null)}),this.once("upgrading",function(a){c&&a.name!=c.name&&(h('"%s" works - aborting "%s"',a.name,c.name),c.close(),c=null)})},c.prototype.onOpen=function(){if(h("socket open"),this.readyState="open",this.emit("open"),this.onopen&&this.onopen.call(this),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){h("starting upgrade probes");for(var a=0,b=this.upgrades.length;b>a;a++)this.probe(this.upgrades[a])}},c.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(h('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case"open":this.onHandshake(e.parseJSON(a.data));break;case"pong":this.setPing();break;case"error":var b=new Error("server error");b.code=a.data,this.emit("error",b);break;case"message":this.emit("data",a.data),this.emit("message",a.data);var c={data:a.data};c.toString=function(){return a.data},this.onmessage&&this.onmessage.call(this,c)}else h('packet received with socket readyState "%s"',this.readyState)},c.prototype.onHandshake=function(a){this.emit("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.onOpen(),this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat)},c.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!=b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)},c.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer),a.pingIntervalTimer=setTimeout(function(){h("writing ping packet - expecting pong within %sms",a.pingTimeout),a.ping(),a.onHeartbeat(a.pingTimeout)},a.pingInterval)},c.prototype.ping=function(){this.sendPacket("ping")},c.prototype.onDrain=function(){for(var a=0;a<this.prevBufferLen;a++)this.callbackBuffer[a]&&this.callbackBuffer[a]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},c.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(h("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},c.prototype.write=c.prototype.send=function(a,b){return this.sendPacket("message",a,b),this},c.prototype.sendPacket=function(a,b,c){var d={type:a,data:b};this.emit("packetCreate",d),this.writeBuffer.push(d),this.callbackBuffer.push(c),this.flush()},c.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.onClose("forced close"),h("socket closing - telling transport to close"),this.transport.close()),this},c.prototype.onError=function(a){h("socket error %j",a),this.emit("error",a),this.onerror&&this.onerror.call(this,a),this.onClose("transport error",a)},c.prototype.onClose=function(a,b){if("opening"==this.readyState||"open"==this.readyState){h('socket close with reason: "%s"',a);var c=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){c.writeBuffer=[],c.callbackBuffer=[],c.prevBufferLen=0},0),this.transport.removeAllListeners();var d=this.readyState;this.readyState="closed",this.id=null,"open"==d&&(this.emit("close",a,b),this.onclose&&this.onclose.call(this))}},c.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;d>c;c++)~i(this.transports,a[c])&&b.push(a[c]);return b}},{"./emitter":37,"./transport":40,"./transports":42,"./util":47,debug:49,"engine.io-parser":51,global:54,indexof:56}],40:[function(a,b){function c(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1}var d=(a("./util"),a("engine.io-parser")),e=a("./emitter");b.exports=c,e(c.prototype),c.prototype.onError=function(a,b){var c=new Error(a);return c.type="TransportError",c.description=b,this.emit("error",c),this},c.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},c.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},c.prototype.send=function(a){if("open"!=this.readyState)throw new Error("Transport not open");this.write(a)},c.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},c.prototype.onData=function(a){this.onPacket(d.decodePacket(a))},c.prototype.onPacket=function(a){this.emit("packet",a)},c.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"./emitter":37,"./util":47,"engine.io-parser":51}],41:[function(a,b){function c(a){f.call(this,a),this.flashPath=a.flashPath,this.policyPort=a.policyPort}function d(a,b){if(k[a])return b();var c=document.createElement("script"),d=!1;h('loading "%s"',a),c.onload=c.onreadystatechange=function(){if(!d&&!k[a]){var e=c.readyState;e&&"loaded"!=e&&"complete"!=e||(h('loaded "%s"',a),c.onload=c.onreadystatechange=null,d=!0,k[a]=!0,b())}},c.async=1,c.src=a;var e=document.getElementsByTagName("head")[0];e.insertBefore(c,e.firstChild)}function e(a,b){function c(e){return a[e]?void d(a[e],function(){c(++e)}):b()}c(0)}var f=a("./websocket"),g=a("../util"),h=a("debug")("engine.io-client:flashsocket");b.exports=c;var i=a("global"),j=i[["Active"].concat("Object").join("X")];g.inherits(c,f),c.prototype.name="flashsocket",c.prototype.doOpen=function(){function a(a){return function(){var b=Array.prototype.join.call(arguments," ");h("[websocketjs %s] %s",a,b)}}if(this.check()){WEB_SOCKET_LOGGER={log:a("debug"),error:a("error")},WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,"undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=this.flashPath+"WebSocketMainInsecure.swf");var b=[this.flashPath+"web_socket.js"];"undefined"==typeof swfobject&&b.unshift(this.flashPath+"swfobject.js");var c=this;e(b,function(){c.ready(function(){WebSocket.__addTask(function(){c.socket=new WebSocket(c.uri()),c.addEventListeners()})})})}},c.prototype.doClose=function(){if(this.socket){var a=this;WebSocket.__addTask(function(){f.prototype.doClose.call(a)})}},c.prototype.write=function(){var a=this,b=arguments;WebSocket.__addTask(function(){f.prototype.write.apply(a,b)})},c.prototype.ready=function(a){function b(){c.loaded||(843!=d.policyPort&&WebSocket.loadFlashPolicyFile("xmlsocket://"+d.hostname+":"+d.policyPort),WebSocket.__initialize(),c.loaded=!0),a.call(d)}if("undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject&&!(swfobject.getFlashPlayerVersion().major<10)){var d=this;return document.body?b():void g.load(b)}},c.prototype.check=function(){if("undefined"==typeof window)return!1;if("undefined"!=typeof WebSocket&&!("__initialize"in WebSocket))return!1;if(j){var a=null;try{a=new j("ShockwaveFlash.ShockwaveFlash")}catch(b){}if(a)return!0}else for(var c=0,d=navigator.plugins.length;d>c;c++)for(var e=0,f=navigator.plugins[c].length;f>e;e++)if("Shockwave Flash"==navigator.plugins[c][e].description)return!0;return!1};var k={}},{"../util":47,"./websocket":46,debug:49,global:54}],42:[function(a,b,c){function d(a){var b,c=!1,d=!1;
if(j.location){var g="https:"==location.protocol,h=location.port;h||(h=g?443:80),c=a.hostname!=location.hostname||h!=a.port,d=a.secure!=g}return b=i.request(c,a),d&&j.XDomainRequest&&b instanceof j.XDomainRequest?new f(a):b&&!a.forceJSONP?new e(a):new f(a)}var e=a("./polling-xhr"),f=a("./polling-jsonp"),g=a("./websocket"),h=a("./flashsocket"),i=a("../util");c.polling=d,c.websocket=g,c.flashsocket=h;var j=a("global")},{"../util":47,"./flashsocket":41,"./polling-jsonp":43,"./polling-xhr":44,"./websocket":46,global:54}],43:[function(a,b){function c(a){d.call(this,a),f||(g.___eio||(g.___eio=[]),f=g.___eio),this.index=f.length;var b=this;f.push(function(a){b.onData(a)}),this.query.j=this.index}var d=a("./polling"),e=a("../util");b.exports=c;var f,g=a("global"),h=/\n/g;e.inherits(c,d),c.prototype.doOpen=function(){var a=this;e.defer(function(){d.prototype.doOpen.call(a)})},c.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),d.prototype.doClose.call(this)},c.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),b.async=!0,b.src=this.uri(),b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c),this.script=b,e.ua.gecko&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},c.prototype.doWrite=function(a,b){function c(){d(),b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(a){e.onError("jsonp polling iframe removal error",a)}try{var b='<iframe src="javascript:0" name="'+e.iframeId+'">';f=document.createElement(b)}catch(a){f=document.createElement("iframe"),f.name=e.iframeId,f.src="javascript:0"}f.id=e.iframeId,e.form.appendChild(f),e.iframe=f}var e=this;if(!this.form){var f,g=document.createElement("form"),i=document.createElement("textarea"),j=this.iframeId="eio_iframe_"+this.index;g.className="socketio",g.style.position="absolute",g.style.top="-1000px",g.style.left="-1000px",g.target=j,g.method="POST",g.setAttribute("accept-charset","utf-8"),i.name="d",g.appendChild(i),document.body.appendChild(g),this.form=g,this.area=i}this.form.action=this.uri(),d(),this.area.value=a.replace(h,"\\n");try{this.form.submit()}catch(k){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c}},{"../util":47,"./polling":45,global:54}],44:[function(a,b){function c(){}function d(a){if(f.call(this,a),j.location){var b="https:"==location.protocol,c=location.port;c||(c=b?443:80),this.xd=a.hostname!=j.location.hostname||c!=a.port}}function e(a){this.method=a.method||"GET",this.uri=a.uri,this.xd=!!a.xd,this.async=!1!==a.async,this.data=void 0!=a.data?a.data:null,this.agent=a.agent,this.create()}var f=a("./polling"),g=a("../util"),h=a("../emitter"),i=a("debug")("engine.io-client:polling-xhr");b.exports=d,b.exports.Request=e;var j=a("global"),k=j[["Active"].concat("Object").join("X")];g.inherits(d,f),d.prototype.doOpen=function(){var a=this;g.defer(function(){f.prototype.doOpen.call(a)})},d.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.agent=this.agent||!1,new e(a)},d.prototype.doWrite=function(a,b){var c=this.request({method:"POST",data:a}),d=this;c.on("success",b),c.on("error",function(a){d.onError("xhr post error",a)}),this.sendXhr=c},d.prototype.doPoll=function(){i("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)}),a.on("error",function(a){b.onError("xhr poll error",a)}),this.pollXhr=a},h(e.prototype),e.prototype.create=function(){var a=this.xhr=g.request(this.xd,{agent:this.agent}),b=this;if(a.open(this.method,this.uri,this.async),"POST"==this.method)try{a.setRequestHeader?a.setRequestHeader("Content-type","text/plain;charset=UTF-8"):a.contentType="text/plain"}catch(d){}this.xd&&j.XDomainRequest&&a instanceof XDomainRequest?(a.onerror=function(a){b.onError(a)},a.onload=function(){b.onData(a.responseText)},a.onprogress=c):("withCredentials"in a&&(a.withCredentials=!0),a.onreadystatechange=function(){var c;try{if(4!=a.readyState)return;200==a.status||1223==a.status?c=a.responseText:b.onError(a.status)}catch(d){b.onError(d)}void 0!==c&&b.onData(c)}),i("sending xhr with url %s | data %s",this.uri,this.data);try{a.send(this.data)}catch(d){return void setTimeout(function(){b.onError(d)},0)}k&&(this.index=e.requestsCount++,e.requests[this.index]=this)},e.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},e.prototype.onData=function(a){this.emit("data",a),this.onSuccess()},e.prototype.onError=function(a){this.emit("error",a),this.cleanup()},e.prototype.cleanup=function(){if("undefined"!=typeof this.xhr){this.xhr.onreadystatechange=c,this.xhr.onload=this.xhr.onerror=c;try{this.xhr.abort()}catch(a){}k&&delete e.requests[this.index],this.xhr=null}},e.prototype.abort=function(){this.cleanup()},k&&(e.requestsCount=0,e.requests={},j.attachEvent("onunload",function(){for(var a in e.requests)e.requests.hasOwnProperty(a)&&e.requests[a].abort()}))},{"../emitter":37,"../util":47,"./polling":45,debug:49,global:54}],45:[function(a,b){function c(a){d.call(this,a)}var d=a("../transport"),e=a("../util"),f=a("engine.io-parser"),g=a("debug")("engine.io-client:polling");b.exports=c;var h=a("global");e.inherits(c,d),c.prototype.name="polling",c.prototype.doOpen=function(){this.poll()},c.prototype.pause=function(a){function b(){g("paused"),c.readyState="paused",a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var d=0;this.polling&&(g("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){g("pre-pause polling complete"),--d||b()})),this.writable||(g("we are currently writing - waiting to pause"),d++,this.once("drain",function(){g("pre-pause writing complete"),--d||b()}))}else b()},c.prototype.poll=function(){g("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},c.prototype.onData=function(a){var b=this;g("polling got data %s",a),f.decodePayload(a,function(a){return"opening"==b.readyState&&b.onOpen(),"close"==a.type?(b.onClose(),!1):void b.onPacket(a)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():g('ignoring poll - transport state "%s"',this.readyState))},c.prototype.doClose=function(){function a(){g("writing close packet"),b.write([{type:"close"}])}var b=this;"open"==this.readyState?(g("transport open - closing"),a()):(g("transport not open - deferring close"),this.once("open",a))},c.prototype.write=function(a){var b=this;this.writable=!1,this.doWrite(f.encodePayload(a),function(){b.writable=!0,b.emit("drain")})},c.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";return(h.ActiveXObject||e.ua.chromeframe||e.ua.android||e.ua.ios6||this.timestampRequests)&&(a[this.timestampParam]=+new Date),a=e.qs(a),this.port&&("https"==b&&443!=this.port||"http"==b&&80!=this.port)&&(c=":"+this.port),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a}},{"../transport":40,"../util":47,debug:49,"engine.io-parser":51,global:54}],46:[function(a,b){function c(a){d.call(this,a)}{var d=a("../transport"),e=a("ws"),f=a("engine.io-parser"),g=a("../util");a("debug")("engine.io-client:websocket")}b.exports=c;a("global");g.inherits(c,d),c.prototype.name="websocket",c.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=void 0,c={agent:this.agent};this.socket=new e(a,b,c),this.addEventListeners()}},c.prototype.addEventListeners=function(){var a=this;this.socket.onopen=function(){a.onOpen()},this.socket.onclose=function(){a.onClose()},this.socket.onmessage=function(b){a.onData(b.data)},this.socket.onerror=function(b){a.onError("websocket error",b)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(c.prototype.onData=function(a){var b=this;setTimeout(function(){d.prototype.onData.call(b,a)},0)}),c.prototype.write=function(a){function b(){c.writable=!0,c.emit("drain")}var c=this;this.writable=!1;for(var d=0,e=a.length;e>d;d++)this.socket.send(f.encodePacket(a[d]));setTimeout(b,0)},c.prototype.onClose=function(){d.prototype.onClose.call(this)},c.prototype.doClose=function(){"undefined"!=typeof this.socket&&this.socket.close()},c.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";return this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(c=":"+this.port),this.timestampRequests&&(a[this.timestampParam]=+new Date),a=g.qs(a),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a},c.prototype.check=function(){return!(!e||"__initialize"in e&&this.name===c.prototype.name)}},{"../transport":40,"../util":47,debug:49,"engine.io-parser":51,global:54,ws:57}],47:[function(a,b,c){var d=a("global"),e=!1;c.inherits=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c},c.keys=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b},c.on=function(a,b,c,d){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,d)},c.load=function(a){return d.document&&"complete"===document.readyState||e?a():void c.on(d,"load",a,!1)},"undefined"!=typeof window&&c.load(function(){e=!0}),c.defer=function(a){return c.ua.webkit&&"undefined"==typeof importScripts?void c.load(function(){setTimeout(a,100)}):a()};var f=/^[\],:{}\s]*$/,g=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,h=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,i=/(?:^|:|,)(?:\s*\[)+/g,j=/^\s+/,k=/\s+$/;c.parseJSON=function(a){return"string"==typeof a&&a?(a=a.replace(j,"").replace(k,""),d.JSON&&JSON.parse?JSON.parse(a):f.test(a.replace(g,"@").replace(h,"]").replace(i,""))?new Function("return "+a)():void 0):null},c.ua={},c.ua.hasCORS=a("has-cors"),c.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),c.ua.gecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent),c.ua.android="undefined"!=typeof navigator&&/android/i.test(navigator.userAgent),c.ua.ios="undefined"!=typeof navigator&&/^(iPad|iPhone|iPod)$/.test(navigator.platform),c.ua.ios6=c.ua.ios&&/OS 6_/.test(navigator.userAgent),c.ua.chromeframe=Boolean(d.externalHost),c.request=function(b,d){d=d||{},d.xdomain=b;try{var e=a("xmlhttprequest");return new e(d)}catch(f){}if(b&&"undefined"!=typeof XDomainRequest&&!c.ua.hasCORS)return new XDomainRequest;try{if("undefined"!=typeof XMLHttpRequest&&(!b||c.ua.hasCORS))return new XMLHttpRequest}catch(f){}if(!b)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}};var l=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,m=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];c.parseUri=function(a){for(var b=l.exec(a||""),c={},d=14;d--;)c[m[d]]=b[d]||"";return c},c.qs=function(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b.length&&(b+="&"),b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b},c.qsParse=function(a){for(var b={},c=a.split("&"),d=0,e=c.length;e>d;d++){var f=c[d].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return b}},{global:54,"has-cors":55,xmlhttprequest:48}],48:[function(a,b){var c=a("has-cors");b.exports=function(a){var b=a.xdomain;if(b&&"undefined"!=typeof XDomainRequest&&!c)return new XDomainRequest;try{if("undefined"!=typeof XMLHttpRequest&&(!b||c))return new XMLHttpRequest}catch(d){}if(!b)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(d){}}},{"has-cors":55}],49:[function(a,b){function c(a){return c.enabled(a)?function(b){var d=new Date,e=d-(c[a]||d);c[a]=d,b=a+" "+b+" +"+c.humanize(e),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}b.exports=c,c.names=[],c.skips=[],c.enable=function(a){try{localStorage.debug=a}catch(b){}for(var d=(a||"").split(/[\s,]+/),e=d.length,f=0;e>f;f++)a=d[f].replace("*",".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$"))},c.disable=function(){c.enable("")},c.humanize=function(a){var b=1e3,c=6e4,d=60*c;return a>=d?(a/d).toFixed(1)+"h":a>=c?(a/c).toFixed(1)+"m":a>=b?(a/b|0)+"s":a+"ms"},c.enabled=function(a){for(var b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(var b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1},window.localStorage&&c.enable(localStorage.debug)},{}],50:[function(a,b){function c(a){return a?d(a):void 0}function d(a){for(var b in c.prototype)a[b]=c.prototype[b];return a}var e=a("indexof");b.exports=c,c.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},c.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},b._off=c,this.on(a,c),this},c.prototype.off=c.prototype.removeListener=c.prototype.removeAllListeners=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;var d=e(c,b._off||b);return~d&&c.splice(d,1),this},c.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},c.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},c.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{indexof:56}],51:[function(a,b){b.exports=a("./lib/")},{"./lib/":52}],52:[function(a,b,c){var d=a("./keys");c.protocol=2;var e=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=d(e),g={type:"error",data:"parser error"};c.encodePacket=function(a){var b=e[a.type];return void 0!==a.data&&(b+=String(a.data)),""+b},c.decodePacket=function(a){var b=a.charAt(0);return Number(b)==b&&f[b]?a.length>1?{type:f[b],data:a.substring(1)}:{type:f[b]}:g},c.encodePayload=function(a){if(!a.length)return"0:";for(var b,d="",e=0,f=a.length;f>e;e++)b=c.encodePacket(a[e]),d+=b.length+":"+b;return d},c.decodePayload=function(a,b){var d;if(""==a)return b(g,0,1);for(var e,f,h="",i=0,j=a.length;j>i;i++){var k=a.charAt(i);if(":"!=k)h+=k;else{if(""==h||h!=(e=Number(h)))return b(g,0,1);if(f=a.substr(i+1,e),h!=f.length)return b(g,0,1);if(f.length){if(d=c.decodePacket(f),g.type==d.type&&g.data==d.data)return b(g,0,1);var l=b(d,i+e,j);if(!1===l)return}i+=e,h=""}}return""!=h?b(g,0,1):void 0}},{"./keys":53}],53:[function(a,b){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b}},{}],54:[function(a,b){b.exports=function(){return this}()},{}],55:[function(a,b){var c=a("global");b.exports="XMLHttpRequest"in c&&"withCredentials"in new c.XMLHttpRequest},{global:54}],56:[function(a,b){var c=[].indexOf;b.exports=function(a,b){if(c)return a.indexOf(b);for(var d=0;d<a.length;++d)if(a[d]===b)return d;return-1}},{}],57:[function(a,b){function c(a,b){var c;return c=b?new e(a,b):new e(a)}var d=function(){return this}(),e=d.WebSocket||d.MozWebSocket;b.exports=e?c:null,e&&(c.prototype=e.prototype)},{}],58:[function(a,b,c){(function(a){!function(a){function b(){this._events={},this._conf&&c.call(this,this._conf)}function c(a){a&&(this._conf=a,a.delimiter&&(this.delimiter=a.delimiter),a.maxListeners&&(this._events.maxListeners=a.maxListeners),a.wildcard&&(this.wildcard=a.wildcard),a.newListener&&(this.newListener=a.newListener),this.wildcard&&(this.listenerTree={}))}function d(a){this._events={},this.newListener=!1,c.call(this,a)}function e(a,b,c,d){if(!c)return[];var f,g,h,i,j,k,l,m=[],n=b.length,o=b[d],p=b[d+1];if(d===n&&c._listeners){if("function"==typeof c._listeners)return a&&a.push(c._listeners),[c];for(f=0,g=c._listeners.length;g>f;f++)a&&a.push(c._listeners[f]);return[c]}if("*"===o||"**"===o||c[o]){if("*"===o){for(h in c)"_listeners"!==h&&c.hasOwnProperty(h)&&(m=m.concat(e(a,b,c[h],d+1)));return m}if("**"===o){l=d+1===n||d+2===n&&"*"===p,l&&c._listeners&&(m=m.concat(e(a,b,c,n)));for(h in c)"_listeners"!==h&&c.hasOwnProperty(h)&&("*"===h||"**"===h?(c[h]._listeners&&!l&&(m=m.concat(e(a,b,c[h],n))),m=m.concat(e(a,b,c[h],d))):m=m.concat(h===p?e(a,b,c[h],d+2):e(a,b,c[h],d)));return m}m=m.concat(e(a,b,c[o],d+1))}if(i=c["*"],i&&e(a,b,i,d+1),j=c["**"])if(n>d){j._listeners&&e(a,b,j,n);for(h in j)"_listeners"!==h&&j.hasOwnProperty(h)&&(h===p?e(a,b,j[h],d+2):h===o?e(a,b,j[h],d+1):(k={},k[h]=j[h],e(a,b,{"**":k},d+1)))}else j._listeners?e(a,b,j,n):j["*"]&&j["*"]._listeners&&e(a,b,j["*"],n);return m}function f(a,b){a="string"==typeof a?a.split(this.delimiter):a.slice();for(var c=0,d=a.length;d>c+1;c++)if("**"===a[c]&&"**"===a[c+1])return;for(var e=this.listenerTree,f=a.shift();f;){if(e[f]||(e[f]={}),e=e[f],0===a.length){if(e._listeners){if("function"==typeof e._listeners)e._listeners=[e._listeners,b];else if(g(e._listeners)&&(e._listeners.push(b),!e._listeners.warned)){var i=h;"undefined"!=typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&e._listeners.length>i&&(e._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",e._listeners.length),console.trace())}}else e._listeners=b;return!0}f=a.shift()}return!0}var g=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},h=10;d.prototype.delimiter=".",d.prototype.setMaxListeners=function(a){this._events||b.call(this),this._events.maxListeners=a,this._conf||(this._conf={}),this._conf.maxListeners=a},d.prototype.event="",d.prototype.once=function(a,b){return this.many(a,1,b),this},d.prototype.many=function(a,b,c){function d(){0===--b&&e.off(a,d),c.apply(this,arguments)}var e=this;if("function"!=typeof c)throw new Error("many only accepts instances of Function");return d._origin=c,this.on(a,d),e},d.prototype.emit=function(){this._events||b.call(this);var a=arguments[0];if("newListener"===a&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var c=arguments.length,d=new Array(c-1),f=1;c>f;f++)d[f-1]=arguments[f];for(f=0,c=this._all.length;c>f;f++)this.event=a,this._all[f].apply(this,d)}if("error"===a&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var g;if(this.wildcard){g=[];var h="string"==typeof a?a.split(this.delimiter):a.slice();e.call(this,g,h,this.listenerTree,0)}else g=this._events[a];if("function"==typeof g){if(this.event=a,1===arguments.length)g.call(this);else if(arguments.length>1)switch(arguments.length){case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:for(var c=arguments.length,d=new Array(c-1),f=1;c>f;f++)d[f-1]=arguments[f];g.apply(this,d)}return!0}if(g){for(var c=arguments.length,d=new Array(c-1),f=1;c>f;f++)d[f-1]=arguments[f];for(var i=g.slice(),f=0,c=i.length;c>f;f++)this.event=a,i[f].apply(this,d);return i.length>0||this._all}return this._all},d.prototype.on=function(a,c){if("function"==typeof a)return this.onAny(a),this;if("function"!=typeof c)throw new Error("on only accepts instances of Function");if(this._events||b.call(this),this.emit("newListener",a,c),this.wildcard)return f.call(this,a,c),this;if(this._events[a]){if("function"==typeof this._events[a])this._events[a]=[this._events[a],c];else if(g(this._events[a])&&(this._events[a].push(c),!this._events[a].warned)){var d=h;"undefined"!=typeof this._events.maxListeners&&(d=this._events.maxListeners),d>0&&this._events[a].length>d&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}}else this._events[a]=c;return this},d.prototype.onAny=function(a){if(this._all||(this._all=[]),"function"!=typeof a)throw new Error("onAny only accepts instances of Function");return this._all.push(a),this},d.prototype.addListener=d.prototype.on,d.prototype.off=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");var c,d=[];if(this.wildcard){var f="string"==typeof a?a.split(this.delimiter):a.slice();d=e.call(this,null,f,this.listenerTree,0)}else{if(!this._events[a])return this;c=this._events[a],d.push({_listeners:c})}for(var h=0;h<d.length;h++){var i=d[h];if(c=i._listeners,g(c)){for(var j=-1,k=0,l=c.length;l>k;k++)if(c[k]===b||c[k].listener&&c[k].listener===b||c[k]._origin&&c[k]._origin===b){j=k;break}if(0>j)continue;return this.wildcard?i._listeners.splice(j,1):this._events[a].splice(j,1),0===c.length&&(this.wildcard?delete i._listeners:delete this._events[a]),this}(c===b||c.listener&&c.listener===b||c._origin&&c._origin===b)&&(this.wildcard?delete i._listeners:delete this._events[a])}return this},d.prototype.offAny=function(a){var b,c=0,d=0;if(a&&this._all&&this._all.length>0){for(b=this._all,c=0,d=b.length;d>c;c++)if(a===b[c])return b.splice(c,1),this}else this._all=[];return this},d.prototype.removeListener=d.prototype.off,d.prototype.removeAllListeners=function(a){if(0===arguments.length)return!this._events||b.call(this),this;if(this.wildcard)for(var c="string"==typeof a?a.split(this.delimiter):a.slice(),d=e.call(this,null,c,this.listenerTree,0),f=0;f<d.length;f++){var g=d[f];g._listeners=null}else{if(!this._events[a])return this;this._events[a]=null}return this},d.prototype.listeners=function(a){if(this.wildcard){var c=[],d="string"==typeof a?a.split(this.delimiter):a.slice();return e.call(this,c,d,this.listenerTree,0),c}return this._events||b.call(this),this._events[a]||(this._events[a]=[]),g(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},d.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return d}):a.EventEmitter2=d}("undefined"!=typeof a&&"undefined"!=typeof a.title&&"undefined"!=typeof c?c:window)}).call(this,a("FWaASH"))},{FWaASH:33}],59:[function(a,b){!function(){var a={};a.constructor=function(){};var c=this;a.register=function(){function a(a){return function(){e++||(b(),a&&a.apply(this,arguments))}}function b(){if(c){for(var a=0;d>a;a+=3){var b=c[a],e=c[a+1],f=c[a+2];b.removeListener?b.removeListener(e,f):b.off(e,f)}c=null}}var c=1===arguments.length?arguments[0]:arguments,d=c.length;if(d%3!==0)throw new Error("register needs triplets as arguments");for(var e=0,f=0;d>f;f+=3){var g=c[f],h=c[f+1],i=c[f+2];"!"==h.substr(0,1)&&(h=c[f+1]=h.substr(1),i=c[f+2]=a(i)),g.addListener?g.addListener(h,i):g.on(h,i)}return b},a.singular=function(a){return function(){if(a){var b=a;return a=null,b.apply(this,arguments)}}},"undefined"!=typeof define&&define.amd?define([],function(){return a}):"undefined"!=typeof b&&b.exports?b.exports=a:c.eventutil=a}()},{}],60:[function(a,b,c){"use strict";var d=c;c.constructor=function(){},d.SLASH_SPACE_TRIMMER=/^[\/\s]+|[\/\s]+$/g;var e="a-zA-Z0-9%",f=e+".",g=e+".@_:-",h="["+f+"]["+g+"]{0,127}",i="["+e+"]["+g+"]{0,127}";d.NAME_REGEX_BODY=i;var j="["+g+"]{1,128}";d.INTERNAL_NAME_REGEX_BODY=j,d.NAME_REGEX=new RegExp("^"+i+"$"),d.INTERNAL_NAME_REGEX=new RegExp("^"+j+"$"),d.KEY_REGEX="(?:(?:/)?"+h+"(?:/|)?)*",d.NAME_RULES_ENGLISH=" names are case sensitive, must be alphanumeric (1-128 chars), and can include non-leading -, _, ., @, and :",d.PROVIDER_NAME_REGEX=/^(?!session$)[a-z0-9][a-z0-9_]{0,127}$/,d.PROVIDER_NAME_ENGLISH="provider names are case sensitive, must be alphanumeric (1-128 chars), and can include non-leading underscores";var k="(?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})",l=k+"\\."+k+"\\."+k+"\\."+k,m="\\[[A-F0-9:]+(?::"+l+")?\\]",n="[a-z0-9][a-z0-9\\-]+",o="(?:"+n+"\\.)*(?:"+n+")",p="(?:[1-9]|[1-9][0-9]{1,3}|[1-5][0-9]{1,4}|6(?:[0-4][0-9]{3}|5[0-4][0-9]{2}|55[0-2][0-9]|553[0-5]))",q="(?:"+o+"|"+l+"|"+m+")(?::"+p+")?";d.ORIGIN_REGEX=new RegExp("^https?://"+q+"$","i"),d.HOST_OR_IP_AND_PORT_REGEX=new RegExp("^"+q+"$","i")},{}],61:[function(require,module,exports){"use strict";function detectStacktrace(){try{throw new Error("probing")}catch(a){var b=a.stack;if(!b)return!1;try{b=b.substring(1)}catch(c){return!1}}return!0}function detectStackHasMessage(){try{throw new Error("probing")}catch(a){var b=a.stack;return/^Error: probing\n/.test(b)?!0:!1}}function detectMutableStacktrace(){function a(a){this.message=a;var b=(new Error).stack;this.stack=b.substring(1)}util.inherits(a,Error);try{throw new a("probing")}catch(b){return b.stacktrace?!1:b instanceof a&&"probing"===b.message?!0:!1}}function GenericError(a,b,c){if(this.message=c,this.code=b,canCaptureStacktrace||(this.name=a),hasStacktrace)if(canCaptureStacktrace)Error.captureStackTrace(this,this.name);else if(hasMutableStacktrace){var d=""+(new Error).stack;this.stack=scrubStack(d)}}function GoInstantError(){throw new Error("GoInstantError is an abstract base-class")}function generate(a){_.isString(a)&&(a=[a]);var b={};return _.each(a,function(a){b[a]=generateClass(a)}),b}function detectNeedToString(){function a(a){this.message=a,this.name="Tmp"}util.inherits(a,Error);var b;try{throw new Error("probing")}catch(c){b=c.toString().replace(/^Error/,"Tmp")}try{throw new a("probing")}catch(c){try{var d=c.toString();return d!==b}catch(e){return!0}}}function generateClass(name){var curClass;return eval(TEMPLATE.replace(/X/g,name)+"\ncurClass = "+name+";"),util.inherits(curClass,GoInstantError),canCaptureStacktrace&&(curClass.prototype.name=name),needsToString&&(curClass.prototype.toString=function(){return this.name+": "+this.message}),inWindow||(curClass.prototype.inspect=function(){return"["+this.toString()+"]"}),curClass}var errorgen=exports;exports.constructor=function(){};var util=require("util"),_=require("lodash"),inWindow=!1;try{inWindow=!!window}catch(e){}var canCaptureStacktrace=!!Error.captureStackTrace,hasStacktrace=canCaptureStacktrace||detectStacktrace(),stackHasMessage=hasStacktrace&&detectStackHasMessage(),hasMutableStacktrace=canCaptureStacktrace||detectMutableStacktrace(),scrubStack=function(){};scrubStack=stackHasMessage?function(a){return a.replace(/\n[^\n]+\n/,"\n")}:function(a){return a.substr(a.indexOf("\n")+1)},errorgen.GenericError=GenericError,util.inherits(GoInstantError,Error),util.inherits(GenericError,GoInstantError);var TEMPLATE="";TEMPLATE+="function X(message) {\n",TEMPLATE+="  'use strict';\n",TEMPLATE+="  this.message = message;\n",canCaptureStacktrace||(TEMPLATE+="  this.name = 'X';\n");var needsToString=detectNeedToString();hasStacktrace&&(canCaptureStacktrace?TEMPLATE+="  Error.captureStackTrace(this, this.name);\n":hasMutableStacktrace&&(TEMPLATE+="  var s = '' + new Error().stack;\n",TEMPLATE+="  this.stack = scrubStack(s);\n")),TEMPLATE+="}\n",errorgen.generate=generate,errorgen.hasStacktrace=hasStacktrace,errorgen.GoInstantError=GoInstantError},{lodash:69,util:35}],62:[function(a,b,c){"use strict";var d=c;c.constructor=function(){};var e=a("lodash"),f=a("./errorgen"),g=a("util"),h={CollisionError:{ctor:function(a){f.GenericError.call(this,"CollisionError",100,a)},code:100},RoomSessionStateError:{ctor:function(a){f.GenericError.call(this,"RoomSessionStateError",200,a)},code:200},RoomSizeError:{ctor:function(a){f.GenericError.call(this,"RoomSizeError",201,a)},code:201},ConnectionError:{ctor:function(a){f.GenericError.call(this,"ConnectionError",202,a)},code:202},AuthenticationError:{ctor:function(a){f.GenericError.call(this,"AuthenticationError",203,a)},code:203},PermissionError:{ctor:function(a){f.GenericError.call(this,"PermissionError",204,a)},code:204},NotMemberError:{ctor:function(a){f.GenericError.call(this,"NotMemberError",205,a)},code:205},NotConnectedError:{ctor:function(a){f.GenericError.call(this,"NotConnectedError",206,a)},code:206},NoUserError:{ctor:function(a){f.GenericError.call(this,"NoUserError",207,a)},code:207},SynchronizationError:{ctor:function(a){f.GenericError.call(this,"SynchronizationError",208,a)},code:208},KeyNameError:{ctor:function(a){f.GenericError.call(this,"KeyNameError",300,a)},code:300},InvalidRequestError:{ctor:function(a){f.GenericError.call(this,"InvalidRequestError",302,a)},code:302},ArgumentError:{ctor:function(a){f.GenericError.call(this,"ArgumentError",303,a)},code:303},NonLeafKeyError:{ctor:function(a){f.GenericError.call(this,"NonLeafKeyError",304,a)},code:304},DuplicateCallError:{ctor:function(a){f.GenericError.call(this,"DuplicateCallError",305,a)},code:305},CouldNotCompleteError:{ctor:function(a){f.GenericError.call(this,"CouldNotCompleteError",306,a)},code:306},NotInitializedError:{ctor:function(a){f.GenericError.call(this,"NotInitializedError",307,a)},code:307},RoomOvergrownError:{ctor:function(a){f.GenericError.call(this,"RoomOvergrownError",400,a)},code:400},ProviderDisabledError:{ctor:function(a){f.GenericError.call(this,"ProviderDisabledError",500,a)},code:500},ProviderNotFoundError:{ctor:function(a){f.GenericError.call(this,"ProviderNotFoundError",501,a)},code:501},AuthStateError:{ctor:function(a){f.GenericError.call(this,"AuthStateError",502,a)},code:502}};e.each(h,function(a,b){g.inherits(a.ctor,f.GenericError),a.ctor.prototype.name=b,a.ctor.prototype.code=a.code,a.ctor.prototype.toString=function(){return this.name+": "+this.message},a.ctor.prototype.inspect=function(){return"["+this.toString()+"]"},d[b]=a.ctor});var i={};e.each(h,function(a){i[a.code]=a.ctor}),d.getByCode=function(a){return i[a]},d.GoInstantError=f.GoInstantError},{"./errorgen":61,lodash:69,util:35}],63:[function(a,b,c){"use strict";function d(a,b,c){var d;try{d=a(b)}catch(e){return c(e)}return c(null,d)}var e=c;c.constructor=function(){},e.parse=function(a,b){d(JSON.parse,a,b)},e.stringify=function(a,b){d(JSON.stringify,a,b)}},{}],64:[function(a,b,c){"use strict";var d=c;c.constructor=function(){},d.constants=a("./constants"),d.errorgen=a("./errorgen"),d.errors=a("./errors"),d.gson=a("./gson"),d.keyName=a("./key_name"),d.objUtil=a("./obj"),d.path=a("./path"),d.registry=a("./registry")},{"./constants":60,"./errorgen":61,"./errors":62,"./gson":63,"./key_name":65,"./obj":66,"./path":67,"./registry":68}],65:[function(a,b,c){"use strict";var d=c;c.constructor=function(){};var e=a("lodash"),f=a("./constants"),g=f.SLASH_SPACE_TRIMMER;d.clean=function(a){if("/"===a)return"/";if(!e.isString(a))return null;if(a="/"+a.replace(g,""),1===a.length)return null;var b=d.validate(a);return b?a:null},d.validate=function(a){if(!e.isString(a)||a.length<1||"/"!==a[0])return!1;if("/"===a)return!0;var b=a.split("/");b.shift(),".users"===b[0]&&(b.shift(),b.length>0&&f.INTERNAL_NAME_REGEX.test(b[0])&&b.shift());var c=e.every(b,function(a){return f.NAME_REGEX.test(a)});return c}},{"./constants":60,lodash:69}],66:[function(a,b,c){"use strict";var d=c;c.constructor=function(){};var e=a("lodash"),f=a("./errors");d.pick=function(a,b,c){c=c||"/";var d=b.split(c),f=a;if(d=e.filter(d,function(a){return""!==a}),(null===f||void 0===f)&&d.length>=0)return void 0;for(var g=0;g<d.length;++g){if(f=f[d[g]],null===f&&g+1<d.length)return void 0;if(void 0===f)return void 0}return f},d.remove=function(a,b,c,d){if(!e.isObject(a))throw new Error("Provided blob is not an object");c&&c.clone&&(a=e.cloneDeep(a));var g=b.split("/");g=e.filter(g,function(a){return""!==a});var h,i=!0,j=a,k=[a],l=g.length-1;for(h=0;l>h;h++){if(j=j[g[h]],void 0===j){if(c&&e.has(c,"throws")&&!c.throws){i=!1;break}throw new f.KeyNameError("Path does not exist in object")}k.push(j)}if(i){var m=j[g[l]];if(m&&c.ignore&&m[c.ignore])for(var n=e.keys(m),o=0;o<n.length;++o)n[o]!=c.ignore&&delete m[n[o]];else delete j[g[l]]}for(var p,q=h;q>=0;q--)p=g[q],0===e.size(k[q][p])&&delete k[q][p],d&&d(k[q]);
return a},d.ensureMember=function(a,b,c){e.has(a,b)||(a[b]=c())},d.optional=function(a,b,c){return e.each(c,function(c,d){c(b[d])&&(a[d]=b[d])}),a}},{"./errors":62,lodash:69}],67:[function(a,b,c){"use strict";function d(a){return""===a[0]&&a.shift(),a}function e(a){return""===a[0]}var f=c;c.constructor=function(){};var g=a("lodash");f.rInsert=function(a,b,c){var f=a.split("/"),g=e(f);f=d(f),c||(c={});var h=[];c.front&&h.push(b);for(var i=0;i<f.length;++i){h.push(f[i]);var j=i===f.length-1;if(j&&!c.rear)break;h.push(b)}return g&&h.unshift(""),h.join("/")},f.rStrip=function(a,b){var c=a.split("/"),d=g.filter(c,function(a){return a!=b});return d.join("/")}},{lodash:69}],68:[function(a,b,c){"use strict";function d(a,b){this.listener=a,b=b||{},this.local=!!b.local,this.bubble=!!b.bubble}function e(a){this.name=a,this.children={},this.actions={}}function f(a){var b=a.split("/");return""===b[0]&&b.shift(),""===b[b.length-1]&&b.pop(),b}function g(){this._tree=new e("/")}function h(a,b,c){for(var d=c?j.values(a.children):[a];0!==d.length;){var e=d.pop();d=d.concat(j.values(e.children)),b(e)}}var i=c;c.constructor=function(){};var j=a("lodash"),k=a("./obj");i.Registry=g,g.prototype.add=function(a,b,c,g){var h=f(a),i=this._tree;j.each(h,function(a,b){k.ensureMember(i.children,a,function(){var a="/"+h.slice(0,b+1).join("/");return new e(a)}),i=i.children[a]}),k.ensureMember(i.actions,b,function(){return[]}),i.actions[b].push(new d(c,g))},g.prototype.get=function(a,b,c){function d(a,b,d){if(d.local||!c.local){var e={key:a.name,listener:d.listener};b&&(e.action=b),m.unshift(e)}}function e(a,b,c){j.each(b,j.bind(d,null,a,c))}c=j.defaults(c||{},{bubble:!0});var g=f(a),i={children:[],direct:[],parents:[]},k=this._tree,l=!j.any(g,function(a){return c.bubble&&j.has(k.actions,b)&&j.each(k.actions[b],function(a){!a.bubble||!a.local&&c.local||i.parents.unshift({key:k.name,listener:a.listener})}),j.has(k.children,a)?void(k=k.children[a]):!0});if(!l)return i;var m=i.direct;return j.each(k.actions[b],j.bind(d,null,k,null)),m=i.children,h(k,function(a){j.each(a.actions,j.bind(e,null,a))},!0),i},g.prototype.remove=function(a,b,c,d){var e=!1,g=f(a),h=[this._tree],i=this._tree,k=!j.any(g,function(a){return j.has(i.children,a)?(i=i.children[a],void h.push(i)):!0});if(!k)return e;var l=!1,m=b?[b]:j.keys(i.actions);j.each(m,function(a){!l&&j.has(i.actions,a)&&(j.remove(i.actions[a],function(a){return l?!1:c&&a.listener!==c?!1:d&&j.has(d,"bubble")&&a.bubble!==d.bubble?!1:d&&j.has(d,"local")&&a.local!==d.local?!1:(l=!!c,e=!0,!0)}),0===i.actions[a].length&&delete i.actions[a])});for(var n=h.length-1;n>0;n--)i=h[n],0===j.size(i.actions)&&0===j.size(i.children)&&delete h[n-1].children[g[n-1]];return e},g.prototype.removeAllByListener=function(a){function b(b){j.each(b.actions,function(b){j.remove(b,function(b){return b.listener===a})})}h(this._tree,b)},g.prototype.isEmpty=function(){return 0===j.size(this._tree.children)&&0===j.size(this._tree.actions)},g.prototype.toArray=function(){var a=[];return h(this._tree,function(b){j.each(b.actions,function(c,d){j.each(c,function(c){a.push({key:b.name,action:d,listener:c.listener,opts:{bubble:c.bubble,local:c.local}})})})}),a}},{"./obj":66,lodash:69}],69:[function(a,b,c){(function(a){(function(){function d(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function e(a,b){var c=typeof b;if(a=a.cache,"boolean"==c||null==b)return a[b]?0:-1;"number"!=c&&"string"!=c&&(c="object");var e="number"==c?b:u+b;return a=(a=a[c])&&a[e],"object"==c?a&&d(a,b)>-1?0:-1:a?0:-1}function f(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:u+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function g(a){return a.charCodeAt(0)}function h(a,b){for(var c=a.criteria,d=b.criteria,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.index-b.index}function i(a){var b=-1,c=a.length,d=a[0],e=a[c/2|0],g=a[c-1];if(d&&"object"==typeof d&&e&&"object"==typeof e&&g&&"object"==typeof g)return!1;var h=l();h["false"]=h["null"]=h["true"]=h.undefined=!1;var i=l();for(i.array=a,i.cache=h,i.push=f;++b<c;)i.push(a[b]);return i}function j(a){return"\\"+Y[a]}function k(){return r.pop()||[]}function l(){return s.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function m(a){a.length=0,r.length<w&&r.push(a)}function n(a){var b=a.cache;b&&n(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,s.length<w&&s.push(a)}function o(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function p(a){function b(a){return a&&"object"==typeof a&&!Zd(a)&&Hd.call(a,"__wrapped__")?a:new c(a)}function c(a,b){this.__chain__=!!b,this.__wrapped__=a}function f(a){function b(){if(d){var a=o(d);Id.apply(a,arguments)}if(this instanceof b){var f=s(c.prototype),g=c.apply(f,a||arguments);return Eb(g)?g:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Yd(b,a),b}function r(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}var g=Eb(a);if(!g)return a;var h=Ad.call(a);if(!U[h])return a;var i=Wd[h];switch(h){case N:case O:return new i(+a);case Q:case T:return new i(a);case S:return f=i(a.source,C.exec(a)),f.lastIndex=a.lastIndex,f}var j=Zd(a);if(b){var l=!d;d||(d=k()),e||(e=k());for(var n=d.length;n--;)if(d[n]==a)return e[n];f=j?i(a.length):{}}else f=j?o(a):ee({},a);return j&&(Hd.call(a,"index")&&(f.index=a.index),Hd.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(j?Yb:he)(a,function(a,g){f[g]=r(a,b,c,d,e)}),l&&(m(d),m(e)),f):f}function s(a){return Eb(a)?Nd(a):{}}function w(a,b,c){if("function"!=typeof a)return Zc;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Xd.funcNames&&(d=!a.name),d=d||!Xd.funcDecomp,!d)){var e=Fd.call(a);Xd.funcNames||(d=!D.test(e)),d||(d=H.test(e),Yd(a,d))}if(d===!1||d!==!0&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Ic(a,b)}function Y(a){function b(){var a=i?g:this;if(e){var n=o(e);Id.apply(n,arguments)}if((f||k)&&(n||(n=o(arguments)),f&&Id.apply(n,f),k&&n.length<h))return d|=16,Y([c,l?d:-4&d,n,null,g,h]);if(n||(n=arguments),j&&(c=a[m]),this instanceof b){a=s(c.prototype);var p=c.apply(a,n);return Eb(p)?p:a}return c.apply(a,n)}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,l=8&d,m=c;return Yd(b,a),b}function $(a,b){var c=-1,f=ib(),g=a?a.length:0,h=g>=v&&f===d,j=[];if(h){var k=i(b);k?(f=e,b=k):h=!1}for(;++c<g;){var l=a[c];f(b,l)<0&&j.push(l)}return h&&n(b),j}function _(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Zd(h)||mb(h))){b||(h=_(h,b,c));var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function ab(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;var h=typeof a,i=typeof b;if(!(a!==a||a&&X[h]||b&&X[i]))return!1;if(null==a||null==b)return a===b;var j=Ad.call(a),l=Ad.call(b);if(j==L&&(j=R),l==L&&(l=R),j!=l)return!1;switch(j){case N:case O:return+a==+b;case Q:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case S:case T:return a==vd(b)}var n=j==M;if(!n){var o=Hd.call(a,"__wrapped__"),p=Hd.call(b,"__wrapped__");if(o||p)return ab(o?a.__wrapped__:a,p?b.__wrapped__:b,c,d,e,f);if(j!=R)return!1;var q=a.constructor,r=b.constructor;if(q!=r&&!(Db(q)&&q instanceof q&&Db(r)&&r instanceof r)&&"constructor"in a&&"constructor"in b)return!1}var s=!e;e||(e=k()),f||(f=k());for(var t=e.length;t--;)if(e[t]==a)return f[t]==b;var u=0;if(g=!0,e.push(a),f.push(b),n){if(t=a.length,u=b.length,g=u==t,g||d)for(;u--;){var v=t,w=b[u];if(d)for(;v--&&!(g=ab(a[v],w,c,d,e,f)););else if(!(g=ab(a[u],w,c,d,e,f)))break}}else ge(b,function(b,h,i){return Hd.call(i,h)?(u++,g=Hd.call(a,h)&&ab(a[h],b,c,d,e,f)):void 0}),g&&!d&&ge(a,function(a,b,c){return Hd.call(c,b)?g=--u>-1:void 0});return e.pop(),f.pop(),s&&(m(e),m(f)),g}function bb(a,b,c,d,e){(Zd(b)?Yb:he)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Zd(b))||ie(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?Zd(j)?j:[]:ie(j)?j:{}),d.push(b),e.push(j),l||bb(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function db(a,b){return a+Ed(Vd()*(b-a+1))}function eb(a,b,c){var f=-1,g=ib(),h=a?a.length:0,j=[],l=!b&&h>=v&&g===d,o=c||l?k():j;if(l){var p=i(o);g=e,o=p}for(;++f<h;){var q=a[f],r=c?c(q,f,a):q;(b?!f||o[o.length-1]!==r:g(o,r)<0)&&((c||l)&&o.push(r),j.push(q))}return l?(m(o.array),n(o)):c&&m(o),j}function fb(a){return function(c,d,e){var f={};d=b.createCallback(d,e,3);var g=-1,h=c?c.length:0;if("number"==typeof h)for(;++g<h;){var i=c[g];a(f,i,d(i,g,c),c)}else he(c,function(b,c,e){a(f,b,d(b,c,e),e)});return f}}function gb(a,b,c,d,e,g){var h=1&b,i=2&b,j=4&b,k=16&b,l=32&b;if(!i&&!Db(a))throw new wd;k&&!c.length&&(b&=-17,k=c=!1),l&&!d.length&&(b&=-33,l=d=!1);var m=a&&a.__bindData__;if(m&&m!==!0)return m=o(m),m[2]&&(m[2]=o(m[2])),m[3]&&(m[3]=o(m[3])),!h||1&m[1]||(m[4]=e),!h&&1&m[1]&&(b|=8),!j||4&m[1]||(m[5]=g),k&&Id.apply(m[2]||(m[2]=[]),c),l&&Ld.apply(m[3]||(m[3]=[]),d),m[1]|=b,gb.apply(null,m);var n=1==b||17===b?f:Y;return n([a,b,c,d,e,g])}function hb(a){return ae[a]}function ib(){var a=(a=b.indexOf)===rc?d:a;return a}function jb(a){return"function"==typeof a&&Bd.test(a)}function kb(a){var b,c;return a&&Ad.call(a)==R&&(b=a.constructor,!Db(b)||b instanceof b)?(ge(a,function(a,b){c=b}),"undefined"==typeof c||Hd.call(a,c)):!1}function lb(a){return be[a]}function mb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ad.call(a)==L||!1}function nb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),r(a,b,"function"==typeof c&&w(c,d,1))}function ob(a,b,c){return r(a,!0,"function"==typeof b&&w(b,c,1))}function pb(a,b){var c=s(a);return b?ee(c,b):c}function qb(a,c,d){var e;return c=b.createCallback(c,d,3),he(a,function(a,b,d){return c(a,b,d)?(e=b,!1):void 0}),e}function rb(a,c,d){var e;return c=b.createCallback(c,d,3),tb(a,function(a,b,d){return c(a,b,d)?(e=b,!1):void 0}),e}function sb(a,b,c){var d=[];ge(a,function(a,b){d.push(b,a)});var e=d.length;for(b=w(b,c,3);e--&&b(d[e--],d[e],a)!==!1;);return a}function tb(a,b,c){var d=_d(a),e=d.length;for(b=w(b,c,3);e--;){var f=d[e];if(b(a[f],f,a)===!1)break}return a}function ub(a){var b=[];return ge(a,function(a,c){Db(a)&&b.push(c)}),b.sort()}function vb(a,b){return a?Hd.call(a,b):!1}function wb(a){for(var b=-1,c=_d(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function xb(a){return a===!0||a===!1||a&&"object"==typeof a&&Ad.call(a)==N||!1}function yb(a){return a&&"object"==typeof a&&Ad.call(a)==O||!1}function zb(a){return a&&1===a.nodeType||!1}function Ab(a){var b=!0;if(!a)return b;var c=Ad.call(a),d=a.length;return c==M||c==T||c==L||c==R&&"number"==typeof d&&Db(a.splice)?!d:(he(a,function(){return b=!1}),b)}function Bb(a,b,c,d){return ab(a,b,"function"==typeof c&&w(c,d,2))}function Cb(a){return Pd(a)&&!Qd(parseFloat(a))}function Db(a){return"function"==typeof a}function Eb(a){return!(!a||!X[typeof a])}function Fb(a){return Hb(a)&&a!=+a}function Gb(a){return null===a}function Hb(a){return"number"==typeof a||a&&"object"==typeof a&&Ad.call(a)==Q||!1}function Ib(a){return a&&"object"==typeof a&&Ad.call(a)==S||!1}function Jb(a){return"string"==typeof a||a&&"object"==typeof a&&Ad.call(a)==T||!1}function Kb(a){return"undefined"==typeof a}function Lb(a,c,d){var e={};return c=b.createCallback(c,d,3),he(a,function(a,b,d){e[b]=c(a,b,d)}),e}function Mb(a){var b=arguments,c=2;if(!Eb(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=w(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var e=o(arguments,1,c),f=-1,g=k(),h=k();++f<c;)bb(a,e[f],d,g,h);return m(g),m(h),a}function Nb(a,c,d){var e={};if("function"!=typeof c){var f=[];ge(a,function(a,b){f.push(b)}),f=$(f,_(arguments,!0,!1,1));for(var g=-1,h=f.length;++g<h;){var i=f[g];e[i]=a[i]}}else c=b.createCallback(c,d,3),ge(a,function(a,b,d){c(a,b,d)||(e[b]=a)});return e}function Ob(a){for(var b=-1,c=_d(a),d=c.length,e=nd(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Pb(a,c,d){var e={};if("function"!=typeof c)for(var f=-1,g=_(arguments,!0,!1,1),h=Eb(a)?g.length:0;++f<h;){var i=g[f];i in a&&(e[i]=a[i])}else c=b.createCallback(c,d,3),ge(a,function(a,b,d){c(a,b,d)&&(e[b]=a)});return e}function Qb(a,c,d,e){var f=Zd(a);if(null==d)if(f)d=[];else{var g=a&&a.constructor,h=g&&g.prototype;d=s(h)}return c&&(c=b.createCallback(c,e,4),(f?Yb:he)(a,function(a,b,e){return c(d,a,b,e)})),d}function Rb(a){for(var b=-1,c=_d(a),d=c.length,e=nd(d);++b<d;)e[b]=a[c[b]];return e}function Sb(a){for(var b=arguments,c=-1,d=_(b,!0,!1,1),e=b[2]&&b[2][b[1]]===a?1:d.length,f=nd(e);++c<e;)f[c]=a[d[c]];return f}function Tb(a,b,c){var d=-1,e=ib(),f=a?a.length:0,g=!1;return c=(0>c?Sd(0,f+c):c)||0,Zd(a)?g=e(a,b,c)>-1:"number"==typeof f?g=(Jb(a)?a.indexOf(b,c):e(a,b,c))>-1:he(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Ub(a,c,d){var e=!0;c=b.createCallback(c,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&(e=!!c(a[f],f,a)););else he(a,function(a,b,d){return e=!!c(a,b,d)});return e}function Vb(a,c,d){var e=[];c=b.createCallback(c,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g;){var h=a[f];c(h,f,a)&&e.push(h)}else he(a,function(a,b,d){c(a,b,d)&&e.push(a)});return e}function Wb(a,c,d){c=b.createCallback(c,d,3);var e=-1,f=a?a.length:0;if("number"!=typeof f){var g;return he(a,function(a,b,d){return c(a,b,d)?(g=a,!1):void 0}),g}for(;++e<f;){var h=a[e];if(c(h,e,a))return h}}function Xb(a,c,d){var e;return c=b.createCallback(c,d,3),Zb(a,function(a,b,d){return c(a,b,d)?(e=a,!1):void 0}),e}function Yb(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:w(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else he(a,b);return a}function Zb(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:w(b,c,3),"number"==typeof d)for(;d--&&b(a[d],d,a)!==!1;);else{var e=_d(a);d=e.length,he(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function $b(a,b){var c=o(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=nd("number"==typeof f?f:0);return Yb(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function _b(a,c,d){var e=-1,f=a?a.length:0;if(c=b.createCallback(c,d,3),"number"==typeof f)for(var g=nd(f);++e<f;)g[e]=c(a[e],e,a);else g=[],he(a,function(a,b,d){g[++e]=c(a,b,d)});return g}function ac(a,c,d){var e=-1/0,f=e;if("function"!=typeof c&&d&&d[c]===a&&(c=null),null==c&&Zd(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];j>f&&(f=j)}else c=null==c&&Jb(a)?g:b.createCallback(c,d,3),Yb(a,function(a,b,d){var g=c(a,b,d);g>e&&(e=g,f=a)});return f}function bc(a,c,d){var e=1/0,f=e;if("function"!=typeof c&&d&&d[c]===a&&(c=null),null==c&&Zd(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];f>j&&(f=j)}else c=null==c&&Jb(a)?g:b.createCallback(c,d,3),Yb(a,function(a,b,d){var g=c(a,b,d);e>g&&(e=g,f=a)});return f}function cc(a,c,d,e){if(!a)return d;var f=arguments.length<3;c=b.createCallback(c,e,4);var g=-1,h=a.length;if("number"==typeof h)for(f&&(d=a[++g]);++g<h;)d=c(d,a[g],g,a);else he(a,function(a,b,e){d=f?(f=!1,a):c(d,a,b,e)});return d}function dc(a,c,d,e){var f=arguments.length<3;return c=b.createCallback(c,e,4),Zb(a,function(a,b,e){d=f?(f=!1,a):c(d,a,b,e)}),d}function ec(a,c,d){return c=b.createCallback(c,d,3),Vb(a,function(a,b,d){return!c(a,b,d)})}function fc(a,b,c){if(a&&"number"!=typeof a.length&&(a=Rb(a)),null==b||c)return a?a[db(0,a.length-1)]:q;var d=gc(a);return d.length=Td(Sd(0,b),d.length),d}function gc(a){var b=-1,c=a?a.length:0,d=nd("number"==typeof c?c:0);return Yb(a,function(a){var c=db(0,++b);d[b]=d[c],d[c]=a}),d}function hc(a){var b=a?a.length:0;return"number"==typeof b?b:_d(a).length}function ic(a,c,d){var e;c=b.createCallback(c,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&!(e=c(a[f],f,a)););else he(a,function(a,b,d){return!(e=c(a,b,d))});return!!e}function jc(a,c,d){var e=-1,f=Zd(c),g=a?a.length:0,i=nd("number"==typeof g?g:0);for(f||(c=b.createCallback(c,d,3)),Yb(a,function(a,b,d){var g=i[++e]=l();f?g.criteria=_b(c,function(b){return a[b]}):(g.criteria=k())[0]=c(a,b,d),g.index=e,g.value=a}),g=i.length,i.sort(h);g--;){var j=i[g];i[g]=j.value,f||m(j.criteria),n(j)}return i}function kc(a){return a&&"number"==typeof a.length?o(a):Rb(a)}function lc(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function mc(a){return $(a,_(arguments,!0,!0,1))}function nc(a,c,d){var e=-1,f=a?a.length:0;for(c=b.createCallback(c,d,3);++e<f;)if(c(a[e],e,a))return e;return-1}function oc(a,c,d){var e=a?a.length:0;for(c=b.createCallback(c,d,3);e--;)if(c(a[e],e,a))return e;return-1}function pc(a,c,d){var e=0,f=a?a.length:0;if("number"!=typeof c&&null!=c){var g=-1;for(c=b.createCallback(c,d,3);++g<f&&c(a[g],g,a);)e++}else if(e=c,null==e||d)return a?a[0]:q;return o(a,0,Td(Sd(0,e),f))}function qc(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=_b(a,c,d)),_(a,b)}function rc(a,b,c){if("number"==typeof c){var e=a?a.length:0;c=0>c?Sd(0,e+c):c||0}else if(c){var f=Ac(a,b);return a[f]===b?f:-1}return d(a,b,c)}function sc(a,c,d){var e=0,f=a?a.length:0;if("number"!=typeof c&&null!=c){var g=f;for(c=b.createCallback(c,d,3);g--&&c(a[g],g,a);)e++}else e=null==c||d?1:c||e;return o(a,0,Td(Sd(0,f-e),f))}function tc(){for(var a=[],b=-1,c=arguments.length,f=k(),g=ib(),h=g===d,j=k();++b<c;){var l=arguments[b];(Zd(l)||mb(l))&&(a.push(l),f.push(h&&l.length>=v&&i(b?a[b]:j)))}var o=a[0],p=-1,q=o?o.length:0,r=[];a:for(;++p<q;){var s=f[0];if(l=o[p],(s?e(s,l):g(j,l))<0){for(b=c,(s||j).push(l);--b;)if(s=f[b],(s?e(s,l):g(a[b],l))<0)continue a;r.push(l)}}for(;c--;)s=f[c],s&&n(s);return m(f),m(j),r}function uc(a,c,d){var e=0,f=a?a.length:0;if("number"!=typeof c&&null!=c){var g=f;for(c=b.createCallback(c,d,3);g--&&c(a[g],g,a);)e++}else if(e=c,null==e||d)return a?a[f-1]:q;return o(a,Sd(0,f-e))}function vc(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Sd(0,d+c):Td(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function wc(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(Kd.call(a,f--,1),e--);return a}function xc(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Sd(0,Cd((b-a)/(c||1))),f=nd(e);++d<e;)f[d]=a,a+=c;return f}function yc(a,c,d){var e=-1,f=a?a.length:0,g=[];for(c=b.createCallback(c,d,3);++e<f;){var h=a[e];c(h,e,a)&&(g.push(h),Kd.call(a,e--,1),f--)}return g}function zc(a,c,d){if("number"!=typeof c&&null!=c){var e=0,f=-1,g=a?a.length:0;for(c=b.createCallback(c,d,3);++f<g&&c(a[f],f,a);)e++}else e=null==c||d?1:Sd(0,c);return o(a,e)}function Ac(a,c,d,e){var f=0,g=a?a.length:f;for(d=d?b.createCallback(d,e,1):Zc,c=d(c);g>f;){var h=f+g>>>1;d(a[h])<c?f=h+1:g=h}return f}function Bc(){return eb(_(arguments,!0,!0))}function Cc(a,c,d,e){return"boolean"!=typeof c&&null!=c&&(e=d,d="function"!=typeof c&&e&&e[c]===a?null:c,c=!1),null!=d&&(d=b.createCallback(d,e,3)),eb(a,c,d)}function Dc(a){return $(a,o(arguments,1))}function Ec(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Zd(c)||mb(c))var d=d?eb($(d,c).concat($(c,d))):c}return d||[]}function Fc(){for(var a=arguments.length>1?arguments:arguments[0],b=-1,c=a?ac(me(a,"length")):0,d=nd(0>c?0:c);++b<c;)d[b]=me(a,b);return d}function Gc(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Zd(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Hc(a,b){if(!Db(b))throw new wd;return function(){return--a<1?b.apply(this,arguments):void 0}}function Ic(a,b){return arguments.length>2?gb(a,17,o(arguments,2),null,b):gb(a,1,null,null,b)}function Jc(a){for(var b=arguments.length>1?_(arguments,!0,!1,1):ub(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=gb(a[e],1,null,null,a)}return a}function Kc(a,b){return arguments.length>2?gb(b,19,o(arguments,2),null,a):gb(b,3,null,null,a)}function Lc(){for(var a=arguments,b=a.length;b--;)if(!Db(a[b]))throw new wd;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Mc(a,b){return b="number"==typeof b?b:+b||a.length,gb(a,4,null,null,null,b)}function Nc(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!Db(a))throw new wd;if(b=Sd(0,b)||0,c===!0){var n=!0;m=!1}else Eb(c)&&(n=c.leading,l="maxWait"in c&&(Sd(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var o=function(){var c=b-(oe()-g);if(0>=c){e&&Dd(e);var l=j;e=i=j=q,l&&(k=oe(),f=a.apply(h,d),i||e||(d=h=null))}else i=Jd(o,c)},p=function(){i&&Dd(i),e=i=j=q,(m||l!==b)&&(k=oe(),f=a.apply(h,d),i||e||(d=h=null))};return function(){if(d=arguments,g=oe(),h=this,j=m&&(i||!n),l===!1)var c=n&&!i;else{e||n||(k=g);var q=l-(g-k),r=0>=q;r?(e&&(e=Dd(e)),k=g,f=a.apply(h,d)):e||(e=Jd(p,q))}return r&&i?i=Dd(i):i||b===l||(i=Jd(o,b)),c&&(r=!0,f=a.apply(h,d)),!r||i||e||(d=h=null),f}}function Oc(a){if(!Db(a))throw new wd;var b=o(arguments,1);return Jd(function(){a.apply(q,b)},1)}function Pc(a,b){if(!Db(a))throw new wd;var c=o(arguments,2);return Jd(function(){a.apply(q,c)},b)}function Qc(a,b){if(!Db(a))throw new wd;var c=function(){var d=c.cache,e=b?b.apply(this,arguments):u+arguments[0];return Hd.call(d,e)?d[e]:d[e]=a.apply(this,arguments)};return c.cache={},c}function Rc(a){var b,c;if(!Db(a))throw new wd;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Sc(a){return gb(a,16,o(arguments,1))}function Tc(a){return gb(a,32,null,o(arguments,1))}function Uc(a,b,c){var d=!0,e=!0;if(!Db(a))throw new wd;return c===!1?d=!1:Eb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),V.leading=d,V.maxWait=b,V.trailing=e,Nc(a,b,V)}function Vc(a,b){return gb(b,16,[a])}function Wc(a){return function(){return a}}function Xc(a,b,c){var d=typeof a;if(null==a||"function"==d)return w(a,b,c);if("object"!=d)return bd(a);var e=_d(a),f=e[0],g=a[f];return 1!=e.length||g!==g||Eb(g)?function(b){for(var c=e.length,d=!1;c--&&(d=ab(b[e[c]],a[e[c]],null,!0)););return d}:function(a){var b=a[f];return g===b&&(0!==g||1/g==1/b)}}function Yc(a){return null==a?"":vd(a).replace(de,hb)}function Zc(a){return a}function $c(a,d,e){var f=!0,g=d&&ub(d);d&&(e||g.length)||(null==e&&(e=d),h=c,d=a,a=b,g=ub(d)),e===!1?f=!1:Eb(e)&&"chain"in e&&(f=e.chain);var h=a,i=Db(h);Yb(g,function(b){var c=a[b]=d[b];i&&(h.prototype[b]=function(){var b=this.__chain__,d=this.__wrapped__,e=[d];Id.apply(e,arguments);var g=c.apply(a,e);if(f||b){if(d===g&&Eb(g))return this;g=new h(g),g.__chain__=b}return g})})}function _c(){return a._=zd,this}function ad(){}function bd(a){return function(b){return b[a]}}function cd(a,b,c){var d=null==a,e=null==b;if(null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1){var f=Vd();return Td(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b)}return db(a,b)}function dd(a,b){if(a){var c=a[b];return Db(c)?a[b]():c}}function ed(a,c,d){var e=b.templateSettings;a=vd(a||""),d=fe({},d,e);var f,g=fe({},d.imports,e.imports),h=_d(g),i=Rb(g),k=0,l=d.interpolate||G,m="__p += '",n=ud((d.escape||G).source+"|"+l.source+"|"+(l===E?B:G).source+"|"+(d.evaluate||G).source+"|$","g");a.replace(n,function(b,c,d,e,g,h){return d||(d=e),m+=a.slice(k,h).replace(I,j),c&&(m+="' +\n__e("+c+") +\n'"),g&&(f=!0,m+="';\n"+g+";\n__p += '"),d&&(m+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),k=h+b.length,b}),m+="';\n";var o=d.variable,p=o;p||(o="obj",m="with ("+o+") {\n"+m+"\n}\n"),m=(f?m.replace(y,""):m).replace(z,"$1").replace(A,"$1;"),m="function("+o+") {\n"+(p?"":o+" || ("+o+" = {});\n")+"var __t, __p = '', __e = _.escape"+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var r="\n/*\n//# sourceURL="+(d.sourceURL||"/lodash/template/source["+K++ +"]")+"\n*/";try{var s=qd(h,"return "+m+r).apply(q,i)}catch(t){throw t.source=m,t}return c?s(c):(s.source=m,s)}function fd(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=nd(a);for(b=w(b,c,1);++d<a;)e[d]=b(d);return e}function gd(a){return null==a?"":vd(a).replace(ce,lb)}function hd(a){var b=++t;return vd(null==a?"":a)+b}function id(a){return a=new c(a),a.__chain__=!0,a}function jd(a,b){return b(a),a}function kd(){return this.__chain__=!0,this}function ld(){return vd(this.__wrapped__)}function md(){return this.__wrapped__}a=a?cb.defaults(Z.Object(),a,cb.pick(Z,J)):Z;var nd=a.Array,od=a.Boolean,pd=a.Date,qd=a.Function,rd=a.Math,sd=a.Number,td=a.Object,ud=a.RegExp,vd=a.String,wd=a.TypeError,xd=[],yd=td.prototype,zd=a._,Ad=yd.toString,Bd=ud("^"+vd(Ad).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Cd=rd.ceil,Dd=a.clearTimeout,Ed=rd.floor,Fd=qd.prototype.toString,Gd=jb(Gd=td.getPrototypeOf)&&Gd,Hd=yd.hasOwnProperty,Id=xd.push,Jd=a.setTimeout,Kd=xd.splice,Ld=xd.unshift,Md=function(){try{var a={},b=jb(b=td.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),Nd=jb(Nd=td.create)&&Nd,Od=jb(Od=nd.isArray)&&Od,Pd=a.isFinite,Qd=a.isNaN,Rd=jb(Rd=td.keys)&&Rd,Sd=rd.max,Td=rd.min,Ud=a.parseInt,Vd=rd.random,Wd={};Wd[M]=nd,Wd[N]=od,Wd[O]=pd,Wd[P]=qd,Wd[R]=td,Wd[Q]=sd,Wd[S]=ud,Wd[T]=vd,c.prototype=b.prototype;var Xd=b.support={};Xd.funcDecomp=!jb(a.WinRTError)&&H.test(p),Xd.funcNames="string"==typeof qd.name,b.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:E,variable:"",imports:{_:b}},Nd||(s=function(){function b(){}return function(c){if(Eb(c)){b.prototype=c;var d=new b;b.prototype=null}return d||a.Object()}}());var Yd=Md?function(a,b){W.value=b,Md(a,"__bindData__",W)}:ad,Zd=Od||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ad.call(a)==M||!1},$d=function(a){var b,c=a,d=[];if(!c)return d;if(!X[typeof a])return d;for(b in c)Hd.call(c,b)&&d.push(b);return d},_d=Rd?function(a){return Eb(a)?Rd(a):[]}:$d,ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},be=wb(ae),ce=ud("("+_d(be).join("|")+")","g"),de=ud("["+_d(ae).join("")+"]","g"),ee=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=w(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&X[typeof e])for(var k=-1,l=X[typeof e]&&_d(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},fe=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&X[typeof e])for(var j=-1,k=X[typeof e]&&_d(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},ge=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!X[typeof e])return f;b=b&&"undefined"==typeof c?b:w(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return f;return f},he=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!X[typeof e])return f;b=b&&"undefined"==typeof c?b:w(b,c,3);for(var g=-1,h=X[typeof e]&&_d(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},ie=Gd?function(a){if(!a||Ad.call(a)!=R)return!1;var b=a.valueOf,c=jb(b)&&(c=Gd(b))&&Gd(c);return c?a==c||Gd(a)==c:kb(a)}:kb,je=fb(function(a,b,c){Hd.call(a,c)?a[c]++:a[c]=1}),ke=fb(function(a,b,c){(Hd.call(a,c)?a[c]:a[c]=[]).push(b)}),le=fb(function(a,b,c){a[c]=b}),me=_b,ne=Vb,oe=jb(oe=pd.now)&&oe||function(){return(new pd).getTime()},pe=8==Ud(x+"08")?Ud:function(a,b){return Ud(Jb(a)?a.replace(F,""):a,b||0)};return b.after=Hc,b.assign=ee,b.at=Sb,b.bind=Ic,b.bindAll=Jc,b.bindKey=Kc,b.chain=id,b.compact=lc,b.compose=Lc,b.constant=Wc,b.countBy=je,b.create=pb,b.createCallback=Xc,b.curry=Mc,b.debounce=Nc,b.defaults=fe,b.defer=Oc,b.delay=Pc,b.difference=mc,b.filter=Vb,b.flatten=qc,b.forEach=Yb,b.forEachRight=Zb,b.forIn=ge,b.forInRight=sb,b.forOwn=he,b.forOwnRight=tb,b.functions=ub,b.groupBy=ke,b.indexBy=le,b.initial=sc,b.intersection=tc,b.invert=wb,b.invoke=$b,b.keys=_d,b.map=_b,b.mapValues=Lb,b.max=ac,b.memoize=Qc,b.merge=Mb,b.min=bc,b.omit=Nb,b.once=Rc,b.pairs=Ob,b.partial=Sc,b.partialRight=Tc,b.pick=Pb,b.pluck=me,b.property=bd,b.pull=wc,b.range=xc,b.reject=ec,b.remove=yc,b.rest=zc,b.shuffle=gc,b.sortBy=jc,b.tap=jd,b.throttle=Uc,b.times=fd,b.toArray=kc,b.transform=Qb,b.union=Bc,b.uniq=Cc,b.values=Rb,b.where=ne,b.without=Dc,b.wrap=Vc,b.xor=Ec,b.zip=Fc,b.zipObject=Gc,b.collect=_b,b.drop=zc,b.each=Yb,b.eachRight=Zb,b.extend=ee,b.methods=ub,b.object=Gc,b.select=Vb,b.tail=zc,b.unique=Cc,b.unzip=Fc,$c(b),b.clone=nb,b.cloneDeep=ob,b.contains=Tb,b.escape=Yc,b.every=Ub,b.find=Wb,b.findIndex=nc,b.findKey=qb,b.findLast=Xb,b.findLastIndex=oc,b.findLastKey=rb,b.has=vb,b.identity=Zc,b.indexOf=rc,b.isArguments=mb,b.isArray=Zd,b.isBoolean=xb,b.isDate=yb,b.isElement=zb,b.isEmpty=Ab,b.isEqual=Bb,b.isFinite=Cb,b.isFunction=Db,b.isNaN=Fb,b.isNull=Gb,b.isNumber=Hb,b.isObject=Eb,b.isPlainObject=ie,b.isRegExp=Ib,b.isString=Jb,b.isUndefined=Kb,b.lastIndexOf=vc,b.mixin=$c,b.noConflict=_c,b.noop=ad,b.now=oe,b.parseInt=pe,b.random=cd,b.reduce=cc,b.reduceRight=dc,b.result=dd,b.runInContext=p,b.size=hc,b.some=ic,b.sortedIndex=Ac,b.template=ed,b.unescape=gd,b.uniqueId=hd,b.all=Ub,b.any=ic,b.detect=Wb,b.findWhere=Wb,b.foldl=cc,b.foldr=dc,b.include=Tb,b.inject=cc,$c(function(){var a={};return he(b,function(c,d){b.prototype[d]||(a[d]=c)}),a}(),!1),b.first=pc,b.last=uc,b.sample=fc,b.take=pc,b.head=pc,he(b,function(a,d){var e="sample"!==d;b.prototype[d]||(b.prototype[d]=function(b,d){var f=this.__chain__,g=a(this.__wrapped__,b,d);return f||null!=b&&(!d||e&&"function"==typeof b)?new c(g,f):g})}),b.VERSION="2.4.1",b.prototype.chain=kd,b.prototype.toString=ld,b.prototype.value=md,b.prototype.valueOf=md,Yb(["join","pop","shift"],function(a){var d=xd[a];b.prototype[a]=function(){var a=this.__chain__,b=d.apply(this.__wrapped__,arguments);return a?new c(b,a):b}}),Yb(["push","reverse","sort","unshift"],function(a){var c=xd[a];b.prototype[a]=function(){return c.apply(this.__wrapped__,arguments),this}}),Yb(["concat","slice","splice"],function(a){var d=xd[a];b.prototype[a]=function(){return new c(d.apply(this.__wrapped__,arguments),this.__chain__)}}),b}var q,r=[],s=[],t=0,u=+new Date+"",v=75,w=40,x=" 	\f\n\r\u2028\u2029",y=/\b__p \+= '';/g,z=/\b(__p \+=) '' \+/g,A=/(__e\(.*?\)|\b__t\)) \+\n'';/g,B=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,D=/^\s*function[ \n\r\t]+\w/,E=/<%=([\s\S]+?)%>/g,F=RegExp("^["+x+"]*0+(?=.$)"),G=/($^)/,H=/\bthis\b/,I=/['\n\r\t\u2028\u2029\\]/g,J=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],K=0,L="[object Arguments]",M="[object Array]",N="[object Boolean]",O="[object Date]",P="[object Function]",Q="[object Number]",R="[object Object]",S="[object RegExp]",T="[object String]",U={};U[P]=!1,U[L]=U[M]=U[N]=U[O]=U[Q]=U[R]=U[S]=U[T]=!0;var V={leading:!1,maxWait:0,trailing:!1},W={configurable:!1,enumerable:!1,value:null,writable:!1},X={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Y={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},Z=X[typeof window]&&window||this,$=X[typeof c]&&c&&!c.nodeType&&c,_=X[typeof b]&&b&&!b.nodeType&&b,ab=_&&_.exports===$&&$,bb=X[typeof a]&&a;!bb||bb.global!==bb&&bb.window!==bb||(Z=bb);var cb=p();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Z._=cb,define(function(){return cb})):$&&_?ab?(_.exports=cb)._=cb:$._=cb:Z._=cb}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],70:[function(a,b,c){(function(a){!function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof c)b.exports=a();else if("function"==typeof define&&define.amd)define(a);
else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else Q=a()}(function(){"use strict";function b(a){return function(){return W.apply(a,arguments)}}function c(a){return a===Object(a)}function d(a){return"[object StopIteration]"===cb(a)||a instanceof S}function e(a,b){if(P&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(db)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var e=c.join("\n"+db+"\n");a.stack=f(e)}}function f(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];i(e)||g(e)||!e||c.push(e)}return c.join("\n")}function g(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function h(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function i(a){var b=h(a);if(!b)return!1;var c=b[0],d=b[1];return c===R&&d>=T&&hb>=d}function j(){if(P)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=h(c);if(!d)return;return R=d[0],d[1]}}function k(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function l(a){return s(a)?a:t(a)?C(a):B(a)}function m(){function a(a){b=a,f.source=a,Y(c,function(b,c){V(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=_(m.prototype),f=_(p.prototype);if(f.promiseDispatch=function(a,e,f){var g=X(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):V(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=r(b);return s(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},l.longStackSupport&&P)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(l(c))},e.fulfill=function(c){b||a(B(c))},e.reject=function(c){b||a(A(c))},e.notify=function(a){b||Y(d,function(b,c){V(function(){c(a)})},void 0)},e}function n(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=m();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function o(a){return n(function(b,c){for(var d=0,e=a.length;e>d;d++)l(a[d]).then(b,c)})}function p(a,b,c){void 0===b&&(b=function(a){return A(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=_(p.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=A(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function q(a,b,c,d){return l(a).then(b,c,d)}function r(a){if(s(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function s(a){return c(a)&&"function"==typeof a.promiseDispatch&&"function"==typeof a.inspect}function t(a){return c(a)&&"function"==typeof a.then}function u(a){return s(a)&&"pending"===a.inspect().state}function v(a){return!s(a)||"fulfilled"===a.inspect().state}function w(a){return s(a)&&"rejected"===a.inspect().state}function x(){eb.length=0,fb.length=0,gb||(gb=!0)}function y(a,b){gb&&(fb.push(a),eb.push(b&&"undefined"!=typeof b.stack?b.stack:"(no stack) "+b))}function z(a){if(gb){var b=Z(fb,a);-1!==b&&(fb.splice(b,1),eb.splice(b,1))}}function A(a){var b=p({when:function(b){return b&&z(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return y(b,a),b}function B(a){return p({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return bb(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function C(a){var b=m();return V(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function D(a){return p({isDef:function(){}},function(b,c){return J(a,b,c)},function(){return l(a).inspect()})}function E(a,b,c){return l(a).spread(b,c)}function F(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=c[a](b)}catch(h){return A(h)}return g.done?g.value:q(g.value,e,f)}try{g=c[a](b)}catch(h){return d(h)?h.value:A(h)}return q(g,e,f)}var c=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function G(a){l.done(l.async(a)())}function H(a){throw new S(a)}function I(a){return function(){return E([this,K(arguments)],function(b,c){return a.apply(b,c)})}}function J(a,b,c){return l(a).dispatch(b,c)}function K(a){return q(a,function(a){var b=0,c=m();return Y(a,function(d,e,f){var g;s(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,q(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function L(a){return q(a,function(a){return a=$(a,l),q(K($(a,function(a){return q(a,U,U)})),function(){return a})})}function M(a){return l(a).allSettled()}function N(a,b){return l(a).then(void 0,void 0,b)}function O(a,b){return l(a).nodeify(b)}var P=!1;try{throw new Error}catch(Q){P=!!Q.stack}var R,S,T=j(),U=function(){},V=function(){function b(){for(;c.next;){c=c.next;var a=c.task;c.task=void 0;var d=c.domain;d&&(c.domain=void 0,d.enter());try{a()}catch(f){if(g)throw d&&d.exit(),setTimeout(b,0),d&&d.enter(),f;setTimeout(function(){throw f},0)}d&&d.exit()}e=!1}var c={task:void 0,next:null},d=c,e=!1,f=void 0,g=!1;if(V=function(b){d=d.next={task:b,domain:g&&a.domain,next:null},e||(e=!0,f())},"undefined"!=typeof a&&a.nextTick)g=!0,f=function(){a.nextTick(b)};else if("function"==typeof setImmediate)f="undefined"!=typeof window?setImmediate.bind(window,b):function(){setImmediate(b)};else if("undefined"!=typeof MessageChannel){var h=new MessageChannel;h.port1.onmessage=function(){f=i,h.port1.onmessage=b,b()};var i=function(){h.port2.postMessage(0)};f=function(){setTimeout(b,0),i()}}else f=function(){setTimeout(b,0)};return V}(),W=Function.call,X=b(Array.prototype.slice),Y=b(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Z=b(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),$=b(Array.prototype.map||function(a,b){var c=this,d=[];return Y(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),_=Object.create||function(a){function b(){}return b.prototype=a,new b},ab=b(Object.prototype.hasOwnProperty),bb=Object.keys||function(a){var b=[];for(var c in a)ab(a,c)&&b.push(c);return b},cb=b(Object.prototype.toString);S="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var db="From previous event:";l.resolve=l,l.nextTick=V,l.longStackSupport=!1,l.defer=m,m.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?X(arguments,1):c)}},l.Promise=n,l.promise=n,n.race=o,n.all=K,n.reject=A,n.resolve=l,l.passByCopy=function(a){return a},p.prototype.passByCopy=function(){return this},l.join=function(a,b){return l(a).join(b)},p.prototype.join=function(a){return l([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},l.race=o,p.prototype.race=function(){return this.then(l.race)},l.makePromise=p,p.prototype.toString=function(){return"[object Promise]"},p.prototype.then=function(a,b,c){function d(b){try{return"function"==typeof a?a(b):b}catch(c){return A(c)}}function f(a){if("function"==typeof b){e(a,h);try{return b(a)}catch(c){return A(c)}}return A(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=m(),j=!1;return V(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(d(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!l.onerror)throw d;l.onerror(d)}c||i.notify(b)}]),i.promise},l.when=q,p.prototype.thenResolve=function(a){return this.then(function(){return a})},l.thenResolve=function(a,b){return l(a).thenResolve(b)},p.prototype.thenReject=function(a){return this.then(function(){throw a})},l.thenReject=function(a,b){return l(a).thenReject(b)},l.nearer=r,l.isPromise=s,l.isPromiseAlike=t,l.isPending=u,p.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=v,p.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=w,p.prototype.isRejected=function(){return"rejected"===this.inspect().state};var eb=[],fb=[],gb=!0;l.resetUnhandledRejections=x,l.getUnhandledReasons=function(){return eb.slice()},l.stopUnhandledRejectionTracking=function(){x(),gb=!1},x(),l.reject=A,l.fulfill=B,l.master=D,l.spread=E,p.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},l.async=F,l.spawn=G,l["return"]=H,l.promised=I,l.dispatch=J,p.prototype.dispatch=function(a,b){var c=this,d=m();return V(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},l.get=function(a,b){return l(a).dispatch("get",[b])},p.prototype.get=function(a){return this.dispatch("get",[a])},l.set=function(a,b,c){return l(a).dispatch("set",[b,c])},p.prototype.set=function(a,b){return this.dispatch("set",[a,b])},l.del=l["delete"]=function(a,b){return l(a).dispatch("delete",[b])},p.prototype.del=p.prototype["delete"]=function(a){return this.dispatch("delete",[a])},l.mapply=l.post=function(a,b,c){return l(a).dispatch("post",[b,c])},p.prototype.mapply=p.prototype.post=function(a,b){return this.dispatch("post",[a,b])},l.send=l.mcall=l.invoke=function(a,b){return l(a).dispatch("post",[b,X(arguments,2)])},p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(a){return this.dispatch("post",[a,X(arguments,1)])},l.fapply=function(a,b){return l(a).dispatch("apply",[void 0,b])},p.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},l["try"]=l.fcall=function(a){return l(a).dispatch("apply",[void 0,X(arguments,1)])},p.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},l.fbind=function(a){var b=l(a),c=X(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(X(arguments))])}},p.prototype.fbind=function(){var a=this,b=X(arguments);return function(){return a.dispatch("apply",[this,b.concat(X(arguments))])}},l.keys=function(a){return l(a).dispatch("keys",[])},p.prototype.keys=function(){return this.dispatch("keys",[])},l.all=K,p.prototype.all=function(){return K(this)},l.allResolved=k(L,"allResolved","allSettled"),p.prototype.allResolved=function(){return L(this)},l.allSettled=M,p.prototype.allSettled=function(){return this.then(function(a){return K($(a,function(a){function b(){return a.inspect()}return a=l(a),a.then(b,b)}))})},l.fail=l["catch"]=function(a,b){return l(a).then(void 0,b)},p.prototype.fail=p.prototype["catch"]=function(a){return this.then(void 0,a)},l.progress=N,p.prototype.progress=function(a){return this.then(void 0,void 0,a)},l.fin=l["finally"]=function(a,b){return l(a)["finally"](b)},p.prototype.fin=p.prototype["finally"]=function(a){return a=l(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},l.done=function(a,b,c,d){return l(a).done(b,c,d)},p.prototype.done=function(b,c,d){var f=function(a){V(function(){if(e(a,g),!l.onerror)throw a;l.onerror(a)})},g=b||c||d?this.then(b,c,d):this;"object"==typeof a&&a&&a.domain&&(f=a.domain.bind(f)),g.then(void 0,f)},l.timeout=function(a,b,c){return l(a).timeout(b,c)},p.prototype.timeout=function(a,b){var c=m(),d=setTimeout(function(){c.reject(new Error(b||"Timed out after "+a+" ms"))},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},l.delay=function(a,b){return void 0===b&&(b=a,a=void 0),l(a).delay(b)},p.prototype.delay=function(a){return this.then(function(b){var c=m();return setTimeout(function(){c.resolve(b)},a),c.promise})},l.nfapply=function(a,b){return l(a).nfapply(b)},p.prototype.nfapply=function(a){var b=m(),c=X(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},l.nfcall=function(a){var b=X(arguments,1);return l(a).nfapply(b)},p.prototype.nfcall=function(){var a=X(arguments),b=m();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},l.nfbind=l.denodeify=function(a){var b=X(arguments,1);return function(){var c=b.concat(X(arguments)),d=m();return c.push(d.makeNodeResolver()),l(a).fapply(c).fail(d.reject),d.promise}},p.prototype.nfbind=p.prototype.denodeify=function(){var a=X(arguments);return a.unshift(this),l.denodeify.apply(void 0,a)},l.nbind=function(a,b){var c=X(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(X(arguments)),f=m();return e.push(f.makeNodeResolver()),l(d).fapply(e).fail(f.reject),f.promise}},p.prototype.nbind=function(){var a=X(arguments,0);return a.unshift(this),l.nbind.apply(void 0,a)},l.nmapply=l.npost=function(a,b,c){return l(a).npost(b,c)},p.prototype.nmapply=p.prototype.npost=function(a,b){var c=X(b||[]),d=m();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},l.nsend=l.nmcall=l.ninvoke=function(a,b){var c=X(arguments,2),d=m();return c.push(d.makeNodeResolver()),l(a).dispatch("post",[b,c]).fail(d.reject),d.promise},p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(a){var b=X(arguments,1),c=m();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},l.nodeify=O,p.prototype.nodeify=function(a){return a?void this.then(function(b){V(function(){a(null,b)})},function(b){V(function(){a(b)})}):this};var hb=j();return l})}).call(this,a("FWaASH"))},{FWaASH:33}],71:[function(a,b){Tandem=a("tandem-core"),Tandem.Client=a("./build/client/tandem"),Tandem.File=a("./build/client/file"),Tandem.Network={Adapter:a("./build/client/network/adapter")},b.exports=Tandem},{"./build/client/file":72,"./build/client/network/adapter":73,"./build/client/tandem":74,"tandem-core":84}],72:[function(a,b){(function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=[].slice,r={}.hasOwnProperty,s=function(a,b){function c(){this.constructor=a}for(var d in b)r.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};p=a("lodash"),d=a("eventemitter2"),c=a("tandem-core/delta"),null!=d.EventEmitter2&&(d=d.EventEmitter2),f=function(){return this.adapter.listen(e.routes.UPDATE,function(a){return function(b){return a.ready?b.fileId!==a.fileId?o("Got update for other file",b.fileId):a.remoteUpdate(b.delta,b.version)?void 0:(o("Remote update failed, requesting resync"),k.call(a)):void 0}}(this))},g=function(){return this.adapter.on(this.adapter.constructor.events.RECONNECT,function(a){return function(){return l.call(a)}}(this)).on(this.adapter.constructor.events.RECONNECTING,function(a){return function(b,c){return 1===c?a.emit(e.events.HEALTH,e.health.ERROR,a.health):void 0}}(this)).on(this.adapter.constructor.events.DISCONNECT,function(a){return function(){return a.emit(e.events.HEALTH,e.health.ERROR,a.health)}}(this)).on(this.adapter.constructor.events.ERROR,function(a){return function(){var b;return b=1<=arguments.length?q.call(arguments,0):[],a.emit.apply(a,[e.events.ERROR].concat(q.call(b))),a.emit(e.events.HEALTH,e.health.ERROR,a.health)}}(this)),this.on(e.events.HEALTH,function(a){return function(b){return a.health=b}}(this))},h=function(){return f.call(this),g.call(this)},i=function(a){var b,d;return d=c.makeDelta(a.head),b=d.decompose(this.arrived),this.remoteUpdate(b,a.version),this.emit(e.events.HEALTH,e.health.HEALTHY,this.health)},j=function(a){return this.version=a.version,this.arrived=this.arrived.compose(this.inFlight),this.inFlight=c.getIdentity(this.arrived.endLength),sendUpdateIfReady.call(this)},k=function(a){return this.emit(e.events.HEALTH,e.health.WARNING,this.health),this.send(e.routes.RESYNC,{},function(b){return function(c){return i.call(b,c),null!=a?a():void 0}}(this))},l=function(a){return this.send(e.routes.SYNC,{version:this.version},function(b){return function(c){return p.isFunction(a)&&(a(c.error,b),b.emit(e.events.OPEN,c.error,b)),null==c.error?(b.emit(e.events.HEALTH,e.health.HEALTHY,b.health),c.resync?(b.ready=!1,o("Sync requesting resync"),i.call(b,c)):b.remoteUpdate(c.delta,c.version)?n.call(b,c.delta,c.version,!1):(o("Remote update failed on sync, requesting resync"),k.call(b,function(){return n.call(b,c.delta,c.version,!0)}))):void 0}}(this),!0)},m=function(){var a,b,d;return b={delta:this.inFlight,version:this.version},d=setTimeout(function(a){return function(){return o("Update taking over 10s to respond"),a.emit(e.events.HEALTH,e.health.WARNING,a.health)}}(this),1e4),a=this.updateCallbacks,this.updateCallbacks=[],this.send(e.routes.UPDATE,b,function(f){return function(g){return clearTimeout(d),g.error?(p.each(a,function(a){return a.call(f,g.error)}),void f.sendIfReady()):(f.health!==e.health.HEALTHY&&f.emit(e.events.HEALTH,e.health.HEALTHY,f.health),g.resync?(o("Update requesting resync",f.id,b,g),i.call(f,g),m.call(f)):(f.version=g.version,f.arrived=f.arrived.compose(f.inFlight),f.inFlight=c.getIdentity(f.arrived.endLength),p.each(a,function(a){return a.call(f,null,f.arrived)}),f.sendIfReady()))}}(this))},n=function(a,b,c){return null==c&&(c=!1),this.ready=!0,c&&!this.inFlight.isIdentity()&&m.call(this),this.emit(e.events.READY,a,b)},o=function(){var a;return a=1<=arguments.length?q.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console?console.warn:void 0)?p.isFunction(console.warn.apply)?console.warn.apply(console,a):console.warn(a):void 0},e=function(a){function b(a,d,e,f){this.fileId=a,this.adapter=d,null==f&&p.isFunction(e)&&(f=e,e={}),null==e&&(e={}),this.id=p.uniqueId("file-"),this.health=b.health.WARNING,this.ready=!1,this.version=e.version||0,this.arrived=e.head||c.getInitial(""),this.inFlight=c.getIdentity(this.arrived.endLength),this.inLine=c.getIdentity(this.arrived.endLength),this.updateCallbacks=[],this.adapter.ready?(this.emit(b.events.HEALTH,b.health.HEALTHY,this.health),l.call(this,f)):this.adapter.once(this.adapter.constructor.events.READY,function(a){return function(){return a.emit(b.events.HEALTH,b.health.HEALTHY,a.health),l.call(a,f)}}(this)),h.call(this)}return s(b,a),b.events={ERROR:"file-error",HEALTH:"file-health",OPEN:"file-open",READY:"file-ready",UPDATE:"file-update"},b.health={HEALTHY:"healthy",WARNING:"warning",ERROR:"error"},b.routes={BROADCAST:"broadcast",RESYNC:"ot/resync",SYNC:"ot/sync",UPDATE:"ot/update"},b.prototype.broadcast=function(a,c,d){return c=p.clone(c),c.type=a,this.adapter.send(b.routes.BROADCAST,c,d)},b.prototype.close=function(){return this.adapter.close(),this.removeAllListeners()},b.prototype.isDirty=function(){return!this.inFlight.isIdentity()||!this.inLine.isIdentity()},b.prototype.remoteUpdate=function(a,d){var e,f;return this.version=d,a=c.makeDelta(a),this.arrived.canCompose(a)?(this.arrived=this.arrived.compose(a),e=a.transform(this.inFlight,!1),f=e.transform(this.inLine,!1),this.inFlight=this.inFlight.transform(a,!0),this.inLine=this.inLine.transform(e,!0),this.emit(b.events.UPDATE,f),!0):!1},b.prototype.update=function(a,c){return this.inLine.canCompose(a)?(this.inLine=this.inLine.compose(a),this.sendIfReady(c)):(this.emit(b.events.ERROR,"Cannot compose inLine with local delta",this.inLine,a),o("Local update error, attempting resync",this.id,this.inLine,this.delta),k.call(this))},b.prototype.send=function(a,c,d,e){return null==d&&(d=null),null==e&&(e=!1),this.adapter.queue(a,c,function(a){return function(c){return null!=c.error&&a.emit(b.events.ERROR,c.error),null!=d?d(c):void 0}}(this),e)},b.prototype.sendIfReady=function(a){return null!=a&&this.updateCallbacks.push(a),this.inFlight.isIdentity()&&!this.inLine.isIdentity()?(this.inFlight=this.inLine,this.inLine=c.getIdentity(this.inFlight.endLength),m.call(this),!0):!1},b.prototype.transform=function(){},b}(d),b.exports=e}).call(this)},{eventemitter2:58,lodash:69,"tandem-core/delta":83}],73:[function(a,b){(function(){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h=[].slice;e=a("async"),c=a("eventemitter2"),null!=c.EventEmitter2&&(c=c.EventEmitter2),d=function(a){function b(){this.ready=!1,this.sendQueue=[]}return g(b,a),b.events={DISCONNECT:"adapter-disconnect",ERROR:"adapter-error",READY:"adapter-ready",RECONNECT:"adapter-reconnect",RECONNECTING:"adapter-reconnecting"},b.prototype.close=function(){return this.removeAllListeners()},b.prototype.listen=function(){return console.warn("Should be overwritten by descendant"),this},b.prototype.queue=function(a,b,c,d){return null==d&&(d=!1),this.ready?this.send(a,b,c,d):d?this.sendQueue.unshift([a,b,c]):this.sendQueue.push([a,b,c])},b.prototype.send=function(){return console.warn("Should be overwritten by descendant")},b.prototype.setReady=function(){return this.emit(b.events.READY),e.until(function(a){return function(){return 0===a.sendQueue.length}}(this),function(a){return function(b){var c,d,e,f;return c=a.sendQueue.shift(),e=c[0],d=c[1],f=c[2],a.send(e,d,function(){var c;return c=1<=arguments.length?h.call(arguments,0):[],null!=f&&f.apply(a,c),b()})}}(this),function(a){return function(){return a.ready=!0}}(this))},b}(c),b.exports=d}).call(this)},{async:75,eventemitter2:58}],74:[function(a,b){(function(){var c,d,e,f;f=a("lodash"),e=a("./file"),c=a("./network/adapter"),d=function(){function a(b,c){this.endpointUrl=b,this.options=null!=c?c:{},c=f.pick(this.options,f.keys(a.DEFAULTS)),this.settings=f.extend({},a.DEFAULTS,c),null==this.settings.userId&&(this.settings.userId="anonymous-"+f.random(1e6))}return a.DEFAULTS={userId:null,network:c},a.prototype.open=function(a,b,c,d){return this.adapter=f.isFunction(this.settings.network)?new this.settings.network(this.endpointUrl,a,this.settings.userId,b,this.options):this.settings.network,new e(a,this.adapter,c,d)},a}(),b.exports=d}).call(this)},{"./file":72,"./network/adapter":73,lodash:69}],75:[function(a,b){(function(a){!function(){function c(a){var b=!1;return function(){if(b)throw new Error("Callback was already called.");b=!0,a.apply(d,arguments)}}var d,e,f={};d=this,null!=d&&(e=d.async),f.noConflict=function(){return d.async=e,f};var g=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},h=function(a,b){if(a.map)return a.map(b);var c=[];return g(a,function(a,d,e){c.push(b(a,d,e))}),c},i=function(a,b,c){return a.reduce?a.reduce(b,c):(g(a,function(a,d,e){c=b(c,a,d,e)}),c)},j=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!=typeof a&&a.nextTick?(f.nextTick=a.nextTick,f.setImmediate="undefined"!=typeof setImmediate?function(a){setImmediate(a)}:f.nextTick):"function"==typeof setImmediate?(f.nextTick=function(a){setImmediate(a)},f.setImmediate=f.nextTick):(f.nextTick=function(a){setTimeout(a,0)},f.setImmediate=f.nextTick),f.each=function(a,b,d){if(d=d||function(){},!a.length)return d();var e=0;g(a,function(f){b(f,c(function(b){b?(d(b),d=function(){}):(e+=1,e>=a.length&&d(null))}))})},f.forEach=f.each,f.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c(null):e())})};e()},f.forEachSeries=f.eachSeries,f.eachLimit=function(a,b,c,d){var e=k(b);e.apply(null,[a,c,d])},f.forEachLimit=f.eachLimit;var k=function(a){return function(b,c,d){if(d=d||function(){},!b.length||0>=a)return d();var e=0,f=0,g=0;!function h(){if(e>=b.length)return d();for(;a>g&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})}()}},l=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.each].concat(b))}},m=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[k(a)].concat(c))}},n=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.eachSeries].concat(b))}},o=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})};f.map=l(o),f.mapSeries=n(o),f.mapLimit=function(a,b,c,d){return p(b)(a,c,d)};var p=function(a){return m(a,o)};f.reduce=function(a,b,c,d){f.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){d(a,b)})},f.inject=f.reduce,f.foldl=f.reduce,f.reduceRight=function(a,b,c,d){var e=h(a,function(a){return a}).reverse();f.reduce(e,b,c,d)},f.foldr=f.reduceRight;var q=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.filter=l(q),f.filterSeries=n(q),f.select=f.filter,f.selectSeries=f.filterSeries;var r=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.reject=l(r),f.rejectSeries=n(r);var s=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(){d()})};f.detect=l(s),f.detectSeries=n(s),f.some=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(){c(!1)})},f.any=f.some,f.every=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(){c(!0)})},f.all=f.every,f.sortBy=function(a,b,c){f.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);var d=function(a,b){var c=a.criteria,d=b.criteria;return d>c?-1:c>d?1:0};c(null,h(b.sort(d),function(a){return a.value}))})},f.auto=function(a,b){b=b||function(){};var c=j(a);if(!c.length)return b(null);var d={},e=[],h=function(a){e.unshift(a)},k=function(a){for(var b=0;b<e.length;b+=1)if(e[b]===a)return void e.splice(b,1)},l=function(){g(e.slice(0),function(a){a()})};h(function(){j(d).length===c.length&&(b(null,d),b=function(){})}),g(c,function(c){var e=a[c]instanceof Function?[a[c]]:a[c],m=function(a){var e=Array.prototype.slice.call(arguments,1);if(e.length<=1&&(e=e[0]),a){var h={};g(j(d),function(a){h[a]=d[a]}),h[c]=e,b(a,h),b=function(){}}else d[c]=e,f.setImmediate(l)},n=e.slice(0,Math.abs(e.length-1))||[],o=function(){return i(n,function(a,b){return a&&d.hasOwnProperty(b)},!0)&&!d.hasOwnProperty(c)};if(o())e[e.length-1](m,d);else{var p=function(){o()&&(k(p),e[e.length-1](m,d))};h(p)}})},f.waterfall=function(a,b){if(b=b||function(){},a.constructor!==Array){var c=new Error("First argument to waterfall must be an array of functions");return b(c)}if(!a.length)return b();var d=function(a){return function(c){if(c)b.apply(null,arguments),b=function(){};else{var e=Array.prototype.slice.call(arguments,1),g=a.next();e.push(g?d(g):b),f.setImmediate(function(){a.apply(null,e)})}}};d(f.iterator(a))()};var t=function(a,b,c){if(c=c||function(){},b.constructor===Array)a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(j(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};f.parallel=function(a,b){t({map:f.map,each:f.each},a,b)},f.parallelLimit=function(a,b,c){t({map:p(b),each:k(b)},a,c)},f.series=function(a,b){if(b=b||function(){},a.constructor===Array)f.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};f.eachSeries(j(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},f.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},f.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var u=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};f.concat=l(u),f.concatSeries=n(u),f.whilst=function(a,b,c){a()?b(function(d){return d?c(d):void f.whilst(a,b,c)}):c()},f.doWhilst=function(a,b,c){a(function(d){return d?c(d):void(b()?f.doWhilst(a,b,c):c())})},f.until=function(a,b,c){a()?c():b(function(d){return d?c(d):void f.until(a,b,c)})},f.doUntil=function(a,b,c){a(function(d){return d?c(d):void(b()?c():f.doUntil(a,b,c))})},f.queue=function(a,b){function d(a,c,d,e){c.constructor!==Array&&(c=[c]),g(c,function(c){var g={data:c,callback:"function"==typeof e?e:null};d?a.tasks.unshift(g):a.tasks.push(g),a.saturated&&a.tasks.length===b&&a.saturated(),f.setImmediate(a.process)})}void 0===b&&(b=1);var e=0,h={tasks:[],concurrency:b,saturated:null,empty:null,drain:null,push:function(a,b){d(h,a,!1,b)},unshift:function(a,b){d(h,a,!0,b)},process:function(){if(e<h.concurrency&&h.tasks.length){var b=h.tasks.shift();h.empty&&0===h.tasks.length&&h.empty(),e+=1;var d=function(){e-=1,b.callback&&b.callback.apply(b,arguments),h.drain&&h.tasks.length+e===0&&h.drain(),h.process()},f=c(d);a(b.data,f)}},length:function(){return h.tasks.length},running:function(){return e}};return h},f.cargo=function(a,b){var c=!1,d=[],e={tasks:d,payload:b,saturated:null,empty:null,drain:null,push:function(a,c){a.constructor!==Array&&(a=[a]),g(a,function(a){d.push({data:a,callback:"function"==typeof c?c:null}),e.saturated&&d.length===b&&e.saturated()}),f.setImmediate(e.process)},process:function i(){if(!c){if(0===d.length)return void(e.drain&&e.drain());var f="number"==typeof b?d.splice(0,b):d.splice(0),j=h(f,function(a){return a.data});e.empty&&e.empty(),c=!0,a(j,function(){c=!1;var a=arguments;g(f,function(b){b.callback&&b.callback.apply(null,a)}),i()})}},length:function(){return d.length},running:function(){return c}};return e};var v=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(b?console.error&&console.error(b):console[a]&&g(c,function(b){console[a](b)}))}]))}};f.log=v("log"),f.dir=v("dir"),f.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),f=e.pop(),g=b.apply(null,e);g in c?f.apply(null,c[g]):g in d?d[g].push(f):(d[g]=[f],a.apply(null,e.concat([function(){c[g]=arguments;var a=d[g];delete d[g];for(var b=0,e=a.length;e>b;b++)a[b].apply(null,arguments)}])))};return e.memo=c,e.unmemoized=a,e},f.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},f.times=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.map(d,b,c)},f.timesSeries=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.mapSeries(d,b,c)},f.compose=function(){var a=Array.prototype.reverse.call(arguments);return function(){var b=this,c=Array.prototype.slice.call(arguments),d=c.pop();f.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){d.apply(b,[a].concat(c))})}};var w=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);
return c.apply(this,d)}return c};f.applyEach=l(w),f.applyEachSeries=n(w),f.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},"undefined"!=typeof define&&define.amd?define([],function(){return f}):"undefined"!=typeof b&&b.exports?b.exports=f:d.async=f}()}).call(this,a("FWaASH"))},{FWaASH:33}],76:[function(a,b){(function(){var c,d,e,f,g,h,i;i=a("lodash"),g=a("./diff_match_patch"),e=a("./op"),d=a("./insert"),f=a("./retain"),h=new g,c=function(){function a(a,b,c){var d;if(this.startLength=a,this.endLength=b,this.ops=c,null==this.ops&&(this.ops=this.endLength,this.endLength=null),this.ops=i.map(this.ops,function(a){if(e.isRetain(a))return a;if(e.isInsert(a))return a;throw new Error("Creating delta with invalid op. Expecting an insert or retain.")}),this.compact(),d=i.reduce(this.ops,function(a,b){return a+b.getLength()},0),null!=this.endLength&&d!==this.endLength)throw new Error("Expecting end length of "+d);this.endLength=d}var b,c;return a.getIdentity=function(b){return new a(b,b,[new f(0,b)])},a.getInitial=function(b){return new a(0,b.length,[new d(b)])},a.isDelta=function(a){var b,c,d,f;if(null!=a&&"object"==typeof a&&"number"==typeof a.startLength&&"number"==typeof a.endLength&&"object"==typeof a.ops){for(f=a.ops,c=0,d=f.length;d>c;c++)if(b=f[c],!e.isRetain(b)&&!e.isInsert(b))return!1;return!0}return!1},a.makeDelta=function(b){return new a(b.startLength,b.endLength,i.map(b.ops,function(a){return e.isInsert(a)?new d(a.value,a.attributes):e.isRetain(a)?new f(a.start,a.end,a.attributes):null}))},a.makeDeleteDelta=function(b,c,d){var e;return e=[],c>0&&e.push(new f(0,c)),b>c+d&&e.push(new f(c+d,b)),new a(b,e)},a.makeInsertDelta=function(b,c,e,g){var h;return h=[new d(e,g)],c>0&&h.unshift(new f(0,c)),b>c&&h.push(new f(c,b)),new a(b,h)},a.makeRetainDelta=function(b,c,d,e){var g;return g=[new f(c,c+d,e)],c>0&&g.unshift(new f(0,c)),b>c+d&&g.push(new f(c+d,b)),new a(b,g)},a.prototype.apply=function(a,b,c,d){var g,h,j;return null==a&&(a=function(){}),null==b&&(b=function(){}),null==c&&(c=function(){}),null==d&&(d=null),this.isIdentity()?void 0:(g=0,h=0,j=[],i.each(this.ops,function(){return function(c){return e.isInsert(c)?(a.call(d,g+h,c.value,c.attributes),h+=c.getLength()):e.isRetain(c)?(c.start>g&&(b.call(d,g+h,c.start-g),h-=c.start-g),j.push(new f(c.start+h,c.end+h,c.attributes)),g=c.end):void 0}}(this)),this.endLength<this.startLength+h&&b.call(d,this.endLength,this.startLength+h-this.endLength),i.each(j,function(){return function(a){return i.each(a.attributes,function(b,e){return null===b?c.call(d,a.start,a.end-a.start,e,b):void 0}),i.each(a.attributes,function(b,e){return null!=b?c.call(d,a.start,a.end-a.start,e,b):void 0})}}(this)))},a.prototype.applyToText=function(a){var b,c,d,f,g,h,i;if(c=this,a.length!==c.startLength)throw new Error("Start length of delta: "+c.startLength+" is not equal to the text: "+a.length);for(b=[],i=c.ops,g=0,h=i.length;h>g;g++)d=i[g],b.push(e.isInsert(d)?d.value:a.substring(d.start,d.end));if(f=b.join(""),c.endLength!==f.length)throw new Error("End length of delta: "+c.endLength+" is not equal to result text: "+f.length);return f},a.prototype.canCompose=function(b){return a.isDelta(b)&&this.endLength===b.startLength},a.prototype.compact=function(){var a;return a=[],i.each(this.ops,function(b){var c;if(0!==b.getLength())return 0===a.length?a.push(b):(c=i.last(a),e.isInsert(c)&&e.isInsert(b)&&c.attributesMatch(b)?a[a.length-1]=new d(c.value+b.value,b.attributes):e.isRetain(c)&&e.isRetain(b)&&c.end===b.start&&c.attributesMatch(b)?a[a.length-1]=new f(c.start,b.end,b.attributes):a.push(b))}),this.ops=a},a.prototype.compose=function(b){var c,g,h,j,k,l,m;if(!this.canCompose(b))throw new Error("Cannot compose delta");for(g=this,c=[],m=b.ops,k=0,l=m.length;l>k;k++)if(h=m[k],e.isInsert(h))c.push(h);else{if(!e.isRetain(h))throw new Error("Invalid op in deltaB when composing");j=g.getOpsAt(h.start,h.getLength()),j=i.map(j,function(a){return e.isInsert(a)?new d(a.value,a.composeAttributes(h.attributes)):new f(a.start,a.end,a.composeAttributes(h.attributes))}),c=c.concat(j)}return new a(g.startLength,b.endLength,c)},a.prototype.decompose=function(b){var c,g,h,j,k,l;if(h=this,!a.isDelta(b))throw new Error("Decompose called when deltaA is not a Delta, type: "+typeof b);if(b.startLength!==this.startLength)throw new Error("startLength "+b.startLength+" / startLength "+this.startLength+" mismatch");if(!i.all(b.ops,function(a){return e.isInsert(a)}))throw new Error("DeltaA has retain in decompose");if(!i.all(h.ops,function(a){return e.isInsert(a)}))throw new Error("DeltaC has retain in decompose");return c=function(a,b){var d,e,f;d={};for(e in b)f=b[e],(void 0===a[e]||a[e]!==f)&&(d[e]=null!==a[e]&&"object"==typeof a[e]&&null!==f&&"object"==typeof f?c(a[e],f):f);for(e in a)f=a[e],void 0===b[e]&&(d[e]=null);return d},j=b.diff(h),l=[],k=0,i.each(j.ops,function(a){var g,j;return j=h.getOpsAt(k,a.getLength()),g=0,i.each(j,function(h){var j,k,m;if(e.isInsert(a))j=new d(a.value.substring(g,g+h.getLength()),h.attributes),l.push(j);else{if(!e.isRetain(a))throw new Error("Invalid delta in deltaB when composing");m=b.getOpsAt(a.start+g,h.getLength()),k=0,i.each(m,function(b){var d,e,i;return d=c(b.attributes,h.attributes),i=a.start+k+g,e=new f(i,i+b.getLength(),d),l.push(e),k+=b.getLength()})}return g+=h.getLength()}),k+=a.getLength()}),g=new a(j.startLength,j.endLength,l)},a.prototype.diff=function(b){var c,e,j,k,l,m,n,o,p,q,r,s,t;if(s=i.map([this,b],function(a){return i.map(a.ops,function(a){return null!=a.value?a.value:""}).join("")}),n=s[0],o=s[1],""!==n||""!==o){if(c=h.diff_main(n,o),c.length<=0)throw new Error("diffToDelta called with diff with length <= 0");for(m=0,e=0,l=[],q=0,r=c.length;r>q;q++)switch(t=c[q],k=t[0],p=t[1],k){case g.DIFF_DELETE:m+=p.length;break;case g.DIFF_INSERT:l.push(new d(p)),e+=p.length;break;case g.DIFF_EQUAL:l.push(new f(m,m+p.length)),m+=p.length,e+=p.length}j=new a(m,e,l)}else j=new a(0,0,[]);return j},b=function(a,b,c,d){var e,g;if(g=i.extend({},c),e=Math.min(a.getLength(),b.getLength()),d)if(g.transformOp=new f(g.indexA,g.indexA+e),g.indexA+=e,e===a.getLength())g.elemIndexA++;else{if(!(e<a.getLength()))throw new Error("Invalid elem length in transform");g.elemA=i.last(a.split(e))}else g.transformOp=i.first(b.split(e)),g.indexB+=e,e===b.getLength()?g.elemIndexB++:g.elemB=i.last(b.split(e));return g},c=function(a,b,c){var d,e,g,h,j,k,l,m;if(j=c.indexA,k=c.indexB,e=c.elemIndexA,g=c.elemIndexB,m=i.extend({},c),a.end<b.start)m.indexA+=a.getLength(),m.elemIndexA++;else if(b.end<a.start)m.indexB+=b.getLength(),m.elemIndexB++;else{if(a.start<b.start?(m.indexA+=b.start-a.start,a=m.elemA=new f(b.start,a.end,a.attributes)):b.start<a.start&&(m.indexB+=a.start-b.start,b=m.elemB=new f(a.start,b.end,b.attributes)),h="RetainOps must have same start length in transform",a.start!==b.start)throw new Error(h);l=Math.min(a.end,b.end)-a.start,d=a.addAttributes(b.attributes),m.transformOp=new f(m.indexA,m.indexA+l,d),m.indexA+=l,m.indexB+=l,a.end===b.end?(m.elemIndexA++,m.elemIndexB++):a.end<b.end?(m.elemIndexA++,m.elemB=i.last(b.split(l))):(m.elemIndexB++,m.elemA=i.last(a.split(l)))}return m.elemIndexA!==c.elemIndexA&&(m.elemA=null),m.elemIndexB!==c.elemIndexB&&(m.elemB=null),m},a.prototype.transform=function(d,g){var h,j,k,l,m,n,o,p,q,r,s,t,u,v;if(null==g&&(g=!1),!a.isDelta(d))throw n="Transform called when deltaA is not a Delta, type: ",new Error(n+typeof d);for(d=new a(d.startLength,d.endLength,d.ops),h=new a(this.startLength,this.endLength,this.ops),s=[],o=p=0,l=m=0,u=function(a){return null!=a.indexA&&(o=a.indexA),null!=a.indexB&&(p=a.indexB),null!=a.elemIndexA&&(l=a.elemIndexA),null!=a.elemIndexB&&(m=a.elemIndexB),null!=a.elemA&&(d.ops[l]=a.elemA),null!=a.elemB&&(h.ops[m]=a.elemB),null!=a.transformOp?s.push(a.transformOp):void 0},v=function(){return{indexA:o,indexB:p,elemIndexA:l,elemIndexB:m}};l<d.ops.length&&m<h.ops.length;)j=d.ops[l],k=h.ops[m],e.isInsert(j)&&e.isInsert(k)?(q=b(j,k,v(),g),u(q)):e.isRetain(j)&&e.isRetain(k)?(q=c(j,k,v()),u(q)):e.isInsert(j)&&e.isRetain(k)?(s.push(new f(o,o+j.getLength())),o+=j.getLength(),l++):e.isRetain(j)&&e.isInsert(k)&&(s.push(k),p+=k.getLength(),m++);for(;l<d.ops.length;)j=d.ops[l],e.isInsert(j)&&s.push(new f(o,o+j.getLength())),o+=j.getLength(),l++;for(;m<h.ops.length;)k=h.ops[m],e.isInsert(k)&&s.push(k),p+=k.getLength(),m++;return t=d.endLength,r=i.reduce(s,function(a,b){return a+b.getLength()},0),new a(t,r,s)},a.prototype.getOpsAt=function(a,b){var c,d,e,f,g,h,i,j,k;for(c=[],e=null!=this.savedOpOffset&&this.savedOpOffset<a?this.savedOpOffset:this.savedOpOffset=this.savedOpIndex=0,k=this.ops.slice(this.savedOpIndex),i=0,j=k.length;j>i&&(f=k[i],!(e>=a+b));i++)g=f.getLength(),e+g>a&&(h=Math.max(a-e,0),d=Math.min(g-h,a+b-e-h),c.push(f.getAt(h,d))),e+=g,this.savedOpIndex+=1,this.savedOpOffset+=g;return c},a.prototype.invert=function(a){var b,c,d;if(!this.isInsertsOnly())throw new Error("Invert called on invalid delta containing non-insert ops");return b=this,c=b.compose(a),d=b.decompose(c)},a.prototype.isEqual=function(a){return a?this.startLength!==a.startLength||this.endLength!==a.endLength?!1:i.isArray(a.ops)&&this.ops.length===a.ops.length?i.all(this.ops,function(b,c){return b.isEqual(a.ops[c])}):!1:!1},a.prototype.isIdentity=function(){var a,b,c,d,f;if(this.startLength===this.endLength){if(0===this.ops.length)return!0;for(a=0,f=this.ops,c=0,d=f.length;d>c;c++){if(b=f[c],!e.isRetain(b))return!1;if(b.start!==a)return!1;if(!(0===b.numAttributes()||1===b.numAttributes()&&i.has(b.attributes,"authorId")))return!1;a=b.end}return a!==this.endLength?!1:!0}return!1},a.prototype.isInsertsOnly=function(){return i.every(this.ops,function(a){return e.isInsert(a)})},a.prototype.merge=function(b){var c;return c=i.map(b.ops,function(a){return function(b){return e.isRetain(b)?new f(b.start+a.startLength,b.end+a.startLength,b.attributes):b}}(this)),c=this.ops.concat(c),new a(this.startLength+b.startLength,c)},a.prototype.split=function(b){var c,d;if(!this.isInsertsOnly())throw new Error("Split only implemented for inserts only");if(!(b>=0&&b<=this.endLength))throw new Error("Split at invalid index");return c=[],d=[],i.reduce(this.ops,function(a,e){var f,g,h;return a+e.getLength()<=b?c.push(e):a>=b?d.push(e):(h=e.split(b-a),f=h[0],g=h[1],c.push(f),d.push(g)),a+e.getLength()},0),[new a(0,c),new a(0,d)]},a.prototype.toString=function(){return"{("+this.startLength+"->"+this.endLength+") ["+this.ops.join(", ")+"]}"},a}(),b.exports=c}).call(this)},{"./diff_match_patch":78,"./insert":79,"./op":80,"./retain":81,lodash:69}],77:[function(a,b){(function(){var c,d,e,f,g,h,i,j;i=a("lodash"),c=a("./delta"),e=a("./insert"),f=a("./retain"),j={alphabet:"abcdefghijklmnopqrstuvwxyz\n\n\n\n  ",booleanAttributes:{bold:[!0,!1],italic:[!0,!1],strike:[!0,!1]},nonBooleanAttributes:{"back-color":["white","black","red","blue","lime","teal","magenta","yellow"],"fore-color":["white","black","red","blue","lime","teal","magenta","yellow"],"font-name":["monospace","serif"],"font-size":["huge","large","small"]},defaultAttributeValue:{"back-color":"white","fore-color":"black","font-name":"san-serif","font-size":"normal"}},h=function(a){return null!=a?j=a:void 0},g=function(a){if(a=a||j,null==a)throw new Error("Must provide DeltaGenerator with a domain.");if(null==a.alphabet)throw new Error("Domain must define alphabet.");if(null==a.booleanAttributes)throw new Error("Domain must define booleanAttributes.");if(null==a.nonBooleanAttributes)throw new Error("Domain must define nonBooleanAttributes.");if(null==a.defaultAttributeValue)throw new Error("Domain must define defaultAttributeValue.");return{getDomain:function(){return j},getRandomString:function(b){var c;return i.map(function(){c=[];for(var a=0,d=b-1;d>=0?d>=a:a>=d;d>=0?a++:a--)c.push(a);return c}.apply(this),function(){return a.alphabet[i.random(0,a.alphabet.length-1)]}).join("")},getRandomLength:function(){var a;return a=Math.random(),.6>a?i.random(1,2):.8>a?i.random(3,4):.9>a?i.random(5,9):i.random(10,50)},insertAt:function(a,b,c){var d,f,g,h,i,j,k,l,m;for(d=h=0,l=a.ops,j=0,k=l.length;k>j&&(g=l[j],d!==b);j++){if(b<d+g.getLength()){m=g.split(b-d),f=m[0],i=m[1],a.ops.splice(h,1,f,i),h++;break}d+=g.getLength(),h++}return a.ops.splice(h,0,new e(c)),a.endLength+=c.length,a.compact()},deleteAt:function(a,b,c){var d,g,h,j,k,l,m,n,o,p,q;for(d=0,l=[],q=a.ops,o=0,p=q.length;p>o;o++){if(k=q[o],m=d===b||b<d+k.getLength(),c>0&&m){if(g=Math.min(c,k.getLength()-(b-d)),c-=g,e.isInsert(k))j=k.value.substring(0,b-d)+k.value.substring(b-d+g),j.length>0&&l.push(new e(j));else{if(!f.isRetain(k))throw new Error("Expected retain but got "+k);h=new f(k.start,k.start+b-d,i.clone(k.attributes)),n=new f(k.start+b-d+g,k.end,i.clone(k.attributes)),h.start<h.end&&l.push(h),n.start<n.end&&l.push(n)}b+=g}else l.push(k);d+=k.getLength()}return a.ops=l,a.endLength=i.reduce(l,function(a,b){return a+b.getLength()},0)},formatAt:function(b,c,d,g,h){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(B=function(a,b,c,d){var g,h,j,k,l,m,n,o,p,q,r,s;if(e.isInsert(a))k=a.value.substring(0,b),j=new e(k,i.clone(a.attributes)),h=a.value.substring(b,b+c),g=new e(h,i.clone(a.attributes)),q=a.value.substring(b+c),p=new e(q,i.clone(a.attributes)),-1!==h.indexOf("\n")&&(m=h.substring(0,h.indexOf("\n")),q=h.substring(h.indexOf("\n"))+q,g=new e(m,i.clone(a.attributes)),p=new e(q,i.clone(a.attributes)));else{if(!f.isRetain(a))throw new Error("Expected retain but got "+a);if(j=new f(a.start,a.start+b,i.clone(a.attributes)),g=new f(j.end,j.end+c,i.clone(a.attributes)),p=new f(g.end,a.end,i.clone(a.attributes)),o=d.getOpsAt(g.start,g.getLength()),!i.every(o,function(a){return e.isInsert(a)}))throw new Error("Non insert op in backref");for(l=g.start,r=0,s=o.length;s>r;r++){if(n=o[r],!e.isInsert(n))throw new Error("Got retainOp in reference delta!");if(-1!==n.value.indexOf("\n")){g=new f(g.start,l+n.value.indexOf("\n"),i.clone(g.attributes)),p=new f(l+n.value.indexOf("\n"),p.end,i.clone(p.attributes));break}l+=n.getLength()}}return[j,g,p]},y=function(a,b,c,d){var e,f,g,h,i,j;for(e=0,g=d[0].attributes[c],j=[],h=0,i=d.length;i>h;h++){if(f=d[h],f.attributes[c]!==g){a.end=a.start+e,b.start=a.end;break}j.push(e+=f.getLength())}return j},s=function(a,b,c,d){var g;if(e.isInsert(a))return null!=a.attributes[c]?delete a.attributes[c]:a.attributes[c]=!0;if(!f.isRetain(a))throw new Error("Expected retain but got "+a);if(null!=a.attributes[c])return delete a.attributes[c];if(g=d.getOpsAt(a.start,a.getLength()),!i.every(g,function(a){return e.isInsert(a)}))throw new Error("Formatting a retain that does not refer to an insert.");if(g.length>0){if(y(a,b,c,g),null!=g[0].attributes[c]){if(!g[0].attributes[c])throw new Error("Boolean attribute on reference delta should only be true!");return a.attributes[c]=null}return a.attributes[c]=!0}},t=function(){return function(b,c,d,g){var h,j;if(h=function(b){return i.first(null!=b?i.shuffle(i.without(a.nonBooleanAttributes[d],b)):i.shuffle(i.without(a.nonBooleanAttributes[d],a.defaultAttributeValue[d])))},e.isInsert(b))return b.attributes[d]=h(d,b.attributes[d]);if(!f.isRetain(b))throw new Error("Expected retain but got "+b);if(j=g.getOpsAt(b.start,b.getLength()),!i.every(j,function(a){return e.isInsert(a)}))throw new Error("Formatting a retain that does not refer to an insert.");return j.length>0?(y(b,c,d,j),null!=b.attributes[d]&&Math.random()<.5?delete b.attributes[d]:b.attributes[d]=h(b.attributes[d])):void 0}}(this),k=0,p=[],z=b.ops,u=0,w=z.length;w>u;u++){if(o=z[u],q=k===c||k+o.getLength()>c,d>0&&q){for(m=Math.min(d,o.getLength()-(c-k)),d-=m,A=B(o,c-k,m,h),n=A[0],l=A[1],r=A[2],p.push(n),p.push(l),p.push(r),v=0,x=g.length;x>v;v++)if(j=g[v],i.has(a.booleanAttributes,j))s(l,r,j,h);else{if(!i.has(a.nonBooleanAttributes,j))throw new Error("Received unknown attribute: "+j);t(l,r,j,h)}c+=m}else p.push(o);k+=o.getLength()}return b.endLength=i.reduce(p,function(a,b){return a+b.getLength()},0),b.ops=p,b.compact()},addRandomOp:function(b,c){var d,e,f,g,h,j,k;if(e=c.endLength-1,g=i.random(0,e),j=Math.random(),.5>j)h=this.getRandomLength(),this.insertAt(b,g,this.getRandomString(h));else if(.75>j){if(c.endLength<=1)return b;g=i.random(0,e-1),h=i.random(1,e-g),this.deleteAt(b,g,h)}else k=i.shuffle(i.keys(a.booleanAttributes).concat(i.keys(a.nonBooleanAttributes))),f=i.random(1,k.length),d=k.slice(0,f),h=i.random(1,e-g),this.formatAt(b,g,h,d,c);return b},getRandomDelta:function(a,b){var d,e,g;for(e=new c(a.endLength,a.endLength,[new f(0,a.endLength)]),b||(b=i.random(1,10)),d=g=0;b>=0?b>g:g>b;d=b>=0?++g:--g)this.addRandomOp(e,a);return e}}},d={setDomain:h,getUtils:g},b.exports=d}).call(this)},{"./delta":76,"./insert":79,"./retain":81,lodash:69}],78:[function(a,b){(function(){var c;c=a("googlediff"),c.DIFF_DELETE=-1,c.DIFF_INSERT=1,c.DIFF_EQUAL=0,b.exports=c}).call(this)},{googlediff:85}],79:[function(a,b){(function(){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=a("lodash"),d=a("./op"),c=function(a){function b(a,b){this.value=a,null==b&&(b={}),this.attributes=e.clone(b)}return g(b,a),b.prototype.getAt=function(a,c){return new b(this.value.substr(a,c),this.attributes)},b.prototype.getLength=function(){return this.value.length},b.prototype.isEqual=function(a){return null!=a&&this.value===a.value&&e.isEqual(this.attributes,a.attributes)},b.prototype.join=function(a){if(e.isEqual(this.attributes,a.attributes))return new b(this.value+second.value,this.attributes);throw Error},b.prototype.split=function(a){var c,d;return c=new b(this.value.substr(0,a),this.attributes),d=new b(this.value.substr(a),this.attributes),[c,d]},b.prototype.toString=function(){return"{"+this.value+", "+this.printAttributes()+"}"},b}(d),b.exports=c}).call(this)},{"./op":80,lodash:69}],80:[function(a,b){(function(){var c,d;d=a("lodash"),c=function(){function a(a){null==a&&(a={}),this.attributes=d.clone(a)}return a.isInsert=function(a){return null!=a&&"string"==typeof a.value},a.isRetain=function(a){return null!=a&&"number"==typeof a.start&&"number"==typeof a.end},a.prototype.addAttributes=function(a){var b,c,d;b={};for(c in a)d=a[c],void 0===this.attributes[c]&&(b[c]=d);return b},a.prototype.attributesMatch=function(a){var b;return b=a.attributes||{},d.isEqual(this.attributes,b)},a.prototype.composeAttributes=function(b){var c;return(c=function(b){return function(e,f){var g,h,i;if(!f)return e;h=d.clone(e);for(g in f)i=f[g],a.isInsert(b)&&null===i?delete h[g]:"undefined"!=typeof i&&(h[g]="object"==typeof h[g]&&"object"==typeof i&&d.all([h[g],f[g]],function(a){return null!==a})?c(h[g],i):i);return h}}(this))(this.attributes,b)},a.prototype.numAttributes=function(){return d.keys(this.attributes).length},a.prototype.printAttributes=function(){return JSON.stringify(this.attributes)},a}(),b.exports=c}).call(this)},{lodash:69}],81:[function(a,b){(function(){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=a("lodash"),c=a("./op"),d=function(a){function b(a,b,c){this.start=a,this.end=b,null==c&&(c={}),this.attributes=e.clone(c)}return g(b,a),b.prototype.getAt=function(a,c){return new b(this.start+a,this.start+a+c,this.attributes)},b.prototype.getLength=function(){return this.end-this.start},b.prototype.isEqual=function(a){return null!=a&&this.start===a.start&&this.end===a.end&&e.isEqual(this.attributes,a.attributes)},b.prototype.split=function(a){var c,d;return c=new b(this.start,this.start+a,this.attributes),d=new b(this.start+a,this.end,this.attributes),[c,d]},b.prototype.toString=function(){return"{{"+this.start+" - "+this.end+"), "+this.printAttributes()+"}"},b}(c),b.exports=d}).call(this)},{"./op":80,lodash:69}],82:[function(a,b){(function(){b.exports={Delta:a("./delta"),DeltaGen:a("./delta_generator"),Op:a("./op"),InsertOp:a("./insert"),RetainOp:a("./retain")}}).call(this)},{"./delta":76,"./delta_generator":77,"./insert":79,"./op":80,"./retain":81}],83:[function(a,b){b.exports=a("./build/delta.js")},{"./build/delta.js":76}],84:[function(a,b){b.exports=a("./build/tandem-core")},{"./build/tandem-core":82}],85:[function(a,b){b.exports=a("./javascript/diff_match_patch_uncompressed.js").diff_match_patch},{"./javascript/diff_match_patch_uncompressed.js":86}],86:[function(){function a(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var b=-1,c=1,d=0;a.Diff,a.prototype.diff_main=function(a,b,c,e){"undefined"==typeof e&&(e=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var f=e;if(null==a||null==b)throw new Error("Null input. (diff_main)");if(a==b)return a?[[d,a]]:[];"undefined"==typeof c&&(c=!0);var g=c,h=this.diff_commonPrefix(a,b),i=a.substring(0,h);a=a.substring(h),b=b.substring(h),h=this.diff_commonSuffix(a,b);var j=a.substring(a.length-h);a=a.substring(0,a.length-h),b=b.substring(0,b.length-h);var k=this.diff_compute_(a,b,g,f);return i&&k.unshift([d,i]),j&&k.push([d,j]),this.diff_cleanupMerge(k),k},a.prototype.diff_compute_=function(a,e,f,g){var h;if(!a)return[[c,e]];if(!e)return[[b,a]];var i=a.length>e.length?a:e,j=a.length>e.length?e:a,k=i.indexOf(j);if(-1!=k)return h=[[c,i.substring(0,k)],[d,j],[c,i.substring(k+j.length)]],a.length>e.length&&(h[0][0]=h[2][0]=b),h;if(1==j.length)return[[b,a],[c,e]];var l=this.diff_halfMatch_(a,e);if(l){var m=l[0],n=l[1],o=l[2],p=l[3],q=l[4],r=this.diff_main(m,o,f,g),s=this.diff_main(n,p,f,g);return r.concat([[d,q]],s)}return f&&a.length>100&&e.length>100?this.diff_lineMode_(a,e,g):this.diff_bisect_(a,e,g)},a.prototype.diff_lineMode_=function(a,e,f){var g=this.diff_linesToChars_(a,e);a=g.chars1,e=g.chars2;var h=g.lineArray,i=this.diff_main(a,e,!1,f);this.diff_charsToLines_(i,h),this.diff_cleanupSemantic(i),i.push([d,""]);for(var j=0,k=0,l=0,m="",n="";j<i.length;){switch(i[j][0]){case c:l++,n+=i[j][1];break;case b:k++,m+=i[j][1];break;case d:if(k>=1&&l>=1){i.splice(j-k-l,k+l),j=j-k-l;for(var g=this.diff_main(m,n,!1,f),o=g.length-1;o>=0;o--)i.splice(j,0,g[o]);j+=g.length}l=0,k=0,m="",n=""}j++}return i.pop(),i},a.prototype.diff_bisect_=function(a,d,e){for(var f=a.length,g=d.length,h=Math.ceil((f+g)/2),i=h,j=2*h,k=new Array(j),l=new Array(j),m=0;j>m;m++)k[m]=-1,l[m]=-1;k[i+1]=0,l[i+1]=0;for(var n=f-g,o=n%2!=0,p=0,q=0,r=0,s=0,t=0;h>t&&!((new Date).getTime()>e);t++){for(var u=-t+p;t-q>=u;u+=2){var v,w=i+u;v=u==-t||u!=t&&k[w-1]<k[w+1]?k[w+1]:k[w-1]+1;for(var x=v-u;f>v&&g>x&&a.charAt(v)==d.charAt(x);)v++,x++;if(k[w]=v,v>f)q+=2;else if(x>g)p+=2;else if(o){var y=i+n-u;if(y>=0&&j>y&&-1!=l[y]){var z=f-l[y];if(v>=z)return this.diff_bisectSplit_(a,d,v,x,e)}}}for(var A=-t+r;t-s>=A;A+=2){var z,y=i+A;z=A==-t||A!=t&&l[y-1]<l[y+1]?l[y+1]:l[y-1]+1;for(var B=z-A;f>z&&g>B&&a.charAt(f-z-1)==d.charAt(g-B-1);)z++,B++;if(l[y]=z,z>f)s+=2;else if(B>g)r+=2;else if(!o){var w=i+n-A;if(w>=0&&j>w&&-1!=k[w]){var v=k[w],x=i+v-w;if(z=f-z,v>=z)return this.diff_bisectSplit_(a,d,v,x,e)}}}}return[[b,a],[c,d]]},a.prototype.diff_bisectSplit_=function(a,b,c,d,e){var f=a.substring(0,c),g=b.substring(0,d),h=a.substring(c),i=b.substring(d),j=this.diff_main(f,g,!1,e),k=this.diff_main(h,i,!1,e);return j.concat(k)},a.prototype.diff_linesToChars_=function(a,b){function c(a){for(var b="",c=0,f=-1,g=d.length;f<a.length-1;){f=a.indexOf("\n",c),-1==f&&(f=a.length-1);var h=a.substring(c,f+1);c=f+1,(e.hasOwnProperty?e.hasOwnProperty(h):void 0!==e[h])?b+=String.fromCharCode(e[h]):(b+=String.fromCharCode(g),e[h]=g,d[g++]=h)}return b}var d=[],e={};d[0]="";var f=c(a),g=c(b);return{chars1:f,chars2:g,lineArray:d}},a.prototype.diff_charsToLines_=function(a,b){for(var c=0;c<a.length;c++){for(var d=a[c][1],e=[],f=0;f<d.length;f++)e[f]=b[d.charCodeAt(f)];a[c][1]=e.join("")}},a.prototype.diff_commonPrefix=function(a,b){if(!a||!b||a.charAt(0)!=b.charAt(0))return 0;for(var c=0,d=Math.min(a.length,b.length),e=d,f=0;e>c;)a.substring(f,e)==b.substring(f,e)?(c=e,f=c):d=e,e=Math.floor((d-c)/2+c);return e},a.prototype.diff_commonSuffix=function(a,b){if(!a||!b||a.charAt(a.length-1)!=b.charAt(b.length-1))return 0;for(var c=0,d=Math.min(a.length,b.length),e=d,f=0;e>c;)a.substring(a.length-e,a.length-f)==b.substring(b.length-e,b.length-f)?(c=e,f=c):d=e,e=Math.floor((d-c)/2+c);return e},a.prototype.diff_commonOverlap_=function(a,b){var c=a.length,d=b.length;if(0==c||0==d)return 0;c>d?a=a.substring(c-d):d>c&&(b=b.substring(0,c));var e=Math.min(c,d);if(a==b)return e;for(var f=0,g=1;;){var h=a.substring(e-g),i=b.indexOf(h);if(-1==i)return f;g+=i,(0==i||a.substring(e-g)==b.substring(0,g))&&(f=g,g++)}},a.prototype.diff_halfMatch_=function(a,b){function c(a,b,c){for(var d,e,f,h,i=a.substring(c,c+Math.floor(a.length/4)),j=-1,k="";-1!=(j=b.indexOf(i,j+1));){var l=g.diff_commonPrefix(a.substring(c),b.substring(j)),m=g.diff_commonSuffix(a.substring(0,c),b.substring(0,j));k.length<m+l&&(k=b.substring(j-m,j)+b.substring(j,j+l),d=a.substring(0,c-m),e=a.substring(c+l),f=b.substring(0,j-m),h=b.substring(j+l))}return 2*k.length>=a.length?[d,e,f,h,k]:null}if(this.Diff_Timeout<=0)return null;var d=a.length>b.length?a:b,e=a.length>b.length?b:a;if(d.length<4||2*e.length<d.length)return null;var f,g=this,h=c(d,e,Math.ceil(d.length/4)),i=c(d,e,Math.ceil(d.length/2));if(!h&&!i)return null;f=i?h&&h[4].length>i[4].length?h:i:h;var j,k,l,m;a.length>b.length?(j=f[0],k=f[1],l=f[2],m=f[3]):(l=f[0],m=f[1],j=f[2],k=f[3]);var n=f[4];return[j,k,l,m,n]},a.prototype.diff_cleanupSemantic=function(a){for(var e=!1,f=[],g=0,h=null,i=0,j=0,k=0,l=0,m=0;i<a.length;)a[i][0]==d?(f[g++]=i,j=l,k=m,l=0,m=0,h=a[i][1]):(a[i][0]==c?l+=a[i][1].length:m+=a[i][1].length,h&&h.length<=Math.max(j,k)&&h.length<=Math.max(l,m)&&(a.splice(f[g-1],0,[b,h]),a[f[g-1]+1][0]=c,g--,g--,i=g>0?f[g-1]:-1,j=0,k=0,l=0,m=0,h=null,e=!0)),i++;for(e&&this.diff_cleanupMerge(a),this.diff_cleanupSemanticLossless(a),i=1;i<a.length;){if(a[i-1][0]==b&&a[i][0]==c){var n=a[i-1][1],o=a[i][1],p=this.diff_commonOverlap_(n,o),q=this.diff_commonOverlap_(o,n);p>=q?(p>=n.length/2||p>=o.length/2)&&(a.splice(i,0,[d,o.substring(0,p)]),a[i-1][1]=n.substring(0,n.length-p),a[i+1][1]=o.substring(p),i++):(q>=n.length/2||q>=o.length/2)&&(a.splice(i,0,[d,n.substring(0,q)]),a[i-1][0]=c,a[i-1][1]=o.substring(0,o.length-q),a[i+1][0]=b,a[i+1][1]=n.substring(q),i++),i++}i++}},a.prototype.diff_cleanupSemanticLossless=function(b){function c(b,c){if(!b||!c)return 6;var d=b.charAt(b.length-1),e=c.charAt(0),f=d.match(a.nonAlphaNumericRegex_),g=e.match(a.nonAlphaNumericRegex_),h=f&&d.match(a.whitespaceRegex_),i=g&&e.match(a.whitespaceRegex_),j=h&&d.match(a.linebreakRegex_),k=i&&e.match(a.linebreakRegex_),l=j&&b.match(a.blanklineEndRegex_),m=k&&c.match(a.blanklineStartRegex_);return l||m?5:j||k?4:f&&!h&&i?3:h||i?2:f||g?1:0}for(var e=1;e<b.length-1;){if(b[e-1][0]==d&&b[e+1][0]==d){var f=b[e-1][1],g=b[e][1],h=b[e+1][1],i=this.diff_commonSuffix(f,g);if(i){var j=g.substring(g.length-i);f=f.substring(0,f.length-i),g=j+g.substring(0,g.length-i),h=j+h}for(var k=f,l=g,m=h,n=c(f,g)+c(g,h);g.charAt(0)===h.charAt(0);){f+=g.charAt(0),g=g.substring(1)+h.charAt(0),h=h.substring(1);var o=c(f,g)+c(g,h);o>=n&&(n=o,k=f,l=g,m=h)}b[e-1][1]!=k&&(k?b[e-1][1]=k:(b.splice(e-1,1),e--),b[e][1]=l,m?b[e+1][1]=m:(b.splice(e+1,1),e--))}e++}},a.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,a.whitespaceRegex_=/\s/,a.linebreakRegex_=/[\r\n]/,a.blanklineEndRegex_=/\n\r?\n$/,a.blanklineStartRegex_=/^\r?\n\r?\n/,a.prototype.diff_cleanupEfficiency=function(a){for(var e=!1,f=[],g=0,h=null,i=0,j=!1,k=!1,l=!1,m=!1;i<a.length;)a[i][0]==d?(a[i][1].length<this.Diff_EditCost&&(l||m)?(f[g++]=i,j=l,k=m,h=a[i][1]):(g=0,h=null),l=m=!1):(a[i][0]==b?m=!0:l=!0,h&&(j&&k&&l&&m||h.length<this.Diff_EditCost/2&&j+k+l+m==3)&&(a.splice(f[g-1],0,[b,h]),a[f[g-1]+1][0]=c,g--,h=null,j&&k?(l=m=!0,g=0):(g--,i=g>0?f[g-1]:-1,l=m=!1),e=!0)),i++;e&&this.diff_cleanupMerge(a)},a.prototype.diff_cleanupMerge=function(a){a.push([d,""]);for(var e,f=0,g=0,h=0,i="",j="";f<a.length;)switch(a[f][0]){case c:h++,j+=a[f][1],f++;break;case b:g++,i+=a[f][1],f++;break;case d:g+h>1?(0!==g&&0!==h&&(e=this.diff_commonPrefix(j,i),0!==e&&(f-g-h>0&&a[f-g-h-1][0]==d?a[f-g-h-1][1]+=j.substring(0,e):(a.splice(0,0,[d,j.substring(0,e)]),f++),j=j.substring(e),i=i.substring(e)),e=this.diff_commonSuffix(j,i),0!==e&&(a[f][1]=j.substring(j.length-e)+a[f][1],j=j.substring(0,j.length-e),i=i.substring(0,i.length-e))),0===g?a.splice(f-h,g+h,[c,j]):0===h?a.splice(f-g,g+h,[b,i]):a.splice(f-g-h,g+h,[b,i],[c,j]),f=f-g-h+(g?1:0)+(h?1:0)+1):0!==f&&a[f-1][0]==d?(a[f-1][1]+=a[f][1],a.splice(f,1)):f++,h=0,g=0,i="",j=""}""===a[a.length-1][1]&&a.pop();var k=!1;for(f=1;f<a.length-1;)a[f-1][0]==d&&a[f+1][0]==d&&(a[f][1].substring(a[f][1].length-a[f-1][1].length)==a[f-1][1]?(a[f][1]=a[f-1][1]+a[f][1].substring(0,a[f][1].length-a[f-1][1].length),a[f+1][1]=a[f-1][1]+a[f+1][1],a.splice(f-1,1),k=!0):a[f][1].substring(0,a[f+1][1].length)==a[f+1][1]&&(a[f-1][1]+=a[f+1][1],a[f][1]=a[f][1].substring(a[f+1][1].length)+a[f+1][1],a.splice(f+1,1),k=!0)),f++;k&&this.diff_cleanupMerge(a)},a.prototype.diff_xIndex=function(a,d){var e,f=0,g=0,h=0,i=0;for(e=0;e<a.length&&(a[e][0]!==c&&(f+=a[e][1].length),a[e][0]!==b&&(g+=a[e][1].length),!(f>d));e++)h=f,i=g;return a.length!=e&&a[e][0]===b?i:i+(d-h)},a.prototype.diff_prettyHtml=function(a){for(var e=[],f=/&/g,g=/</g,h=/>/g,i=/\n/g,j=0;j<a.length;j++){var k=a[j][0],l=a[j][1],m=l.replace(f,"&amp;").replace(g,"&lt;").replace(h,"&gt;").replace(i,"&para;<br>");switch(k){case c:e[j]='<ins style="background:#e6ffe6;">'+m+"</ins>";break;case b:e[j]='<del style="background:#ffe6e6;">'+m+"</del>";break;case d:e[j]="<span>"+m+"</span>"}}return e.join("")},a.prototype.diff_text1=function(a){for(var b=[],d=0;d<a.length;d++)a[d][0]!==c&&(b[d]=a[d][1]);return b.join("")},a.prototype.diff_text2=function(a){for(var c=[],d=0;d<a.length;d++)a[d][0]!==b&&(c[d]=a[d][1]);return c.join("")},a.prototype.diff_levenshtein=function(a){for(var e=0,f=0,g=0,h=0;h<a.length;h++){var i=a[h][0],j=a[h][1];switch(i){case c:f+=j.length;break;case b:g+=j.length;break;case d:e+=Math.max(f,g),f=0,g=0}}return e+=Math.max(f,g)},a.prototype.diff_toDelta=function(a){for(var e=[],f=0;f<a.length;f++)switch(a[f][0]){case c:e[f]="+"+encodeURI(a[f][1]);break;case b:e[f]="-"+a[f][1].length;break;case d:e[f]="="+a[f][1].length}return e.join("	").replace(/%20/g," ")},a.prototype.diff_fromDelta=function(a,e){for(var f=[],g=0,h=0,i=e.split(/\t/g),j=0;j<i.length;j++){var k=i[j].substring(1);switch(i[j].charAt(0)){case"+":try{f[g++]=[c,decodeURI(k)]}catch(l){throw new Error("Illegal escape in diff_fromDelta: "+k)}break;case"-":case"=":var m=parseInt(k,10);if(isNaN(m)||0>m)throw new Error("Invalid number in diff_fromDelta: "+k);var n=a.substring(h,h+=m);f[g++]="="==i[j].charAt(0)?[d,n]:[b,n];break;default:if(i[j])throw new Error("Invalid diff operation in diff_fromDelta: "+i[j])}}if(h!=a.length)throw new Error("Delta length ("+h+") does not equal source text length ("+a.length+").");return f},a.prototype.match_main=function(a,b,c){if(null==a||null==b||null==c)throw new Error("Null input. (match_main)");return c=Math.max(0,Math.min(c,a.length)),a==b?0:a.length?a.substring(c,c+b.length)==b?c:this.match_bitap_(a,b,c):-1},a.prototype.match_bitap_=function(a,b,c){function d(a,d){var e=a/b.length,g=Math.abs(c-d);return f.Match_Distance?e+g/f.Match_Distance:g?1:e}if(b.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var e=this.match_alphabet_(b),f=this,g=this.Match_Threshold,h=a.indexOf(b,c);-1!=h&&(g=Math.min(d(0,h),g),h=a.lastIndexOf(b,c+b.length),-1!=h&&(g=Math.min(d(0,h),g)));var i=1<<b.length-1;h=-1;for(var j,k,l,m=b.length+a.length,n=0;n<b.length;n++){for(j=0,k=m;k>j;)d(n,c+k)<=g?j=k:m=k,k=Math.floor((m-j)/2+j);m=k;var o=Math.max(1,c-k+1),p=Math.min(c+k,a.length)+b.length,q=Array(p+2);q[p+1]=(1<<n)-1;for(var r=p;r>=o;r--){var s=e[a.charAt(r-1)];
if(q[r]=0===n?(q[r+1]<<1|1)&s:(q[r+1]<<1|1)&s|((l[r+1]|l[r])<<1|1)|l[r+1],q[r]&i){var t=d(n,r-1);if(g>=t){if(g=t,h=r-1,!(h>c))break;o=Math.max(1,2*c-h)}}}if(d(n+1,c)>g)break;l=q}return h},a.prototype.match_alphabet_=function(a){for(var b={},c=0;c<a.length;c++)b[a.charAt(c)]=0;for(var c=0;c<a.length;c++)b[a.charAt(c)]|=1<<a.length-c-1;return b},a.prototype.patch_addContext_=function(a,b){if(0!=b.length){for(var c=b.substring(a.start2,a.start2+a.length1),e=0;b.indexOf(c)!=b.lastIndexOf(c)&&c.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)e+=this.Patch_Margin,c=b.substring(a.start2-e,a.start2+a.length1+e);e+=this.Patch_Margin;var f=b.substring(a.start2-e,a.start2);f&&a.diffs.unshift([d,f]);var g=b.substring(a.start2+a.length1,a.start2+a.length1+e);g&&a.diffs.push([d,g]),a.start1-=f.length,a.start2-=f.length,a.length1+=f.length+g.length,a.length2+=f.length+g.length}},a.prototype.patch_make=function(e,f,g){var h,i;if("string"==typeof e&&"string"==typeof f&&"undefined"==typeof g)h=e,i=this.diff_main(h,f,!0),i.length>2&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(e&&"object"==typeof e&&"undefined"==typeof f&&"undefined"==typeof g)i=e,h=this.diff_text1(i);else if("string"==typeof e&&f&&"object"==typeof f&&"undefined"==typeof g)h=e,i=f;else{if("string"!=typeof e||"string"!=typeof f||!g||"object"!=typeof g)throw new Error("Unknown call format to patch_make.");h=e,i=g}if(0===i.length)return[];for(var j=[],k=new a.patch_obj,l=0,m=0,n=0,o=h,p=h,q=0;q<i.length;q++){var r=i[q][0],s=i[q][1];switch(l||r===d||(k.start1=m,k.start2=n),r){case c:k.diffs[l++]=i[q],k.length2+=s.length,p=p.substring(0,n)+s+p.substring(n);break;case b:k.length1+=s.length,k.diffs[l++]=i[q],p=p.substring(0,n)+p.substring(n+s.length);break;case d:s.length<=2*this.Patch_Margin&&l&&i.length!=q+1?(k.diffs[l++]=i[q],k.length1+=s.length,k.length2+=s.length):s.length>=2*this.Patch_Margin&&l&&(this.patch_addContext_(k,o),j.push(k),k=new a.patch_obj,l=0,o=p,m=n)}r!==c&&(m+=s.length),r!==b&&(n+=s.length)}return l&&(this.patch_addContext_(k,o),j.push(k)),j},a.prototype.patch_deepCopy=function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=new a.patch_obj;f.diffs=[];for(var g=0;g<e.diffs.length;g++)f.diffs[g]=e.diffs[g].slice();f.start1=e.start1,f.start2=e.start2,f.length1=e.length1,f.length2=e.length2,c[d]=f}return c},a.prototype.patch_apply=function(a,e){if(0==a.length)return[e,[]];a=this.patch_deepCopy(a);var f=this.patch_addPadding(a);e=f+e+f,this.patch_splitMax(a);for(var g=0,h=[],i=0;i<a.length;i++){var j,k=a[i].start2+g,l=this.diff_text1(a[i].diffs),m=-1;if(l.length>this.Match_MaxBits?(j=this.match_main(e,l.substring(0,this.Match_MaxBits),k),-1!=j&&(m=this.match_main(e,l.substring(l.length-this.Match_MaxBits),k+l.length-this.Match_MaxBits),(-1==m||j>=m)&&(j=-1))):j=this.match_main(e,l,k),-1==j)h[i]=!1,g-=a[i].length2-a[i].length1;else{h[i]=!0,g=j-k;var n;if(n=-1==m?e.substring(j,j+l.length):e.substring(j,m+this.Match_MaxBits),l==n)e=e.substring(0,j)+this.diff_text2(a[i].diffs)+e.substring(j+l.length);else{var o=this.diff_main(l,n,!1);if(l.length>this.Match_MaxBits&&this.diff_levenshtein(o)/l.length>this.Patch_DeleteThreshold)h[i]=!1;else{this.diff_cleanupSemanticLossless(o);for(var p,q=0,r=0;r<a[i].diffs.length;r++){var s=a[i].diffs[r];s[0]!==d&&(p=this.diff_xIndex(o,q)),s[0]===c?e=e.substring(0,j+p)+s[1]+e.substring(j+p):s[0]===b&&(e=e.substring(0,j+p)+e.substring(j+this.diff_xIndex(o,q+s[1].length))),s[0]!==b&&(q+=s[1].length)}}}}}return e=e.substring(f.length,e.length-f.length),[e,h]},a.prototype.patch_addPadding=function(a){for(var b=this.Patch_Margin,c="",e=1;b>=e;e++)c+=String.fromCharCode(e);for(var e=0;e<a.length;e++)a[e].start1+=b,a[e].start2+=b;var f=a[0],g=f.diffs;if(0==g.length||g[0][0]!=d)g.unshift([d,c]),f.start1-=b,f.start2-=b,f.length1+=b,f.length2+=b;else if(b>g[0][1].length){var h=b-g[0][1].length;g[0][1]=c.substring(g[0][1].length)+g[0][1],f.start1-=h,f.start2-=h,f.length1+=h,f.length2+=h}if(f=a[a.length-1],g=f.diffs,0==g.length||g[g.length-1][0]!=d)g.push([d,c]),f.length1+=b,f.length2+=b;else if(b>g[g.length-1][1].length){var h=b-g[g.length-1][1].length;g[g.length-1][1]+=c.substring(0,h),f.length1+=h,f.length2+=h}return c},a.prototype.patch_splitMax=function(e){for(var f=this.Match_MaxBits,g=0;g<e.length;g++)if(!(e[g].length1<=f)){var h=e[g];e.splice(g--,1);for(var i=h.start1,j=h.start2,k="";0!==h.diffs.length;){var l=new a.patch_obj,m=!0;for(l.start1=i-k.length,l.start2=j-k.length,""!==k&&(l.length1=l.length2=k.length,l.diffs.push([d,k]));0!==h.diffs.length&&l.length1<f-this.Patch_Margin;){var n=h.diffs[0][0],o=h.diffs[0][1];n===c?(l.length2+=o.length,j+=o.length,l.diffs.push(h.diffs.shift()),m=!1):n===b&&1==l.diffs.length&&l.diffs[0][0]==d&&o.length>2*f?(l.length1+=o.length,i+=o.length,m=!1,l.diffs.push([n,o]),h.diffs.shift()):(o=o.substring(0,f-l.length1-this.Patch_Margin),l.length1+=o.length,i+=o.length,n===d?(l.length2+=o.length,j+=o.length):m=!1,l.diffs.push([n,o]),o==h.diffs[0][1]?h.diffs.shift():h.diffs[0][1]=h.diffs[0][1].substring(o.length))}k=this.diff_text2(l.diffs),k=k.substring(k.length-this.Patch_Margin);var p=this.diff_text1(h.diffs).substring(0,this.Patch_Margin);""!==p&&(l.length1+=p.length,l.length2+=p.length,0!==l.diffs.length&&l.diffs[l.diffs.length-1][0]===d?l.diffs[l.diffs.length-1][1]+=p:l.diffs.push([d,p])),m||e.splice(++g,0,l)}}},a.prototype.patch_toText=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b.join("")},a.prototype.patch_fromText=function(e){var f=[];if(!e)return f;for(var g=e.split("\n"),h=0,i=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;h<g.length;){var j=g[h].match(i);if(!j)throw new Error("Invalid patch string: "+g[h]);var k=new a.patch_obj;for(f.push(k),k.start1=parseInt(j[1],10),""===j[2]?(k.start1--,k.length1=1):"0"==j[2]?k.length1=0:(k.start1--,k.length1=parseInt(j[2],10)),k.start2=parseInt(j[3],10),""===j[4]?(k.start2--,k.length2=1):"0"==j[4]?k.length2=0:(k.start2--,k.length2=parseInt(j[4],10)),h++;h<g.length;){var l=g[h].charAt(0);try{var m=decodeURI(g[h].substring(1))}catch(n){throw new Error("Illegal escape in patch_fromText: "+m)}if("-"==l)k.diffs.push([b,m]);else if("+"==l)k.diffs.push([c,m]);else if(" "==l)k.diffs.push([d,m]);else{if("@"==l)break;if(""!==l)throw new Error('Invalid patch mode "'+l+'" in: '+m)}h++}}return f},a.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},a.patch_obj.prototype.toString=function(){var a,e;a=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,e=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var f,g=["@@ -"+a+" +"+e+" @@\n"],h=0;h<this.diffs.length;h++){switch(this.diffs[h][0]){case c:f="+";break;case b:f="-";break;case d:f=" "}g[h+1]=f+encodeURI(this.diffs[h][1])+"\n"}return g.join("").replace(/%20/g," ")},this.diff_match_patch=a,this.DIFF_DELETE=b,this.DIFF_INSERT=c,this.DIFF_EQUAL=d},{}]},{},[10]);